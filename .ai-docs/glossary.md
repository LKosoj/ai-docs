# Глоссарий

Ниже приведены ключевые термины и сущности, используемые в системе `ai_docs`, с краткими определениями и практическими пояснениями.

---

## `.ai-docs/`
Каталог, содержащий сгенерированную документацию и вспомогательные файлы:
- `index.md`, `architecture.md`, `dependencies.md` — основные документы.
- `modules/`, `configs/` — описания модулей и конфигураций.
- `_index.json` — навигационный индекс с приоритетами и структурой.
- `changes.md` — отчёт об изменениях после генерации.

**Практическое использование**:  
Используется как источник истины для навигации, рефакторинга и анализа проекта. При отсутствии — требуется запуск `ai_docs` для генерации.

---

## `.ai_docs_cache/`
Директория для кэширования результатов:
- `llm_cache.json` — закэшированные ответы LLM по хешу запроса.
- `index.json` — хэши и метаданные файлов для инкрементального анализа.

**Практическое использование**:  
Позволяет избежать повторных запросов к LLM и ускоряет перегенерацию. Удаление кэша приводит к полной переработке всех файлов.

---

## `CacheManager`
Класс для управления кэшем файлов и LLM-ответов.  
Методы:
- `diff_files()` — возвращает списки `added`, `modified`, `deleted`, `unchanged` на основе сравнения хэшей.
- `save_index()` — сохраняет текущее состояние файлов.

**Практическое использование**:  
Используется для инкрементальной обработки: обновляются только изменённые файлы.

---

## `LLMClient`
Клиент для взаимодействия с LLM через OpenAI-совместимый API.  
Поддерживает:
- Кэширование по SHA256 от payload.
- Настройку `model`, `temperature`, `max_tokens`.
- Таймауты: 120 с (подключение), 480 с (ответ).

**Практическое использование**:  
Инициализируется через `LLMClient.from_env()` с переменными окружения. Используется в `summarize_file()`.

---

## `scan()`
Основная функция сканирования файлов.  
Принимает:
- `source` — путь или URL Git-репозитория.
- `include`, `exclude` — glob-шаблоны.
- `max_size` — ограничение размера файла (по умолчанию 200 КБ).

**Практическое использование**:  
Фильтрует файлы по расширениям, `.gitignore`, `.build_ignore` и кастомным правилам из `.ai-docs.yaml`.

---

## `.ai-docs.yaml`
Конфигурационный файл для кастомизации сканирования:
```yaml
code_extensions: [".py", ".js"]
config_extensions: [".tf", ".yaml"]
exclude: ["temp/", "*.log"]
```

**Практическое использование**:  
Расширяет или переопределяет встроенные правила. Создаётся автоматически при первом запуске.

---

## `summarize_file()`
Функция генерации резюме файла с помощью LLM.  
Режимы:
- Базовое резюме.
- Описание модуля (для кода).
- Описание конфигурации (для `.yaml`, `.tf` и др.).

**Практическое использование**:  
Вызывается параллельно в нескольких потоках. Результат нормализуется и сохраняется в `docs/modules/` или `docs/configs/`.

---

## `build_mkdocs_yaml()`
Генерирует `mkdocs.yml` на основе структуры проекта.  
Формирует:
- `nav` — иерархическое меню (поддержка локализации).
- Подключает плагины: `search`, `mermaid2`.
- Настраивает `markdown_extensions` для Mermaid и сносок.

**Практическое использование**:  
Автоматически создаётся при генерации MkDocs-сайта. При `--local-site` отключает `site_url`.

---

## `chunk_text()`
Разбивает текст на части по лимиту токенов модели.  
Использует `tiktoken` для подсчёта токенов.

**Практическое использование**:  
Применяется при обработке больших файлов, чтобы не превысить `context_limit` LLM.

---

## `file_map`
Словарь с метаданными всех найденных файлов:
- Путь, тип (код/конфиг/документация).
- Домены (Kubernetes, Terraform и др.).
- Хэш содержимого.
- Путь к сгенерированному резюме.

**Практическое использование**:  
Используется для построения навигации, определения изменений и генерации разделов.

---

## `SECTION_TITLES`, `DOMAIN_TITLES`
Словари локализованных заголовков:
```python
SECTION_TITLES = {"ru": {"architecture": "Архитектура"}}
```

**Практическое использование**:  
Обеспечивают мультиязычность документации. Язык задаётся через `--language`.

---

## `format_changes_md()`
Формирует `changes.md` с перечнем:
- Добавленных/изменённых/удалённых файлов.
- Перегенерированных разделов.
- Итогового описания изменений.

**Практическое использование**:  
Автоматически обновляется после каждой генерации. Полезен для аудита и CI/CD.

---

## `is_infra()`, `detect_domains()`
Функции классификации файлов:
- `is_infra()` — определяет, относится ли файл к инфраструктуре (Terraform, Helm и др.).
- `detect_domains()` — возвращает список доменов (например, `["kubernetes", "docker"]`).

**Практическое использование**:  
Используются при построении навигации и генерации раздела "Архитектура".

---

## `ensure_dir()`, `safe_read()`, `is_binary()`
Вспомогательные утилиты:
- `ensure_dir(path)` — создаёт директорию, если не существует.
- `safe_read(path)` — читает файл в UTF-8, пропускает бинарные.
- `is_binary(path)` — проверяет наличие нулевых байтов.

**Практическое использование**:  
Используются во всех модулях для безопасной работы с файловой системой.
