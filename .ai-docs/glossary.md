# Глоссарий

Ниже приведены ключевые термины и сущности, используемые в системе `ai_docs`, с краткими определениями и практическим контекстом применения.

---

## **AI-документация**
Автоматически сгенерированная техническая документация на основе анализа исходного кода, конфигураций и структуры проекта с использованием LLM.  
**Практическое значение**: заменяет ручное написание `README.md` и статических руководств, обеспечивая актуальность при изменениях в коде.

---

## **LLMClient**
Клиент для взаимодействия с OpenAI-совместимыми моделями. Отправляет чат-запросы, поддерживает кэширование и настройку параметров генерации.  
**Ключевые параметры**:
- `model`: модель (например, `gpt-4o-mini`).
- `temperature`: 0.2 — низкая креативность, предсказуемый вывод.
- `max_tokens`: лимит токенов в ответе.
- `base_url`: позволяет использовать локальные или проксируемые API (например, `https://api.groq.com/openai/v1`).

**Использование**: интегрируется в `summarize_file`, `generate_docs` для генерации описаний.

---

## **CacheManager**
Менеджер кэширования, отслеживающий состояние файлов и хранящий ответы LLM. Работает с двумя файлами:
- `.ai_docs_cache/index.json` — хэши исходных файлов.
- `.ai_docs_cache/llm_cache.json` — закэшированные ответы LLM по SHA256 от payload.

**Практическая польза**: ускоряет повторные запуски, пропуская неизменённые файлы и повторяющиеся запросы.

---

## **ScanResult**
Объект, возвращаемый сканером. Содержит:
- `root`: корневая директория или URL репозитория.
- `files`: список файлов с метаданными (путь, размер, тип, домен).
- `source`: исходный путь/URL.
- `repo_name`: имя репозитория (если источник — git).

**Используется в**: `scan_source`, `generate_docs` — как входной набор для анализа.

---

## **Домен (domain)**
Классификация файла по технологической области на основе имени, расширения или пути.  
**Примеры**:
- `kubernetes`: `deployment.yaml`, `k8s/`.
- `terraform`: `.tf`, `terraform.tfvars`.
- `docker`: `Dockerfile`, `docker-compose.yml`.
- `ci`: `.github/workflows/`, `.gitlab-ci.yml`.

**Применение**: определяет, какие разделы документации (например, "Инфраструктура") будут сгенерированы.

---

## **Тип файла (file type)**
Категория файла: `code`, `config`, `doc`, `lock`, `test`.  
Определяется по расширению и имени с помощью `classify_type`.  
**Примеры**:
- `code`: `.py`, `.js`, `.go`.
- `config`: `.yaml`, `.toml`, `.env`.
- `doc`: `.md`, `.rst`.

**Используется для**: фильтрации, группировки в `modules/` и `configs/`.

---

## **Кэширование LLM**
Механизм хранения ответов модели по хешу входного запроса. Включается автоматически, отключается флагом `--no-cache`.  
**Файл**: `.ai_docs_cache/llm_cache.json`.  
**Преимущество**: снижает затраты на API и ускоряет генерацию при идемпотентных запросах.

---

## **Инкрементальная обработка**
Генерация документации только для изменённых, добавленных или удалённых файлов. Основана на сравнении с `index.json`.  
**Реализуется через**: `CacheManager.diff_files()`.  
**Результат**: экономия времени и ресурсов при повторных запусках.

---

## **Модуль (module)**
Логическая единица кода (например, `src/auth/`, `packages/api`).  
**Документация**: генерируется в `.ai-docs/modules/<slug>.md`.  
**Определяется по**: структуре директорий, наличию `__init__.py`, `package.json` и т.п.

---

## **Конфигурация (config)**
Файл настройки системы (`.yaml`, `.toml`, `.env`).  
**Документация**: размещается в `.ai-docs/configs/`.  
**Примеры**: `pyproject.toml`, `docker-compose.yml`, `terraform.tfvars`.

---

## **_index.json**
Навигационный индекс в `.ai-docs/`. Содержит:
- Структуру модулей и конфигураций.
- Приоритеты для сортировки.
- Ссылки на соответствующие `.md`-файлы.

**Используется в**: построении навигации MkDocs, ранжировании модулей при анализе.

---

## **.ai-docs.yaml**
Конфигурационный файл для кастомизации сканирования. Поддерживает:
```yaml
code_extensions: [".py", ".js"]
config_extensions: [".yaml", ".env"]
exclude: ["*.log", "temp/"]
```
**Приоритет**: переопределяет встроенные шаблоны включения/исключения.

---

## **FIXED_INCLUDE_PATTERNS**
Список шаблонов, по которым файлы включаются в сканирование **вне зависимости от фильтров**.  
**Примеры**: `Dockerfile`, `requirements.txt`, `*.tf`, `package.json`.  
**Цель**: гарантировать анализ ключевых файлов инфраструктуры и зависимостей.

---

## **DEFAULT_EXCLUDE_PATTERNS**
Стандартные шаблоны исключения:
- `.git`, `.venv`, `node_modules`, `__pycache__`, `dist`, `build`, `.ai-docs`, `.ai_docs_cache`.

**Дополняется**: правилами из `.gitignore`, `.build_ignore`, `.ai-docs.yaml`.

---

## **Токенизация**
Разбиение текста на токены для проверки длины контекста модели.  
**Инструмент**: `tiktoken`.  
**Функции**:
- `count_tokens(text, model)` — подсчёт.
- `chunk_text(text, model, max_tokens)` — разделение на части.

**Используется в**: `summarize_file` — для обработки больших файлов по чанкам.

---

## **Промпт (prompt)**
Шаблон запроса к LLM.  
**Примеры**:
- `SUMMARY_PROMPT`: общий обзор файла.
- `MODULE_SUMMARY_PROMPT`: описание модуля.
- `CONFIG_SUMMARY_PROMPT`: анализ конфигурации.

**Хранение**: встроены в код, локализованы под `ru`/`en`.

---

## **MkDocs**
Генератор статического сайта документации.  
**Артефакты**:
- `mkdocs.yml` — конфигурация.
- `ai_docs_site/` — собранный сайт.
- `.ai-docs/` — исходники для MkDocs.

**Сборка**: `mkdocs build -f mkdocs.yml`.

---

## **local_site**
Режим генерации MkDocs с настройками для локального запуска (без публикации).  
**Активация**: через `--local-site` или `AI_DOCS_LOCAL_SITE=1`.  
**Изменения**: отключает публикацию, настраивает локальные пути.

---

## **Slug**
Безопасное имя файла/пути, полученное из строки (замена пробелов, удаление спецсимволов).  
**Используется в**: именовании `.md`-файлов в `modules/` и `configs/`.

---

## **Бинарный файл**
Файл, содержащий нулевые байты (`\x00`). Определяется через `is_binary()`.  
**Поведение**: пропускается при анализе, не отправляется в LLM.

---

## **Источник (source)**
Путь к анализируемому проекту:  
- Локальная директория (например, `./my-project`).
- URL Git-репозитория (например, `https://github.com/user/repo.git`).

**Обработка URL**: клонируется во временный каталог, удаляется после завершения.

---

## **Секция (section)**
Раздел в `README.md` или на сайте: "Архитектура", "Зависимости", "Тестирование".  
**Генерируется через**: `_generate_section`, с кэшированием при повторных запусках.

---

## **Changes.md**
Файл отчёта об изменениях после генерации. Содержит:
- Добавленные/изменённые/удалённые файлы.
- Перегенерированные разделы.
- Итоговое резюме.

**Формат**: Markdown, используется для аудита и CI/CD.
