# Запуск и окружение

## Установка

Установите пакет через `pip`:

```bash
pip install ai-docs-gen
```

Или в режиме разработки (из корня проекта):

```bash
pip install -e .
```

## Переменные окружения

Инструмент использует следующие переменные окружения. Рекомендуется задавать их в файле `.env` в корне проекта.

| Переменная               | Назначение                                      | По умолчанию                     |
|--------------------------|-------------------------------------------------|----------------------------------|
| `OPENAI_API_KEY`         | Ключ для доступа к OpenAI или совместимому API  | Обязательна                      |
| `OPENAI_BASE_URL`        | Базовый URL API (для локальных LLM)             | `https://api.openai.com/v1`      |
| `OPENAI_MODEL`           | Модель LLM для генерации                        | `gpt-4o-mini`                    |
| `OPENAI_TEMPERATURE`     | Температура генерации (0.0 – 2.0)               | `0.2`                            |
| `OPENAI_MAX_TOKENS`      | Максимальное число токенов в ответе             | `1200`                           |
| `OPENAI_CONTEXT_TOKENS`  | Общий лимит токенов контекста                   | `8192`                           |
| `AI_DOCS_THREADS`        | Количество потоков для параллельной обработки   | `4`                              |
| `AI_DOCS_LOCAL_SITE`     | Режим локальной сборки MkDocs (без публикации)   | `false`                          |

Пример `.env`:

```env
OPENAI_API_KEY=sk-...
OPENAI_MODEL=gpt-4o-mini
AI_DOCS_THREADS=6
AI_DOCS_LOCAL_SITE=true
```

## Базовый запуск

Сгенерировать `README.md` и сайт MkDocs для локального проекта:

```bash
ai-docs --source .
```

Для удалённого Git-репозитория:

```bash
ai-docs --source https://github.com/user/repo.git
```

## Флаги CLI

| Флаг               | Описание                                                                 |
|--------------------|--------------------------------------------------------------------------|
| `--source`         | Путь к директории или URL Git-репозитория (обязательный)                 |
| `--readme`         | Генерировать только `README.md`                                         |
| `--mkdocs`         | Генерировать только сайт MkDocs                                         |
| `--language ru/en` | Язык документации (по умолчанию: `ru`)                                   |
| `--threads N`      | Количество потоков (переопределяет `AI_DOCS_THREADS`)                   |
| `--force`          | Перезаписать существующий `README.md`                                    |
| `--no-cache`       | Отключить кэширование запросов к LLM                                    |
| `--local-site`     | Настроить MkDocs для локального просмотра (переопределяет переменную)   |
| `--include GLOB`   | Дополнительные шаблоны включения файлов (например, `*.yaml`)            |
| `--exclude GLOB`   | Дополнительные шаблоны исключения (например, `*.test.*`)                |
| `--max-size N`     | Максимальный размер файла в байтах (по умолчанию: 200000)                |

Пример: генерация только README на английском с кастомными путями:

```bash
ai-docs --source . --readme --language en --include "*.yaml" --exclude "temp/*"
```

## Режимы работы

- **Полная генерация** (по умолчанию): создаётся `README.md` и сайт MkDocs.
- **Только README**: с флагом `--readme`.
- **Только MkDocs**: с флагом `--mkdocs`.
- **Инкрементальная обработка**: при повторном запуске анализируются только изменённые файлы (на основе `.ai_docs_cache/`).

## Структура рабочих директорий

При запуске создаются служебные каталоги:

- `.ai_docs_cache/` — кэш LLM-ответов и хэшей файлов.
- `.ai-docs/` — промежуточные данные: `_index.json`, `changes.md`, `modules/`, `configs/`.

Генерируемая документация:
- `README.md` — в корне проекта.
- `docs/` — исходники MkDocs.
- `site/` — собранный сайт (результат `mkdocs build`).

## Требования к окружению

- Python ≥ 3.8
- `git` — для клонирования удалённых репозиториев
- `mkdocs` — устанавливается автоматически как зависимость

## Отладка

Для запуска без установки (в режиме разработки):

```bash
python -m ai_docs.cli --source . --readme --no-cache
```

Логи выводятся в stdout. Ошибки обработки файлов регистрируются, но не прерывают выполнение.
