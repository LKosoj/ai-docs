# Запуск и окружение

## Установка

Установите пакет через `pip`:

```bash
pip install ai-docs-gen
```

Или установите локально в режиме разработки:

```bash
git clone <репозиторий>
cd ai_docs
pip install -e .
```

После установки доступна CLI-команда: `ai-docs`.

---

## Переменные окружения

Инструмент использует следующие переменные окружения (поддерживаются `.env`-файлы):

| Переменная               | Назначение                                  | Обязательная | Значение по умолчанию         |
|--------------------------|---------------------------------------------|--------------|-------------------------------|
| `OPENAI_API_KEY`         | Ключ для доступа к LLM                      | Да           | —                             |
| `OPENAI_BASE_URL`        | Базовый URL API (для OpenAI-совместимых)    | Нет          | `https://api.openai.com/v1`   |
| `OPENAI_MODEL`           | Модель LLM (например, `gpt-4o-mini`)        | Нет          | `gpt-4o-mini`                 |
| `OPENAI_TEMPERATURE`     | Температура генерации (0.0 – 1.0)           | Нет          | `0.2`                         |
| `OPENAI_MAX_TOKENS`      | Макс. токенов в ответе                      | Нет          | `1200`                        |
| `OPENAI_CONTEXT_TOKENS`  | Общий лимит контекста                       | Нет          | `8192`                        |
| `AI_DOCS_THREADS`        | Количество потоков обработки                | Нет          | `4`                           |
| `AI_DOCS_LOCAL_SITE`     | Режим локальной сборки MkDocs (без публикации) | Нет       | `false`                       |

Пример `.env`:

```env
OPENAI_API_KEY=sk-...
OPENAI_MODEL=gpt-4o-mini
AI_DOCS_THREADS=6
AI_DOCS_LOCAL_SITE=true
```

---

## Запуск CLI

### Базовый запуск

```bash
ai-docs --source /путь/к/проекту
```

Сгенерирует `README.md` и сайт MkDocs в выходной директории.

### Генерация только README

```bash
ai-docs --source /путь/к/проекту --readme
```

### Генерация только MkDocs

```bash
ai-docs --source /путь/к/проекту --mkdocs
```

### Работа с удалённым репозиторием

```bash
ai-docs --source https://github.com/user/repo.git --mkdocs
```

Репозиторий будет временно клонирован.

### Язык документации

```bash
ai-docs --source . --language ru
```

Поддерживаемые языки: `ru`, `en` (по умолчанию `ru`).

---

## Параметры CLI

| Флаг                 | Описание                                                                 |
|----------------------|--------------------------------------------------------------------------|
| `--source`           | Путь к локальной директории или URL Git-репозитория (обязательный)       |
| `--output`           | Директория вывода (по умолчанию: `.ai-docs/output`)                      |
| `--readme`           | Генерировать только `README.md`                                         |
| `--mkdocs`           | Генерировать только сайт MkDocs                                         |
| `--language`         | Язык документации (`ru` или `en`)                                        |
| `--threads`          | Количество потоков (переопределяет `AI_DOCS_THREADS`)                    |
| `--force`            | Перезаписать существующий `README.md`                                    |
| `--no-cache`         | Отключить кэширование LLM-ответов и анализа файлов                       |
| `--local-site`       | Включить режим локальной сборки MkDocs (переопределяет переменную окружения) |
| `--include`          | Дополнительные glob-шаблоны для включения файлов (можно указать несколько) |
| `--exclude`          | Дополнительные glob-шаблоны для исключения файлов                        |
| `--max-size`         | Макс. размер файла в байтах (по умолчанию: 200000)                       |

---

## Каталоги и кэширование

- `.ai-docs/` — основная рабочая директория:
  - `output/` — сгенерированная документация.
  - `_index.json` — навигационный индекс проекта.
  - `changes.md` — отчёт об изменениях.
- `.ai_docs_cache/` — кэш LLM и хэши файлов:
  - `llm_cache.json` — закэшированные ответы от модели.
  - `index.json` — хэши и метаданные файлов для инкрементальной обработки.

Кэширование позволяет избежать повторной обработки неизменённых файлов и повторных запросов к LLM.

---

## Конфигурация проекта

Создайте `.ai-docs.yaml` в корне проекта для кастомизации:

```yaml
include:
  - "*.yaml"
  - "scripts/*.sh"
exclude:
  - "temp/"
  - "logs/"
code_extensions:
  - ".py"
  - ".go"
config_extensions:
  - ".tf"
  - ".hcl"
```

Также учитываются:
- `.gitignore`
- `.build_ignore`

---

## Ограничения и безопасность

- Файлы свыше 200 КБ игнорируются (настраивается через `--max-size`).
- Бинарные файлы автоматически исключаются.
- Симлинки не обрабатываются.
- Временные директории (например, при клонировании) удаляются после завершения.

---

## Пример полного запуска

```bash
ai-docs \
  --source https://github.com/example/project.git \
  --mkdocs \
  --language en \
  --threads 8 \
  --include "docs/*.md" \
  --exclude "tests/"
```

Результат: сайт документации в `./.ai-docs/output/`, собранный через `mkdocs build`.
