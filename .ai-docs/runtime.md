# Запуск и окружение

## Установка

Установите пакет через `pip`:

```bash
pip install ai-docs-gen
```

Или в режиме разработки из исходников:

```bash
git clone <репозиторий>
cd ai-docs
pip install -e .
```

## Переменные окружения

Инструмент использует следующие переменные окружения:

| Переменная               | Назначение                                      | По умолчанию               |
|--------------------------|-------------------------------------------------|----------------------------|
| `OPENAI_API_KEY`         | Ключ для доступа к LLM (обязательно)            | —                          |
| `OPENAI_BASE_URL`        | Базовый URL API (для кастомных эндпоинтов)      | `https://api.openai.com/v1`|
| `OPENAI_MODEL`           | Модель LLM                                      | `gpt-4o-mini`              |
| `OPENAI_TEMPERATURE`     | Температура генерации (0.0 – 1.0)               | `0.2`                      |
| `OPENAI_MAX_TOKENS`      | Макс. токенов в ответе                          | `1200`                     |
| `OPENAI_CONTEXT_TOKENS`  | Общий лимит контекста                           | `8192`                     |
| `AI_DOCS_THREADS`        | Количество потоков обработки                    | `4`                        |
| `AI_DOCS_LOCAL_SITE`     | Режим локальной сборки MkDocs (без публикации)  | `false`                    |

Переменные можно задать в `.env` в корне проекта.

## Базовый запуск

Сгенерировать `README.md` и сайт MkDocs для локальной директории:

```bash
ai-docs --source .
```

Для удалённого Git-репозитория:

```bash
ai-docs --source https://github.com/user/repo.git
```

## Флаги CLI

| Флаг               | Описание                                                                 |
|--------------------|--------------------------------------------------------------------------|
| `--source`         | Путь к директории или URL Git-репозитория (обязательный)                 |
| `--readme`         | Генерировать только `README.md`                                         |
| `--mkdocs`         | Генерировать только сайт MkDocs                                         |
| `--language ru/en` | Язык документации (по умолчанию: `ru`)                                   |
| `--threads N`      | Количество параллельных потоков (переопределяет `AI_DOCS_THREADS`)       |
| `--force`          | Перезаписать существующий `README.md`                                    |
| `--no-cache`       | Отключить кэширование LLM-запросов и результатов анализа                 |
| `--local-site`     | Настроить MkDocs для локального запуска (переопределяет переменную)      |
| `--include GLOB`   | Дополнительные шаблоны включения файлов (например, `*.yaml`)             |
| `--exclude GLOB`   | Дополнительные шаблоны исключения (например, `*.test.*`)                 |
| `--max-size N`     | Макс. размер файла в байтах (по умолчанию: 200000)                       |

## Режимы работы

### Полная генерация (по умолчанию)
Если не указаны `--readme` или `--mkdocs`, генерируются оба артефакта:
- `README.md` в корне
- Полный сайт в `docs/` + `mkdocs.yml`

### Инкрементальная обработка
Сравнение с предыдущим состоянием через `.ai_docs_cache/index.json`. Обрабатываются только:
- Новые файлы
- Изменившиеся файлы
- Удалённые файлы (для обновления `changes.md`)

### Кэширование
- Результаты LLM хранятся в `.ai_docs_cache/llm_cache.json`
- Хэши файлов и метаданные — в `.ai_docs_cache/index.json`
- При повторном запуске без изменений — обработка пропускается

## Структура выходных артефактов

```
.ais-docs/           # Промежуточные данные
├── _index.json      # Навигационный индекс
├── changes.md       # Отчёт об изменениях
├── modules/         # Описания модулей
└── configs/         # Описания конфигураций

docs/                # Сайт MkDocs
├── index.md
├── modules/
├── configs/
├── dependencies.md
└── ...              # Другие разделы

README.md            # Краткая документация
mkdocs.yml           # Конфигурация сайта
.ai_docs_cache/      # Кэш (не коммитится)
```

## Требования к окружению

- Python ≥ 3.8
- `git` (для обработки URL-репозиториев)
- Доступ к OpenAI-совместимому API
- Свободное место на диске (временные клоны, кэш)

## Пример: Локальная отладка

```bash
# Установка зависимостей
pip install -r requirements-dev.txt

# Запуск напрямую (для отладки)
python -m ai_docs.cli --source . --language ru --threads 2 --no-cache
```

После выполнения — проверьте `README.md` и `docs/`.
