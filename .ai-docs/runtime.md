# Запуск и окружение

## Установка и запуск

Инструмент `ai_docs` доступен как CLI-утилита. Установка выполняется через `pip`:

```bash
pip install ai_docs
```

Запуск генерации документации:

```bash
ai_docs --source <путь_или_url> [опции]
```

Примеры:
```bash
# Локальный проект
ai_docs --source ./my-project --language ru --mkdocs

# Удалённый репозиторий
ai_docs --source https://github.com/user/repo.git --readme --threads 4

# С фильтрацией и кастомным выводом
ai_docs --source . --include "*.py" --exclude "tests/" --output ./docs
```

## Переменные окружения

| Переменная                | Назначение                                      | По умолчанию             |
|---------------------------|-------------------------------------------------|--------------------------|
| `OPENAI_API_KEY`          | Ключ доступа к OpenAI или совместимому API      | Обязательна              |
| `OPENAI_BASE_URL`         | Базовый URL API (для локальных/кастомных моделей)| `https://api.openai.com/v1` |
| `OPENAI_MODEL`            | Модель LLM (например, `gpt-4o-mini`)            | `gpt-4o-mini`            |
| `OPENAI_TEMPERATURE`      | Температура генерации (0.0 – 1.0)               | `0.2`                    |
| `OPENAI_MAX_TOKENS`       | Макс. токенов в ответе                          | `1200`                   |
| `OPENAI_CONTEXT_TOKENS`   | Общий лимит контекста                           | `8192`                   |
| `AI_DOCS_THREADS`         | Количество потоков обработки                    | `4`                      |
| `AI_DOCS_LOCAL_SITE`      | Режим локального хостинга MkDocs (0/1)          | `0`                      |

Переменные можно задавать в `.env` в корне проекта.

## Поддерживаемые источники

- **Локальные директории**: `./`, `/path/to/project`
- **Git-репозитории по URL**: `https://github.com/user/repo.git`

При использовании URL репозиторий клонируется во временный каталог, который удаляется после завершения.

## Каталоги и артефакты

- `.ai_docs_cache/` — кэш LLM-ответов и метаданных файлов (настраивается через `--cache-dir`).
- `.ai-docs/` — выходная директория с полной документацией:
  - `index.md`, `architecture.md`, `conventions.md` — основные разделы.
  - `modules/` — описания модулей.
  - `_index.json` — навигационный индекс.
- `ai_docs_site/` — сгенерированный MkDocs-сайт (при использовании `--mkdocs`).
- `README.md` — генерируется в корне проекта (если указан `--readme`).

## Файлы конфигурации

### `.ai-docs.yaml` (опционально)

Позволяет кастомизировать поведение сканера:

```yaml
code_extensions:
  - ".py"
  - ".ts"
config_extensions:
  - ".yaml"
  - ".tfvars"
doc_extensions:
  - ".md"
  - ".rst"
exclude:
  - "temp/"
  - "*.log"
  - "node_modules/"
```

### `mkdocs.yml`

Генерируется автоматически. Включает навигацию по модулям, разделам (архитектура, запуск, конфиги) и настройки, зависящие от флага `--local-site`.

## Фильтрация файлов

Поддерживается на двух уровнях:

1. **Через CLI-аргументы**:
   - `--include "*.py"` — включить только Python-файлы.
   - `--exclude "tests/**"` — исключить тесты.
   - `--max-size 500000` — ограничить размер файла (в байтах).

2. **Через `.ai-docs.yaml`**:
   - `exclude` — дополнительные glob-шаблоны.
   - Кастомизация расширений для кода, конфигов, документации.

Файлы, перечисленные в `.gitignore` и `.build_ignore`, автоматически исключаются.

## Режимы генерации

| Флаг         | Результат                                     |
|--------------|-----------------------------------------------|
| `--readme`   | Генерация `README.md`                         |
| `--mkdocs`   | Генерация `mkdocs.yml` и сайта в `ai_docs_site/` |
| Без флагов   | Оба артефакта                                |

## Интеграция в CI/CD

Пример для GitHub Actions:

```yaml
- name: Generate Docs
  run: |
    pip install ai_docs
    ai_docs --source . --mkdocs --readme --language en
  env:
    OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
```

Особенности:
- Поддержка повторных запусков с сохранением кэша.
- Инкрементальная обработка: анализируются только изменённые файлы.
- Автоматическая очистка временных файлов.

## Требования

- Python 3.9+
- `git` (для работы с URL-репозиториями)
- Доступ к OpenAI-совместимому API

Установка зависимостей:
```bash
pip install -r requirements.txt
```
