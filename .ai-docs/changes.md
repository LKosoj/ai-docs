# Изменения с последней генерации

## Добавленные файлы

- нет
## Изменённые файлы

- ai_docs/generator.py
- ai_docs/scanner.py
## Удалённые файлы

- нет
## Перегенерированные разделы

- Модули
- Архитектура
- Зависимости
- Глоссарий
- Запуск и окружение
- Соглашения
- Документация проекта

## Краткое резюме

Внесённые изменения охватывают два ключевых модуля: **сканирование файлов** и **генерация технической документации с использованием LLM**. Ниже приведено краткое резюме изменений с акцентом на практические аспекты и влияние на функциональность.

---

## Сканирование файлов

- **Расширена гибкость фильтрации**:
  - Добавлена поддержка кастомных расширений через `.ai-docs.yaml` (`code_extensions`, `doc_extensions`, `config_extensions`).
  - Файлы, соответствующие `FIXED_INCLUDE_PATTERNS` (Terraform, Docker, CI/CD, lock-файлы), включаются безусловно, даже если они игнорируются `.gitignore`.
- **Улучшена обработка исключений**:
  - Учитываются `.gitignore` и `.build_ignore` с помощью `pathspec`.
  - Дополнительные шаблоны исключения можно задать в `exclude` конфига.
- **Поддержка локальных и удалённых источников**:
  - Автоматическое клонирование Git-репозиториев во временные каталоги.
  - Проверка существования локальных путей.
- **Ограничение по размеру**:
  - Файлы свыше `max_size` (по умолчанию 200 КБ) пропускаются.
- **Автоматическая конфигурация**:
  - При отсутствии `.ai-docs.yaml` создаётся конфиг по умолчанию.
  - Поддерживается кастомизация без изменения кода.

---

## Генерация документации через LLM

- **Эффективный анализ изменений**:
  - Сравнение по хэшам позволяет обрабатывать только изменённые файлы.
  - Тестовые файлы фильтруются на ранних этапах.
- **Параллельная обработка**:
  - Аннотирование и генерация разделов выполняются в пуле потоков (`ThreadPoolExecutor`).
  - Настройка числа потоков: `threads`, `section_workers`.
- **Кэширование результатов**:
  - `CacheManager` хранит ответы LLM и метаданные, предотвращая повторные запросы.
  - Кэш обновляется только при изменении контекста.
- **Структурированный вывод**:
  - Автоматическое формирование `_index.json`, оглавления, глоссария и `CHANGELOG.md`.
  - Поддержка Mermaid-диаграмм в разделах архитектуры.
- **Интеграция с MkDocs**:
  - При включении `write_mkdocs` генерируется `mkdocs.yml` и запускается сборка сайта.
  - Опция `write_readme` позволяет обновлять `README.md` на основе сводок.
- **Контроль ресурсов**:
  - Ограничения `max_tokens` и `input_budget` предотвращают переполнение контекста LLM.
- **Синхронизация и очистка**:
  - Удаление устаревших файлов документации при удалении исходников.
  - Обновление `file_map` с актуальными путями, типами и доменами.

---

## Итог

Изменения обеспечивают:
- **Гибкость** — настройка через `.ai-docs.yaml`.
- **Производительность** — кэширование, многопоточность, фильтрация.
- **Надёжность** — синхронизация с кодовой базой, логирование ошибок.
- **Автоматизацию** — от сканирования до публикации документации.

Система готова к использованию в CI/CD для регулярной актуализации технической документации на основе кода.
