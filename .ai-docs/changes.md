# Изменения с последней генерации

## Добавленные файлы

- нет
## Изменённые файлы

- ai_docs/generator.py
- ai_docs/mkdocs.py
## Удалённые файлы

- нет
## Перегенерированные разделы

- Тестирование
- Модули
- Конфигурация проекта
- Зависимости
- Соглашения
- Запуск и окружение
- Архитектура
- Глоссарий
- Документация проекта

## Краткое резюме

Внесённые изменения реализуют автоматизированную генерацию технической документации на основе анализа структуры проекта с использованием LLM. Основной акцент — на создании актуальной, иерархически организованной документации в формате MkDocs и `README.md` с поддержкой кэширования, локализации и модульной сборки.

## Основные изменения

- **Генерация `mkdocs.yml`**  
  Функция `build_mkdocs_yaml` формирует конфигурационный файл на лету с учётом:
  - Названия сайта (`site_name`).
  - Пути к директориям (`docs_dir`, `site_dir`).
  - Плагинов: `search`, `mermaid2` (для визуализации диаграмм).
  - Markdown-расширений: поддержка таблиц, подчёркивания, fenced code с Mermaid.
  - Навигации: динамически строится через `_build_tree_nav` из списка файлов.

- **Динамическая навигация**  
  `_build_tree_nav` преобразует плоский список путей в древовидную структуру меню, поддерживая вложенность для:
  - Модулей (`modules/`).
  - Конфигураций (`configs/`).
  Пример: `modules/core/utils.py` → `Модули > Core > Utils`.

- **Корректный вывод в YAML**  
  Используется кастомный `_YamlSafeDumper` для корректного представления:
  - Python-объектов (например, `!python/name:mermaid2.fence_mermaid`).
  - Специальных типов без потери форматирования.

- **Запись Markdown-файлов**  
  `write_docs_files` массово записывает сгенерированные `.md`-файлы в указанную директорию (по умолчанию `.ai-docs/docs`), создавая структуру:
  ```
  docs/
  ├── index.md
  ├── modules/
  ├── configs/
  ├── dependencies.md
  ├── changes.md
  └── glossary.md
  ```

- **Оптимизация для локальной сборки**  
  При генерации локального сайта:
  - `site_url` устанавливается в `null`.
  - `use_directory_urls: false` — для корректной работы без веб-сервера.

- **Интеграция с кэшированием**  
  Все генерируемые разделы и сводки файлов кэшируются через `CacheManager` и `llm_cache`, что позволяет:
  - Избегать повторных запросов к LLM.
  - Обновлять только изменённые разделы при частичной перегенерации.

- **Поддержка локализации**  
  Заголовки разделов локализованы через словари:
  - `SECTION_TITLES` — общие разделы (архитектура, зависимости).
  - `DOMAIN_TITLES` — домены (инфраструктура, тесты, конфигурации).

## Генерируемые артефакты

| Артефакт | Назначение |
|--------|-----------|
| `mkdocs.yml` | Конфигурация сайта документации. |
| `.ai-docs/docs/` | Корневая директория Markdown-файлов. |
| `_index.json` | Навигационный индекс для внутреннего использования. |
| `README.md` | Краткая сводка проекта (опционально). |

## Особенности реализации

- Автоматическая очистка устаревших файлов в `docs/` перед записью новых.
- Поддержка мультиформатных конфигов: TOML, JSON, YAML.
- Обработка инфраструктурных доменов (`is_infra`) с отдельной секциональной логикой.
- Ограничение контекста LLM через `input_budget` и `_truncate_context`.
- Параллельная обработка файлов (`threads`, `section_workers`).

Система обеспечивает воспроизводимую, масштабируемую и локализованную документацию с минимальным ручным вмешательством.
