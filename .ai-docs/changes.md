# Изменения с последней генерации

## Добавленные файлы

- нет
## Изменённые файлы

- ai_docs/generator.py
- ai_docs/mkdocs.py
- ai_docs/scanner.py
- pyproject.toml
## Удалённые файлы

- нет
## Перегенерированные разделы

- Тестирование
- Модули
- Конфигурация проекта
- Зависимости
- Архитектура
- Соглашения
- Запуск и окружение
- Глоссарий
- Документация проекта

## Краткое резюме

Внесённые изменения затрагивают структуру, конфигурацию и функциональность пакета `ai-docs-gen`, обеспечивая автоматизированную генерацию технической документации на основе анализа исходного кода и конфигураций.

## Конфигурация пакета (`pyproject.toml`)
- Обновлена метаинформация: указано имя пакета (`ai-docs-gen`), версия, описание, ссылка на `README.md`.
- Установлена минимальная поддерживаемая версия Python — **3.8**.
- Добавлены зависимости для сборки: `setuptools>=68`, `wheel`.
- Настроена точка входа CLI: команда `ai-docs` вызывает `ai_docs.cli:main`.
- Включена автоматическая сборка пакета: обнаруживаются модули в `ai_docs`, исключается директория `assets`.
- Добавлено включение статических файлов: `assets/mermaid.min.js` включается в состав пакета через `package-data`.

## Сканирование репозиториев
- Реализовано автоматическое сканирование локальных и удалённых репозиториев через `scan_source`.
- Поддержка клонирования Git-репозиториев во временную директорию.
- Фильтрация файлов по:
  - Фиксированным шаблонам включения (`Dockerfile`, `*.tf`, `package.json` и др.).
  - Стандартным исключениям (`.git`, `node_modules`, `__pycache__`, `.venv`).
  - Пользовательским правилам из `.ai-docs.yaml`, `.gitignore`, `.build_ignore`.
- Ограничение размера файлов — **200 КБ**; пропуск бинарных и симлинков.
- Результат — объект `ScanResult` с метаданными файлов: путь, тип, размер, первые 4000 символов содержимого, домены.

## Генерация документации
- Реализована поддержка **MkDocs**: генерация `mkdocs.yml` с кастомной навигацией, включая древовидные структуры для `configs/` и `modules/`.
- Добавлены плагины: `mermaid2` для визуализации диаграмм.
- Поддержка Markdown-расширений и корректная сериализация Python-объектов в YAML через кастомный `Dumper`.
- Запись файлов документации (`write_docs_files`) с созданием поддиректорий.

## Интеграция с LLM
- Генерация описаний файлов и разделов через `LLMClient`.
- Кэширование ответов LLM (`CacheManager`, `llm_cache`) для ускорения повторных запусков.
- Оптимизация контекста: обрезка по токенам (`_truncate_context`), управление бюджетом ввода (`input_budget`).
- Параллельная обработка файлов с настраиваемым числом потоков (`threads`, `section_workers`).

## Генерируемые артефакты
- `README.md` — краткое описание проекта.
- `docs/index.md`, `docs/modules/`, `docs/configs/` — структурированная документация.
- `docs/dependencies.md`, `changes.md`, `glossary.md` — системные разделы.
- `_index.json` — JSON-индекс для навигации.
- `js/mermaid.min.js` — статический ресурс для диаграмм.

## Дополнительные возможности
- Локализация заголовков (`SECTION_TITLES`, `DOMAIN_TITLES`).
- Опции генерации: `write_readme`, `write_mkdocs`, `force`, `language`.
- Очистка устаревших файлов перед записью.
- Сборка сайта MkDocs после генерации.
- Обработка ошибок с накоплением и выводом в конце выполнения.

Изменения обеспечивают **автоматизированную, масштабируемую и кэшируемую** генерацию документации, адаптированную под структуру проекта и используемые технологии (Kubernetes, Terraform и др.).
