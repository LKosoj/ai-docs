# ai_docs/scanner

Модуль `scanner` предназначен для анализа исходного кода из локальной директории или удалённого Git-репозитория. Он сканирует файлы, применяя правила включения и исключения, определяет их тип и предметные области (домены), фильтрует бинарные и слишком большие файлы, а также учитывает `.gitignore` и другие ignore-файлы. Результатом является структурированная информация о каждом подходящем файле, включая путь, содержимое, размер и метаданные.

---

```python
DEFAULT_INCLUDE_PATTERNS: Set[str]
```
Множество шаблонов файлов по умолчанию, которые должны быть включены в сканирование (например, исходные коды, конфигурации, документация).

---

```python
DEFAULT_EXCLUDE_PATTERNS: Set[str]
```
Множество шаблонов файлов по умолчанию, которые должны быть исключены из сканирования (например, скрытые директории, виртуальные окружения, артефакты сборки).

---

```python
class ScanResult
```
Результат сканирования исходного кода — содержит информацию о корневой директории, найденных файлах, источнике и имени репозитория.
Поля
- `root` — абсолютный путь к корневой директории сканирования.
- `files` — список словарей с информацией о каждом прошедшем фильтрацию файле.
- `source` — исходная строка, переданная в `scan_source` (URL или путь).
- `repo_name` — имя репозитория (из URL или имени директории).

---

```python
_load_ignore_specs(root: Path) -> List[pathspec.PathSpec]
```
Загружает и компилирует правила игнорирования из `.gitignore` и `.build_ignore` в указанной директории.
Аргументы
- `root` — корневая директория проекта.
Возвращает
- Список скомпилированных спецификаций путей, соответствующих формату gitignore.

---

```python
_should_include(rel_path: str, include: Optional[Set[str]], exclude: Optional[Set[str]], ignore_specs: List[pathspec.PathSpec]) -> bool
```
Определяет, должен ли файл быть включён в результаты сканирования.
Аргументы
- `rel_path` — относительный путь к файлу в формате POSIX.
- `include` — пользовательские шаблоны включения (если `None`, включаются все файлы, не исключённые другими правилами).
- `exclude` — пользовательские шаблоны исключения.
- `ignore_specs` — список скомпилированных спецификаций игнорирования (например, из `.gitignore`).
Возвращает
- `True`, если файл должен быть включён; `False` — если должен быть пропущен.

---

```python
_scan_directory(root: Path, include: Optional[Set[str]], exclude: Optional[Set[str]], max_size: int) -> List[Dict]
```
Рекурсивно сканирует директорию и возвращает список подходящих файлов с метаданными.
Аргументы
- `root` — корневая директория для сканирования.
- `include` — шаблоны включения файлов.
- `exclude` — шаблоны исключения файлов.
- `max_size` — максимальный размер файла в байтах (файлы больше — пропускаются).
Возвращает
- Список словарей с информацией о каждом файле: путь, абсолютный путь, размер, содержимое, тип, домены.

---

```python
_clone_repo(repo_url: str) -> Tuple[Path, str]
```
Клонирует удалённый Git-репозиторий в временную директорию.
Аргументы
- `repo_url` — URL Git-репозитория (HTTP/HTTPS).
Возвращает
- Кортеж из пути к временной директории и имени репозитория (без `.git`).
Исключения
- `RuntimeError` — если клонирование завершилось ошибкой (например, недоступный URL, сетевая ошибка).

---

```python
scan_source(source: str, include: Optional[Set[str]] = None, exclude: Optional[Set[str]] = None, max_size: int = 200000) -> ScanResult
```
Основная функция модуля: сканирует локальную директорию или клонирует и сканирует удалённый репозиторий.
Аргументы
- `source` — путь к локальной директории или URL Git-репозитория.
- `include` — пользовательские шаблоны включения файлов (по умолчанию — `DEFAULT_INCLUDE_PATTERNS`).
- `exclude` — пользовательские шаблоны исключения файлов (по умолчанию — `DEFAULT_EXCLUDE_PATTERNS`).
- `max_size` — максимальный размер файла в байтах (по умолчанию — 200 КБ).
Возвращает
- Объект `ScanResult` с результатами сканирования.
Исключения
- `FileNotFoundError` — если локальный путь не существует.
- `RuntimeError` — если не удалось клонировать репозиторий.
