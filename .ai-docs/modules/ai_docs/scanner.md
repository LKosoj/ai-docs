# ai_docs/scanner

```markdown
Модуль отвечает за сканирование файловой системы или удалённого репозитория по URL для анализа структуры проекта.  
Поддерживает фильтрацию файлов по шаблонам включения и исключения, задаваемым явно или через конфигурацию расширения.  
Результатом работы является объект `ScanResult`, содержащий информацию о просканированных файлах и метаданные источника.

Ключевые структуры данных  
ScanResult — Результат сканирования, включающий путь к корню, список файлов, источник и имя репозитория

---
class ScanResult  
Результат сканирования исходного кода: содержит список файлов с метаданными, корневой путь, источник и имя репозитория.  
Поля  
root — Абсолютный путь к корню сканированного каталога  
files — Список словарей с информацией о каждом обработанном файле  
source — Исходная строка (путь или URL), переданная в scan_source  
repo_name — Имя репозитория, извлечённое из пути или URL

---
_normalize_extensions  
Нормализует пользовательские расширения из конфигурации, добавляя точки и заполняя описания по умолчанию.  
Аргументы  
raw — Входные данные (словарь или список) с пользовательскими расширениями  
defaults — Словарь описаний расширений по умолчанию  
Возвращает  
Словарь нормализованных расширений с описаниями

---
_normalize_excludes  
Преобразует входной объект в множество строк с очищенными паттернами исключения.  
Аргументы  
raw — Входной объект (ожидается список строк)  
Возвращает  
Множество очищенных строк паттернов исключения

---
_load_extension_config  
Загружает или создаёт конфигурацию расширений из файла .ai-docs.yaml в корне проекта.  
Аргументы  
root — Корневой путь к проекту  
Возвращает  
Словарь с тремя ключами: code_extensions, doc_extensions, config_extensions (с описаниями) и exclude (множество паттернов)

---
_build_default_include_patterns  
Формирует набор паттернов включения на основе расширений из конфигурации и фиксированных паттернов.  
Аргументы  
extension_config — Конфигурация расширений, полученная из _load_extension_config  
Возвращает  
Множество строк с паттернами включения (например, "*.py", "*.md")

---
_load_ignore_specs  
Загружает правила игнорирования из .gitignore и .build_ignore.  
Аргументы  
root — Корневой путь к проекту  
Возвращает  
Список объектов pathspec.PathSpec, представляющих правила игнорирования

---
_should_include  
Определяет, должен ли файл быть включён в результат сканирования.  
Аргументы  
rel_path — Относительный путь к файлу в формате POSIX  
include — Множество паттернов включения (или None)  
exclude — Множество паттернов исключения (или None)  
ignore_specs — Список объектов PathSpec с правилами игнорирования  
Возвращает  
True, если файл должен быть включён, иначе False

---
_scan_directory  
Рекурсивно сканирует директорию и собирает информацию о подходящих файлах.  
Аргументы  
root — Корневой путь к директории  
include — Множество паттернов включения  
exclude — Множество паттернов исключения  
max_size — Максимальный размер файла в байтах  
Возвращает  
Список словарей с информацией о каждом подходящем файле

---
_clone_repo  
Клонирует удалённый Git-репозиторий во временный каталог.  
Аргументы  
repo_url — URL Git-репозитория  
Возвращает  
Кортеж из пути к временной директории и имени репозитория  
Исключения  
RuntimeError — Если клонирование завершилось ошибкой

---
scan_source  
Сканирует локальную директорию или Git-репозиторий по URL и возвращает структурированный результат.  
Аргументы  
source — Путь к локальной директории или URL удалённого репозитория  
include — Дополнительные паттерны включения (по умолчанию — автоматически определяются)  
exclude — Дополнительные паттерны исключения (объединяются с настройками по умолчанию и из конфига)  
max_size — Максимальный размер файла в байтах (по умолчанию 200 КБ)  
Возвращает  
Объект ScanResult с результатами сканирования  
Исключения  
FileNotFoundError — Если локальный путь не существует  
RuntimeError — Если не удалось клонировать репозиторий
```
