# ai_docs/tokenizer

Модуль предоставляет инструменты для токенизации текста с использованием кодировок, соответствующих указанным языковым моделям, с поддержкой резервных механизмов. В случае отсутствия поддержки конкретной модели, используется базовая кодировка `cl100k_base` или резервная байтовая кодировка. Основные функции позволяют подсчитывать количество токенов в тексте и разбивать текст на фрагменты заданного максимального размера в токенах.

Ключевые структуры данных  
_ByteEncoding — Резервная реализация кодировки, основанная на прямом преобразовании UTF-8 байтов в токены.

---
def get_encoding(model: str)  
Возвращает объект кодировки для указанной модели, при необходимости используя резервные варианты.  
Аргументы  
model — Название языковой модели (например, "gpt-4", "text-davinci-003").  
Возвращает  
Объект с методами `encode` и `decode`, совместимый с `tiktoken.Encoding`, или экземпляр `_ByteEncoding` в случае ошибки.  
Исключения  
Никакие исключения не выбрасываются — при ошибках возвращается резервная кодировка.

---
def count_tokens(text: str, model: str) -> int  
Подсчитывает количество токенов в тексте с использованием кодировки, соответствующей модели.  
Аргументы  
text — Входной текст для подсчёта токенов.  
model — Название языковой модели.  
Возвращает  
Количество токенов в закодированном тексте.

---
def chunk_text(text: str, model: str, max_tokens: int) -> List[str]  
Разбивает текст на фрагменты, каждый из которых содержит не более `max_tokens` токенов.  
Аргументы  
text — Входной текст для разбиения.  
model — Название языковой модели, определяющей кодировку.  
max_tokens — Максимальное количество токенов в одном фрагменте.  
Возвращает  
Список строк, каждый элемент — декодированный фрагмент текста заданного размера.

---
class _ByteEncoding  
Резервная реализация кодировки, преобразующая текст в последовательность UTF-8 байтов и обратно.  
Методы  
encode(self, text: str) — Преобразует строку в список байтов (токенов) в кодировке UTF-8.  
decode(self, tokens) — Преобразует список байтов обратно в строку в кодировке UTF-8.
