# ai_docs/generator_summarize

Модуль предоставляет асинхронные функции для генерации и обновления аннотаций (сводок) по изменённым или отсутствующим файлам в проекте. Основная логика включает параллельную обработку файлов с ограничением числа одновременных задач, поддержку разных типов файлов (код, конфигурации) и ведение прогресса с логированием. Все функции используют общий механизм суммаризации и записывают результаты в указанные директории.

Ключевые структуры данных  
to_summarize — Список кортежей (путь, метаданные), где метаданные содержат тип файла, домены, содержимое и другие атрибуты.  
llm_cache — Кэш для хранения ранее полученных ответов от модели, чтобы избежать повторных запросов.

async def summarize_changed_files(to_summarize: List[Tuple[str, Dict]], summaries_dir: Path, llm, llm_cache: Dict[str, str], threads: int, save_cb, errors: List[str]) -> None  
Асинхронно генерирует сводки для изменённых файлов общего назначения.  
Аргументы  
to_summarize — Список файлов (путь и метаданные) для обработки.  
summaries_dir — Директория для сохранения сгенерированных сводок.  
llm — Языковая модель для генерации текста.  
llm_cache — Кэш ответов от LLM для повторного использования.  
threads — Максимальное число параллельных задач.  
save_cb — Коллбэк, вызываемый после успешной обработки каждого файла.  
errors — Список для накопления сообщений об ошибках.  
Возвращает  
Ничего не возвращает.  
Исключения  
Добавляет сообщения об ошибках в список errors при возникновении исключений.

---
async def summarize_changed_modules(to_summarize: List[Tuple[str, Dict]], module_summaries_dir: Path, llm, llm_cache: Dict[str, str], threads: int, save_cb, errors: List[str]) -> None  
Асинхронно генерирует сводки для модулей (исходных файлов кода), исключая тесты.  
Аргументы  
to_summarize — Список файлов (путь и метаданные) для обработки.  
module_summaries_dir — Директория для сохранения сводок по модулям.  
llm — Языковая модель для генерации текста.  
llm_cache — Кэш ответов от LLM.  
threads — Максимальное число параллельных задач.  
save_cb — Коллбэк, вызываемый после успешной обработки каждого файла.  
errors — Список для накопления сообщений об ошибках.  
Возвращает  
Ничего не возвращает.  
Исключения  
Добавляет сообщения об ошибках в список errors при возникновении исключений.

---
async def summarize_changed_configs(to_summarize: List[Tuple[str, Dict]], config_summaries_dir: Path, llm, llm_cache: Dict[str, str], threads: int, save_cb, errors: List[str]) -> None  
Асинхронно генерирует сводки для конфигурационных файлов.  
Аргументы  
to_summarize — Список файлов (путь и метаданные) для обработки.  
config_summaries_dir — Директория для сохранения сводок по конфигурациям.  
llm — Языковая модель для генерации текста.  
llm_cache — Кэш ответов от LLM.  
threads — Максимальное число параллельных задач.  
save_cb — Коллбэк, вызываемый после успешной обработки каждого файла.  
errors — Список для накопления сообщений об ошибках.  
Возвращает  
Ничего не возвращает.  
Исключения  
Добавляет сообщения об ошибках в список errors при возникновении исключений.

---
async def summarize_missing(missing_summaries: List[Tuple[str, Dict]], summaries_dir: Path, llm, llm_cache: Dict[str, str], threads: int, save_cb, errors: List[str]) -> None  
Асинхронно восстанавливает отсутствующие сводки для обычных файлов.  
Аргументы  
missing_summaries — Список файлов, для которых отсутствуют сводки.  
summaries_dir — Директория для сохранения сгенерированных сводок.  
llm — Языковая модель для генерации текста.  
llm_cache — Кэш ответов от LLM.  
threads — Максимальное число параллельных задач.  
save_cb — Коллбэк, вызываемый после успешной обработки каждого файла.  
errors — Список для накопления сообщений об ошибках.  
Возвращает  
Ничего не возвращает.  
Исключения  
Добавляет сообщения об ошибках в список errors при возникновении исключений.

---
async def summarize_missing_modules(missing_module_summaries: List[Tuple[str, Dict]], module_summaries_dir: Path, llm, llm_cache: Dict[str, str], threads: int, save_cb, errors: List[str]) -> None  
Асинхронно восстанавливает отсутствующие сводки для модулей (исходных файлов кода).  
Аргументы  
missing_module_summaries — Список модулей, для которых отсутствуют сводки.  
module_summaries_dir — Директория для сохранения сводок по модулям.  
llm — Языковая модель для генерации текста.  
llm_cache — Кэш ответов от LLM.  
threads — Максимальное число параллельных задач.  
save_cb — Коллбэк, вызываемый после успешной обработки каждого файла.  
errors — Список для накопления сообщений об ошибках.  
Возвращает  
Ничего не возвращает.  
Исключения  
Добавляет сообщения об ошибках в список errors при возникновении исключений.

---
async def summarize_missing_configs(missing_config_summaries: List[Tuple[str, Dict]], config_summaries_dir: Path, llm, llm_cache: Dict[str, str], threads: int, save_cb, errors: List[str]) -> None  
Асинхронно восстанавливает отсутствующие сводки для конфигурационных файлов.  
Аргументы  
missing_config_summaries — Список конфигурационных файлов, для которых отсутствуют сводки.  
config_summaries_dir — Директория для сохранения сводок по конфигурациям.  
llm — Языковая модель для генерации текста.  
llm_cache — Кэш ответов от LLM.  
threads — Максимальное число параллельных задач.  
save_cb — Коллбэк, вызываемый после успешной обработки каждого файла.  
errors — Список для накопления сообщений об ошибках.  
Возвращает  
Ничего не возвращает.  
Исключения  
Добавляет сообщения об ошибках в список errors при возникновении исключений.

---
async def run_one(path: str, meta: dict)  
Асинхронно обрабатывает один конфигурационный файл: генерирует сводку, сохраняет её и обновляет метаданные.  
Аргументы  
path — путь к конфигурационному файлу.  
meta — метаданные конфигурации, включая домены, путь к сводке и другую сопутствующую информацию.  
Возвращает  
None — после завершения обработки одного файла.  
Исключения  
Любое исключение записывается в список errors с контекстом операции.
