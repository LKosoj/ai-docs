# ai_docs/generator_summarize

Модуль предоставляет асинхронные функции для генерации и обновления аннотаций к файлам, модулям и конфигурациям на основе их содержимого. Использует семафоры для ограничения числа одновременных запросов к LLM, поддерживает кэширование, прогресс-логирование и обработку ошибок. Функции разделены по типам сущностей: обычные файлы, модули (код без тестов) и конфигурационные файлы.

Ключевые структуры данных  
Tuple[str, Dict] — Пара путь к файлу и метаданные, используемая для описания обрабатываемого файла  
List[str] — Список сообщений об ошибках, накапливаемый в процессе выполнения

async def summarize_changed_files(to_summarize: List[Tuple[str, Dict]], summaries_dir: Path, llm, llm_cache: Dict[str, str], threads: int, save_cb, errors: List[str]) -> None  
Асинхронно генерирует аннотации для изменённых файлов и сохраняет их в указанный каталог.  
Аргументы  
to_summarize — Список пар (путь, метаданные) для файлов, требующих аннотации  
summaries_dir — Каталог для сохранения сгенерированных аннотаций  
llm — Языковая модель для генерации аннотаций  
llm_cache — Кэш ответов LLM для повторного использования  
threads — Максимальное число одновременных запросов  
save_cb — Коллбэк, вызываемый после успешной обработки каждого файла  
errors — Список для накопления сообщений об ошибках  
Возвращает  
Ничего не возвращает  
Исключения  
Добавляет сообщения об исключениях в список errors, не прерывая выполнение

---  
async def summarize_changed_modules(to_summarize: List[Tuple[str, Dict]], module_summaries_dir: Path, llm, llm_cache: Dict[str, str], threads: int, save_cb, errors: List[str]) -> None  
Асинхронно генерирует аннотации для модулей (код без тестов) и сохраняет их в каталог модулей.  
Аргументы  
to_summarize — Список пар (путь, метаданные) для файлов, требующих аннотации  
module_summaries_dir — Каталог для сохранения аннотаций модулей  
llm — Языковая модель для генерации аннотаций  
llm_cache — Кэш ответов LLM для повторного использования  
threads — Максимальное число одновременных запросов  
save_cb — Коллбэк, вызываемый после успешной обработки каждого файла  
errors — Список для накопления сообщений об ошибках  
Возвращает  
Ничего не возвращает  
Исключения  
Добавляет сообщения об исключениях в список errors, не прерывая выполнение

---  
async def summarize_changed_configs(to_summarize: List[Tuple[str, Dict]], config_summaries_dir: Path, llm, llm_cache: Dict[str, str], threads: int, save_cb, errors: List[str]) -> None  
Асинхронно генерирует аннотации для конфигурационных файлов и сохраняет их в каталог конфигов.  
Аргументы  
to_summarize — Список пар (путь, метаданные) для файлов, требующих аннотации  
config_summaries_dir — Каталог для сохранения аннотаций конфигураций  
llm — Языковая модель для генерации аннотаций  
llm_cache — Кэш ответов LLM для повторного использования  
threads — Максимальное число одновременных запросов  
save_cb — Коллбэк, вызываемый после успешной обработки каждого файла  
errors — Список для накопления сообщений об ошибках  
Возвращает  
Ничего не возвращает  
Исключения  
Добавляет сообщения об исключениях в список errors, не прерывая выполнение

---  
async def summarize_missing(missing_summaries: List[Tuple[str, Dict]], summaries_dir: Path, llm, llm_cache: Dict[str, str], threads: int, save_cb, errors: List[str]) -> None  
Асинхронно восстанавливает отсутствующие аннотации для обычных файлов с отображением прогресса.  
Аргументы  
missing_summaries — Список пар (путь, метаданные) для файлов с отсутствующими аннотациями  
summaries_dir — Каталог для сохранения сгенерированных аннотаций  
llm — Языковая модель для генерации аннотаций  
llm_cache — Кэш ответов LLM для повторного использования  
threads — Максимальное число одновременных запросов  
save_cb — Коллбэк, вызываемый после успешной обработки каждого файла  
errors — Список для накопления сообщений об ошибках  
Возвращает  
Ничего не возвращает  
Исключения  
Добавляет сообщения об исключениях в список errors, не прерывая выполнение

---  
async def summarize_missing_modules(missing_module_summaries: List[Tuple[str, Dict]], module_summaries_dir: Path, llm, llm_cache: Dict[str, str], threads: int, save_cb, errors: List[str]) -> None  
Асинхронно восстанавливает отсутствующие аннотации для модулей с отображением прогресса.  
Аргументы  
missing_module_summaries — Список пар (путь, метаданные) для модулей с отсутствующими аннотациями  
module_summaries_dir — Каталог для сохранения аннотаций модулей  
llm — Языковая модель для генерации аннотаций  
llm_cache — Кэш ответов LLM для повторного использования  
threads — Максимальное число одновременных запросов  
save_cb — Коллбэк, вызываемый после успешной обработки каждого файла  
errors — Список для накопления сообщений об ошибках  
Возвращает  
Ничего не возвращает  
Исключения  
Добавляет сообщения об исключениях в список errors, не прерывая выполнение

---  
async def summarize_missing_configs(missing_config_summaries: List[Tuple[str, Dict]], config_summaries_dir: Path, llm, llm_cache: Dict[str, str], threads: int, save_cb, errors: List[str]) -> None  
Асинхронно восстанавливает отсутствующие аннотации для конфигурационных файлов с отображением прогресса.  
Аргументы  
missing_config_summaries — Список пар (путь, метаданные) для конфигов с отсутствующими аннотациями  
config_summaries_dir — Каталог для сохранения аннотаций конфигураций  
llm — Языковая модель для генерации аннотаций  
llm_cache — Кэш ответов LLM для повторного использования  
threads — Максимальное число одновременных запросов  
save_cb — Коллбэк, вызываемый после успешной обработки каждого файла  
errors — Список для накопления сообщений об ошибках  
Возвращает  
Ничего не возвращает  
Исключения  
Добавляет сообщения об исключениях в список errors, не прерывая выполнение
