# ai_docs/generator

Модуль отвечает за генерацию и управление документацией проекта на основе анализа исходных файлов, метаданных и контекста. Он автоматически создаёт структуру документации, включая индекс, модули, конфигурации, зависимости и изменения. Поддерживает асинхронную генерацию секций, очистку устаревших файлов и интеграцию с системами вроде MkDocs. Результат сохраняется в файловую систему с возможностью кэширования и управления версиями.

Ключевые структуры данных  
file_map — карта файлов проекта с метаданными, включая тип, путь к сводке и другие атрибуты  
docs_files — словарь, содержащий сгенерированные документы в формате путь → содержимое  
regenerated_sections — список названий секций, перегенерированных в текущем запуске  
llm_cache — кэш для результатов запросов к языковой модели, используется для ускорения повторной генерации

---
_generate_readme  
Генерирует содержимое README.md на основе общего обзора проекта.  
Аргументы  
llm — экземпляр языковой модели  
llm_cache — кэш для запросов к модели  
project_name — название проекта, используемое в заголовке  
overview_context — общий контекст проекта для генерации описания  
language — язык, на котором генерируется README  
Возвращает  
Текст README в формате Markdown

---
_generate_section  
Генерирует текст секции документации с использованием языковой модели и кэширования.  
Аргументы  
llm — экземпляр языковой модели для генерации текста  
cache — словарь кэша для хранения и повторного использования результатов  
title — заголовок секции, влияющий на промпт  
context — входной контекст с информацией для обработки  
language — язык, на котором должна быть сгенерирована документация  
Возвращает  
Сгенерированный текст секции в формате Markdown

---
_submit_section  
Добавляет задачу генерации секции документации в пул асинхронных задач.  
Аргументы  
path — путь назначения для сохранения сгенерированной секции  
title — заголовок секции, используемый в документации  
context — контекстный текст, передаваемый модели для генерации содержимого  
Возвращает  
Ничего не возвращает

---
_render_project_configs_index  
Формирует содержимое индекса конфигураций проекта на основе списка путей.  
Аргументы  
config_nav_paths — список строк с путями к страницам конфигураций в документации  
Возвращает  
Текст индексной страницы в формате Markdown с навигацией по конфигурациям

---
_collect_dependencies  
Собирает список зависимостей проекта из метаданных файлов.  
Аргументы  
file_map — карта файлов с метаданными, включая информацию о зависимостях  
Возвращает  
Список строк, каждая из которых представляет собой зависимость

---
_truncate_context  
Обрезает контекст до допустимого объёма на основе лимита модели.  
Аргументы  
context — исходный текст контекста  
model — название модели, определяющее лимит токенов  
budget — максимальное количество токенов для контекста  
Возвращает  
Обрезанный текст, умещающийся в лимит модели

---
_build_docs_index  
Формирует JSON-индекс документации для навигации и поиска.  
Аргументы  
output_root — корневой путь вывода документации  
docs_dir — директория, куда сохраняется документация  
docs_files — словарь сгенерированных файлов документации  
file_map — карта исходных файлов проекта  
module_pages — страницы модулей, включённые в индекс  
config_pages — страницы конфигураций, включённые в индекс  
Возвращает  
Словарь, представляющий структуру документации в формате JSON

---
build_mkdocs_yaml  
Формирует содержимое файла mkdocs.yml для сборки документации.  
Аргументы  
site_name — название сайта документации  
sections — отображение заголовков секций  
configs — список конфигурационных доменов  
has_modules — флаг наличия модулей в проекте  
module_nav_paths — пути к страницам модулей для включения в навигацию  
project_config_nav_paths — пути к страницам конфигураций  
local_site — флаг локальной сборки (влияет на настройки деплоя)  
Возвращает  
Содержимое файла mkdocs.yml в виде строки

---
write_docs_files  
Записывает все сгенерированные файлы документации на диск.  
Аргументы  
docs_dir — корневая директория для сохранения документации  
docs_files — словарь, где ключ — путь, значение — содержимое файла  
Возвращает  
Ничего не возвращает

---
format_changes_md  
Формирует Markdown-представление изменений в проекте.  
Аргументы  
added — словарь добавленных файлов  
modified — словарь изменённых файлов  
deleted — словарь удалённых файлов  
regenerated_sections — список перегенерированных секций  
summary — сгенерированное резюме изменений  
Возвращает  
Форматированный текст изменений в Markdown с оглавлением и сводкой

---
_is_test_path  
Проверяет, является ли путь тестовым (по шаблону или расположению).  
Аргументы  
path — путь к файлу в проекте  
Возвращает  
True, если путь соответствует тестовому, иначе False

---
class LLM  
Интерфейс языковой модели для генерации текста документации.  
Поля  
model — строковое имя модели, используемое для определения ограничений  
Методы  
generate(prompt: str) — генерирует текст на основе входного промпта

---
class Cache  
Система кэширования индексов и результатов LLM для ускорения повторной генерации.  
Методы  
save_index(index: Dict) — сохраняет индекс файлов и метаданных на диск  
save_llm_cache(cache: Dict) — сохраняет кэш запросов к языковой модели
