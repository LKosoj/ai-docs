# ai_docs/generator

Модуль отвечает за генерацию и управление документацией проекта на основе анализа исходных файлов, метаданных и контекста. Он автоматически создаёт структуру документации, включая индекс, модули, конфигурации, зависимости и изменения. Поддерживает интеграцию с LLM для генерации описаний, обновление навигации и очистку устаревших файлов. Также обеспечивает сборку документации через MkDocs при необходимости.

Ключевые структуры данных  
file_map — карта файлов проекта с метаданными, включая тип, пути к сводкам и другую аналитическую информацию  
docs_files — словарь, содержащий сгенерированные Markdown-файлы документации перед записью на диск  
regenerated_sections — список названий секций, которые были перегенерированы в ходе текущего запуска

---
void _submit_section(path: str, title: str, context: str)  
Отправляет задачу на асинхронную генерацию секции документации  
Аргументы  
path — путь к файлу документа (относительно корня docs)  
title — заголовок секции  
context — контекстный текст для обработки моделью  
Возвращает  
Ничего не возвращает  
Исключения  
Не выбрасывает исключения

---
void _generate_section(llm: LLM, llm_cache: LLMLiteCache, title: str, context: str, language: str) -> str  
Генерирует текст секции документации с использованием языковой модели  
Аргументы  
llm — экземпляр языковой модели  
llm_cache — кэш для результатов LLM  
title — заголовок запрашиваемой секции  
context — входной контекст для модели  
language — язык вывода (например, "ru", "en")  
Возвращает  
Сгенерированный текст секции в формате Markdown  
Исключения  
Может выбросить исключение при ошибках взаимодействия с LLM

---
void _render_project_configs_index(config_nav_paths: List[str]) -> str  
Формирует содержание индекса конфигураций проекта  
Аргументы  
config_nav_paths — список путей к страницам конфигураций  
Возвращает  
Markdown-строка с оглавлением всех конфигураций  
Исключения  
Не выбрасывает исключения

---
void _collect_dependencies(file_map: Dict[str, Dict]) -> List[str]  
Собирает список зависимостей проекта из метаданных файлов  
Аргументы  
file_map — карта файлов с метаданными  
Возвращает  
Список строк с описанием зависимостей  
Исключения  
Не выбрасывает исключения

---
void _truncate_context(context: str, model: str, budget: int) -> str  
Обрезает контекст до допустимого объёма токенов для модели  
Аргументы  
context — исходный текстовый контекст  
model — название модели для оценки токенов  
budget — максимальное количество токенов  
Возвращает  
Усечённый контекст, укладывающийся в лимит  
Исключения  
Не выбрасывает исключения

---
void _build_docs_index(output_root: Path, docs_dir: Path, docs_files: Dict[str, str], file_map: Dict[str, Dict], module_pages: Dict[str, str], config_pages: Dict[str, str]) -> Dict  
Формирует JSON-индекс документации для навигации и поиска  
Аргументы  
output_root — корневой путь вывода  
docs_dir — директория документации  
docs_files — текущие сгенерированные файлы  
file_map — карта исходных файлов  
module_pages — страницы модулей  
config_pages — страницы конфигураций  
Возвращает  
Словарь с древовидной структурой документации  
Исключения  
Не выбрасывает исключения

---
void _generate_readme(llm: LLM, llm_cache: LLMLiteCache, project_name: str, overview_context: str, language: str) -> str  
Генерирует содержимое README.md на основе общего обзора проекта  
Аргументы  
llm — экземпляр языковой модели  
llm_cache — кэш LLM-запросов  
project_name — имя проекта  
overview_context — общий контекст проекта  
language — язык генерации  
Возвращает  
Текст README в формате Markdown  
Исключения  
Может выбросить исключение при ошибках взаимодействия с LLM

---
void build_mkdocs_yaml(site_name: str, sections: Dict[str, str], configs: List[str], has_modules: bool, module_nav_paths: Optional[List[str]], project_config_nav_paths: Optional[List[str]], local_site: bool) -> str  
Формирует содержимое файла mkdocs.yml для сборки документации  
Аргументы  
site_name — имя сайта документации  
sections — заголовки секций  
configs — список конфигурационных доменов  
has_modules — наличие модульной документации  
module_nav_paths — пути к страницам модулей  
project_config_nav_paths — пути к страницам конфигураций  
local_site — флаг локальной сборки  
Возвращает  
YAML-строка конфигурации MkDocs  
Исключения  
Не выбрасывает исключения

---
void format_changes_md(added: Dict, modified: Dict, deleted: Dict, regenerated_sections: List[str], summary: str) -> str  
Форматирует Markdown-отчёт об изменениях в проекте  
Аргументы  
added — словарь добавленных файлов  
modified — словарь изменённых файлов  
deleted — словарь удалённых файлов  
regenerated_sections — список перегенерированных секций  
summary — краткое резюме изменений от LLM  
Возвращает  
Полный отчёт в формате Markdown  
Исключения  
Не выбрасывает исключения

---
void write_docs_files(docs_dir: Path, docs_files: Dict[str, str])  
Записывает все сгенерированные файлы документации на диск  
Аргументы  
docs_dir — директория назначения  
docs_files — словарь путей и содержимого файлов  
Возвращает  
Ничего не возвращает  
Исключения  
Может выбросить исключение при ошибках записи файлов

---
void _is_test_path(path: str) -> bool  
Проверяет, является ли путь тестовым (по шаблону)  
Аргументы  
path — путь к файлу  
Возвращает  
True, если путь соответствует тестовому файлу  
Исключения  
Не выбрасывает исключения
