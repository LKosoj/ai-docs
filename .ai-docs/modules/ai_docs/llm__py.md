# ai_docs/llm

```markdown
Асинхронный клиент для взаимодействия с LLM через OpenAI-совместимое API с поддержкой кэширования, автоматических повторных попыток и адаптивного таймаута. Поддерживает настройку параметров модели через конструктор и переменные окружения. Предоставляет методы для оценки длины входных данных и управления таймаутами на основе объёма запроса.

Ключевые структуры данных
LLMClient — Асинхронный клиент для работы с LLM через OpenAI-совместимое API

---
class LLMClient
Асинхронный клиент для выполнения запросов к языковым моделям с поддержкой кэширования и повторных попыток
Поля
api_key — Ключ API для аутентификации
base_url — Базовый URL для API, может быть пустым для использования стандартного
model — Имя модели, используемой для генерации
temperature — Параметр температуры для контролирования случайности вывода
max_tokens — Максимальное количество токенов в ответе
context_limit — Ограничение контекстного окна модели в токенах
_context_limit — Внутренняя защита от превышения лимита контекста
_cache_lock — Асинхронная блокировка для потокобезопасного доступа к кэшу
_client — Экземпляр AsyncOpenAI для выполнения HTTP-запросов
Методы
__init__(api_key: str, base_url: str, model: str, temperature: float = 0.2, max_tokens: int = 1200, context_limit: int = 8192) — Инициализирует клиент с параметрами модели и HTTP-клиентом
_estimate_input_tokens(messages: List[Dict[str, str]]) -> int — Оценивает количество токенов во входных сообщениях
_compute_read_timeout(input_tokens: int) -> float — Вычисляет адаптивный таймаут чтения на основе количества входных токенов
_cache_key(payload: Dict) -> str — Генерирует хеш-ключ для кэширования на основе содержимого запроса
chat(messages: List[Dict[str, str]], cache: Optional[Dict[str, str]] = None) -> str — Асинхронно отправляет запрос к модели и возвращает сгенерированный ответ

---
from_env() -> LLMClient
Создаёт экземпляр LLMClient, используя параметры из переменных окружения
Возвращает
Настроенный экземпляр LLMClient
Исключения
RuntimeError — Если обязательная переменная окружения OPENAI_API_KEY не установлена
```
