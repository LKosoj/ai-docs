# ai_docs/generator

```markdown
Модуль отвечает за генерацию технической документации проекта на основе анализа исходных файлов с использованием LLM. Собирает контекст, разбивает код на модули, генерирует разделы документации (архитектура, зависимости и др.), создаёт индекс и управляет выводом в формате Markdown. Поддерживает кэширование, многопоточную обработку и интеграцию с MkDocs. Работает с различными форматами конфигураций (TOML, JSON, YAML) и фильтрует тестовые файлы.

Ключевые структуры данных  
files — Список словарей с метаданными файлов (путь, содержимое, хеш и др.)  
llm — Клиент для взаимодействия с языковой моделью  
SECTION_TITLES — Отображение кодов разделов в локализованные заголовки  
DOMAIN_TITLES — Отображение доменов в читаемые названия технологий

generate_docs(files: List[Dict], output_root: Path, cache_dir: Path, llm: LLMClient, language: str, write_readme: bool, write_mkdocs: bool, use_cache: bool = True, threads: int = 1)
Генерирует полную документацию проекта: разделы, модули, README и MkDocs-конфигурацию.
Аргументы
files — Список файлов проекта с метаданными (путь, содержимое и т.д.)
output_root — Корневая директория для вывода документации
cache_dir — Директория для кэширования промежуточных результатов
llm — Экземпляр клиента языковой модели
language — Язык документации (например, "ru" или "en")
write_readme — Флаг: генерировать ли README.md
write_mkdocs — Флаг: генерировать ли mkdocs.yml и структуру для MkDocs
use_cache — Использовать кэш для ускорения повторной генерации (по умолчанию True)
threads — Количество потоков для параллельной обработки файлов (по умолчанию 1)
Возвращает
None — Результат записывается в файловую систему
---
_is_test_path(path: str) -> bool
Определяет, является ли путь тестовым (по имени папки или файла).
Аргументы
path — Путь к файлу
Возвращает
True, если путь соответствует тестовому файлу или директории
---
_collect_dependencies(files: Dict[str, Dict]) -> List[str]
Собирает список зависимостей из pyproject.toml, requirements.txt и package.json.
Аргументы
files — Словарь файлов проекта с содержимым
Возвращает
Отсортированный список уникальных строк зависимостей в формате "имя версия"
---
_generate_section(llm: LLMClient, llm_cache: Dict[str, str], title: str, context: str, language: str) -> str
Генерирует один раздел документации с помощью LLM, включая Mermaid-диаграмму для архитектуры.
Аргументы
llm — Клиент языковой модели
llm_cache — Кэш для ответов LLM
title — Заголовок раздела
context — Контекстный текст для анализа
language — Язык вывода
Возвращает
Сгенерированный Markdown-контент раздела без дублирующего заголовка
---
_strip_duplicate_heading(content: str, title: str) -> str
Удаляет первый заголовок из текста, если он совпадает с указанным заголовком.
Аргументы
content — Исходный текст
title — Ожидаемый заголовок
Возвращает
Текст без дублирующего заголовка
---
_generate_readme(llm: LLMClient, llm_cache: Dict[str, str], project_name: str, overview_context: str, language: str) -> str
Генерирует краткий README.md с обзором, быстрым стартом и ссылками.
Аргументы
llm — Клиент языковой модели
llm_cache — Кэш LLM
project_name — Название проекта
overview_context — Общий контекст проекта
language — Язык документации
Возвращает
Сгенерированный Markdown-текст README
---
_truncate_context(context: str, model: str, max_tokens: int) -> str
Обрезает контекст до указанного лимита токенов, если он превышает лимит.
Аргументы
context — Исходный текст
model — Название модели для подсчёта токенов
max_tokens — Максимальное количество токенов
Возвращает
Обрезанный текст (первый чанк), если превышает лимит, иначе — исходный
---
_first_paragraph(text: str) -> str
Извлекает первый абзац текста, пропуская заголовки и пустые строки.
Аргументы
text — Исходный текст
Возвращает
Первый абзац как строка (не более двух непустых строк)
---
_build_docs_index(output_root: Path, docs_dir: Path, docs_files: Dict[str, str], file_map: Dict[str, Dict], module_pages: Dict[str, str]) -> Dict[str, object]
Формирует JSON-индекс документации с метаданными, структурой разделов и модулей.
Аргументы
output_root — Корневая директория вывода
docs_dir — Директория с документацией
docs_files — Сгенерированные файлы документации
file_map — Карта файлов проекта с метаданными
module_pages — Сопоставление модулей и путей к их документации
Возвращает
Словарь с метаинформацией: время генерации, список разделов, модулей, файлов и правил навигации
```
