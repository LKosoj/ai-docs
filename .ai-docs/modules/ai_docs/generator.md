# ai_docs/generator

# Модуль `generate` — Автоматическая генерация технической документации

Модуль `generate` предназначен для автоматической генерации и обновления технической документации на основе анализа исходных файлов проекта с использованием языковых моделей (LLM). Он поддерживает многопоточную обработку, кэширование результатов и интеграцию с MkDocs для построения структурированной документации в формате Markdown.

## Основные функции

- **Полная генерация документации** (`generate_docs`): запускает цепочку процессов — от сбора зависимостей до создания `README.md` и `mkdocs.yml`.
- **Сбор зависимостей** (`_collect_dependencies`): извлекает и возвращает список зависимостей из `pyproject.toml`, `requirements.txt`, `package.json`.
- **Генерация разделов** (`_generate_section`): создаёт Markdown-содержимое раздела на основе контекста и заголовка с помощью LLM.
- **Генерация README** (`_generate_readme`): формирует обзорный `README.md` на основе общего контекста проекта.
- **Управление контекстом** (`_truncate_context`): обрезает текст до допустимого количества токенов для выбранной модели.
- **Кэширование** (`LLMLiteCache`, `ProjectDocsCache`): обеспечивает повторное использование LLM-ответов и метаданных между запусками.
- **Форматирование изменений** (`format_changes_md`): генерирует Markdown-отчёт о внесённых изменениях в проект.
- **Генерация MkDocs-конфигурации** (`build_mkdocs_yaml`): создаёт `mkdocs.yml` с учётом структуры документации и настроек развёртывания.
- **Запись файлов** (`write_docs_files`, `write_summary`): сохраняет сгенерированные файлы на диск с сохранением структуры каталогов.

## Ключевые данные и параметры

- `files`: список файлов проекта с метаданными (путь, содержимое, тип).
- `llm`: экземпляр LLM для генерации текста.
- `llm_cache`: кэш для хранения ответов LLM.
- `domain_contexts`: объединённые сводки по доменам.
- `overview_context`: общий контекст проекта для генерации обзора.
- `regenerated_sections`: список перегенерированных разделов.
- `docs_files`, `module_pages`, `configs_written`: словари сгенерированных файлов.
- `DOMAIN_TITLES`: соответствие идентификаторов доменов и их отображаемых названий.
- `input_budget`: рассчитанный лимит токенов для входного контекста.

## Поддерживаемые форматы и настройки

- Языки: `ru`, `en` (настраивается через параметр `language`).
- Выходные файлы: `README.md`, `mkdocs.yml`, Markdown-разделы.
- Режимы: локальное развёртывание (`local_site`), использование кэша (`use_cache`), многопоточная обработка (`threads`).

## Обработка ошибок

Модуль обрабатывает:
- Ошибки файловой системы (чтение/запись).
- Ошибки декодирования (`UnicodeDecodeError`).
- Ошибки взаимодействия с LLM.
- Превышение лимитов контекста.

## Особенности

- Поддержка параллельной обработки через `ThreadPoolExecutor`.
- Умное кэширование для ускорения повторных запусков.
- Автоматическое удаление устаревших файлов документации.
- Интеграция с MkDocs для сборки статического сайта.

Модуль обеспечивает эффективную, масштабируемую и воспроизводимую генерацию документации для проектов любой сложности.
