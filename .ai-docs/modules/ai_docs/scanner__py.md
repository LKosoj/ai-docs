# ai_docs/scanner

/**
 * @brief Модуль отвечает за сканирование файловой системы или удалённого Git-репозитория с целью сбора информации о файлах, подходящих для анализа и документирования.
 * Учитывает пользовательские и встроенные шаблоны включения и исключения, обрабатывает конфигурацию через `.ai-docs.yaml`, игнорирует бинарные и слишком большие файлы.
 * Результат — структурированный список файлов с метаданными: путём, типом, содержимым, доменами и размером.
 *
 * Ключевые структуры данных
 * ScanResult — Результат сканирования репозитория или директории, содержащий список файлов и метаинформацию
 */

---
class ScanResult
Результат сканирования исходного кода, содержащий путь к корню, список файлов, источник и имя репозитория
Поля
root — Корневой путь сканирования
files — Список словарей с информацией о каждом файле
source — Источник сканирования (локальный путь или URL)
repo_name — Имя репозитория
Методы
__init__(self, root: Path, files: List[Dict], source: str, repo_name: str) — Инициализирует результат сканирования

---
_normalize_extensions(raw: object, defaults: Dict[str, str]) -> Dict[str, str]
Нормализует пользовательские расширения из конфигурации, добавляя точки и описания.
Аргументы
raw — Входные данные (словарь или список расширений)
defaults — Словарь описаний по умолчанию
Возвращает
Словарь вида {".ext": "описание"}

---
_normalize_excludes(raw: object) -> Set[str]
Преобразует входные данные в набор строковых шаблонов исключения.
Аргументы
raw — Список шаблонов исключения
Возвращает
Набор нормализованных шаблонов

---
_load_extension_config(root: Path) -> Dict[str, object]
Загружает или создаёт конфигурацию расширений из `.ai-docs.yaml`.
Аргументы
root — Корневая директория проекта
Возвращает
Словарь с ключами `code_extensions`, `doc_extensions`, `config_extensions`, `exclude`

---
_build_default_include_patterns(extension_config: Dict[str, object]) -> Set[str]
Формирует набор шаблонов включения на основе расширений из конфигурации.
Аргументы
extension_config — Результат `_load_extension_config`
Возвращает
Набор glob-паттернов вида `*.py`, включая фиксированные паттерны

---
_load_ignore_specs(root: Path) -> List[pathspec.PathSpec]
Загружает правила игнорирования из `.gitignore` и `.build_ignore`.
Аргументы
root — Корневая директория
Возвращает
Список компилированных PathSpec для проверки путей

---
_should_include(rel_path: str, include: Optional[Set[str]], exclude: Optional[Set[str]], ignore_specs: List[pathspec.PathSpec]) -> bool
Проверяет, должен ли файл быть включён в результат сканирования.
Аргументы
rel_path — Относительный путь к файлу в POSIX-формате
include — Набор паттернов включения (если None — все файлы включаются)
exclude — Набор паттернов исключения
ignore_specs — Список PathSpec из .gitignore и .build_ignore
Возвращает
True, если файл должен быть включён

---
_scan_directory(root: Path, include: Optional[Set[str]], exclude: Optional[Set[str]], max_size: int) -> List[Dict]
Рекурсивно сканирует директорию и возвращает список подходящих файлов.
Аргументы
root — Корневая директория для сканирования
include — Паттерны включения (по умолчанию — все)
exclude — Паттерны исключения
max_size — Максимальный размер файла в байтах (0 — без ограничения)
Возвращает
Список словарей с информацией о каждом файле (путь, содержимое, тип, домены и т.д.)

---
_clone_repo(repo_url: str) -> Tuple[Path, str]
Клонирует удалённый репозиторий в временную директорию.
Аргументы
repo_url — URL Git-репозитория
Возвращает
Кортеж из пути к временной директории и имени репозитория
Исключения
RuntimeError — Если клонирование не удалось

---
scan_source(source: str, include: Optional[Set[str]] = None, exclude: Optional[Set[str]] = None, max_size: int = 200_000) -> ScanResult
Сканирует исходный код по заданному пути или URL-адресу репозитория с фильтрацией и ограничением размера.
Аргументы
source — Путь к локальной директории или URL удалённого Git-репозитория
include — Множество шаблонов для включения файлов (по умолчанию — определяется по конфигурации)
exclude — Множество шаблонов для исключения файлов (дополняется значениями из конфигурации)
max_size — Максимальный размер файла в байтах для включения в результат
Возвращает
Объект ScanResult с информацией о просканированных файлах и метаданных источника
Исключения
FileNotFoundError — Если указанный локальный путь не существует
