# ai_docs/summary

Модуль предоставляет инструменты для нормализации, форматирования и генерации аннотированных резюме текстового содержимого файлов, включая конфигурационные и программные модули. Основная цель — приведение сгенерированного текста к строгому структурированному виду, соответствующему стандартам документации, с поддержкой очистки от Markdown-разметки, списков и других неформальных элементов. Реализована обработка через LLM-запросы с кэшированием результатов для повышения производительности.

Ключевые структуры данных  
llm_cache — словарь для кэширования ответов LLM, ускоряющий повторную обработку одинаковых запросов  
llm_client — интерфейс к языковой модели для генерации и переформатирования текста

_normalize_module_summary(summary: str, llm_client, llm_cache: Dict[str, str]) -> str  
Нормализует текст документации модуля, приводя его к строгому Doxygen-формату  
Аргументы  
summary — исходный текст описания модуля, возможно, с неформатированной разметкой  
llm_client — клиент языковой модели для переформатирования текста  
llm_cache — словарь для кэширования результатов LLM-запросов  
Возвращает  
Строка с отформатированным описанием в Doxygen-стиле  
Исключения  
Может выбросить исключение, если llm_client.chat завершится ошибкой

---
_normalize_config_summary(summary: str, llm_client, llm_cache: Dict[str, str]) -> str  
Нормализует текст описания конфигурационного файла, приводя его к универсальному формату  
Аргументы  
summary — исходный текст описания конфигурации  
llm_client — клиент языковой модели для переформатирования  
llm_cache — словарь для кэширования результатов LLM-запросов  
Возвращает  
Строка с отформатированным описанием конфигурации  
Исключения  
Может выбросить исключение при ошибке в llm_client.chat

---
_format_config_blocks(text: str) -> str  
Форматирует текст конфигурации, объединяя элементы секций через <br>, разделяя блоки пустыми строками  
Аргументы  
text — входной текст с возможными блоками "Секции и ключи" и "Важные параметры"  
Возвращает  
Отформатированный текст с правильной структурой блоков

---
_needs_doxygen_fix(text: str) -> bool  
Проверяет, содержит ли текст признаки несоответствия Doxygen-формату  
Аргументы  
text — текст для анализа на наличие Markdown, списков или заголовков  
Возвращает  
True, если текст требует переформатирования, иначе False

---
_strip_fenced_markdown(text: str) -> str  
Удаляет ограничивающие блоки Markdown-кода (```) из текста, если они присутствуют  
Аргументы  
text — текст, возможно, обёрнутый в fenced code block  
Возвращает  
Текст без ограничивающих ``` и указания языка, если было

---
chunk_text(content: str, model: str, max_tokens: int) -> List[str]  
Разбивает текст на части, не превышающие заданное количество токенов  
Аргументы  
content — входной текст для разбиения  
model — название модели, используемой для оценки длины токенов  
max_tokens — максимальное количество токенов в одном чанке  
Возвращает  
Список строк, каждая из которых представляет собой часть исходного текста

---
summarize_file(content: str, file_type: str, domains: List[str], llm_client, llm_cache: Dict[str, str], model: str, detailed: bool = False) -> str  
Генерирует краткое или детальное резюме содержимого файла с учётом его типа и доменной области  
Аргументы  
content — текстовое содержимое файла  
file_type — тип файла (например, "config", "infra", "module")  
domains — список доменов, к которым относится файл  
llm_client — клиент для взаимодействия с языковой моделью  
llm_cache — словарь для кэширования ответов LLM  
model — модель, используемая для генерации  
detailed — флаг, указывающий, требуется ли детализированное резюме  
Возвращает  
Сгенерированное резюме в виде строки в формате Markdown

---
write_summary(summary_dir: Path, rel_path: str, summary: str) -> Path  
Сохраняет сгенерированное резюме в файл Markdown в указанной директории  
Аргументы  
summary_dir — директория для сохранения резюме  
rel_path — относительный путь к исходному файлу (используется для формирования имени)  
summary — текст резюме для сохранения  
Возвращает  
Путь к созданному файлу с резюме
