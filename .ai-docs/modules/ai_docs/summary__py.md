# ai_docs/summary

Модуль предоставляет инструменты для генерации и нормализации документации на основе содержимого файлов. Поддерживает формирование кратких описаний для различных типов файлов — модулей, конфигураций, инфраструктурных файлов — с учётом доменов и детализации. Реализованы функции для проверки и переформатирования текста документации в строгий Doxygen- или конфиг-стиль с использованием LLM. Текст очищается от Markdown-разметки и приводится к единому формату для последующего использования в системах документирования.

Ключевые структуры данных  
llm_cache — словарь для кэширования ответов LLM, ключ — хеш запроса, значение — сгенерированный текст  
Path — Объект пути к файлу или директории (из pathlib.Path)

_summarize_chunk  
Формирует промпт и отправляет запрос к LLM для генерации описания фрагмента содержимого файла  
Аргументы  
chunk — текст фрагмента файла для анализа  
file_type — тип файла (например, "config", "module", "infra")  
domains — список доменов, к которым относится файл  
detailed — флаг, указывающий на необходимость детализированного описания  
llm_client — клиент для взаимодействия с языковой моделью  
llm_cache — кэш для хранения ранее сгенерированных ответов  
model — модель языковой модели, используемая для генерации  
Возвращает  
Строку с описанием фрагмента в требуемом формате

---
_needs_doxygen_fix  
Проверяет, содержит ли текст признаки, требующие нормализации в Doxygen-стиль  
Аргументы  
text — текст для проверки  
Возвращает  
True, если текст содержит Markdown, списки, заголовки или другие нежелательные элементы

---
_normalize_module_summary  
Приводит текст описания модуля к строгому Doxygen-формату с помощью LLM  
Аргументы  
summary — исходный текст описания модуля  
llm_client — клиент для взаимодействия с языковой моделью  
llm_cache — кэш для хранения ранее сгенерированных ответов  
Возвращает  
Нормализованный текст в Doxygen-стиле

---
_normalize_config_summary  
Приводит текст описания конфигурационного файла к универсальному конфиг-формату с помощью LLM  
Аргументы  
summary — исходный текст описания конфигурационного файла  
llm_client — клиент для взаимодействия с языковой моделью  
llm_cache — кэш для хранения ранее сгенерированных ответов  
Возвращает  
Нормализованный текст в конфиг-стиле

---
_strip_fenced_markdown  
Удаляет ограничивающие блоки ``` из текста, если они присутствуют  
Аргументы  
text — входной текст, возможно, обёрнутый в блоки кода  
Возвращает  
Текст без начальных и конечных маркеров ``` и пробельных символов по краям

---
summarize_file  
Генерирует сводное описание файла, разбивая его содержимое на фрагменты и обрабатывая их с помощью LLM  
Аргументы  
content — полное содержимое файла в виде строки  
file_type — тип файла (например, "config", "module", "infra")  
domains — список доменов, к которым принадлежит файл  
llm_client — клиент для взаимодействия с языковой моделью  
llm_cache — кэш для хранения ранее сгенерированных ответов  
model — модель языковой модели, используемая для генерации  
detailed — флаг детализированного режима (по умолчанию False)  
Возвращает  
Строку с итоговым описанием файла в соответствующем формате (Doxygen или конфиг-стиль)

---
def summarize_chunks(chunks: list[str], llm_client, llm_cache, detailed: bool = False, file_type: str = "module") -> str  
Объединяет фрагменты текста в единое резюме с помощью LLM.  
Аргументы  
chunks — Список строк, представляющих фрагменты исходного текста  
llm_client — Клиент для взаимодействия с моделью LLM  
llm_cache — Кэш для повторных запросов к LLM  
detailed — Флаг, указывающий, требуется ли детализированное резюме  
file_type — Тип обрабатываемого файла ("config" или "module")  
Возвращает  
Строка с итоговым резюме в формате Markdown  
Исключения  
Может выбрасывать исключения, связанные с работой llm_client

---
def write_summary(summary_dir: Path, rel_path: str, summary: str) -> Path  
Сохраняет резюме в файл Markdown с безопасным именем в указанной директории.  
Аргументы  
summary_dir — Директория для сохранения резюме  
rel_path — Относительный путь к исходному файлу (используется для генерации имени)  
summary — Текст резюме в формате Markdown  
Возвращает  
Путь к созданному файлу с резюме
