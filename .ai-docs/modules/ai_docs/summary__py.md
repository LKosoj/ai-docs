# ai_docs/summary

Модуль предоставляет инструменты для генерации и нормализации документации на основе текстового описания, включая поддержку форматирования под Doxygen и универсальный стиль для конфигурационных файлов. Реализованы функции для проверки и коррекции структуры сгенерированного текста с использованием LLM, а также для извлечения и структурирования ключевой информации из конфигураций и модулей. Поддерживается кэширование запросов к LLM для повышения эффективности при повторной обработке.

Ключевые структуры данных  
llm_cache — словарь для кэширования ответов LLM по ключу запроса  
file_type — строка, определяющая тип файла (например, "config", "infra", "module")  
domains — список строк, указывающих доменные зоны, к которым относится файл

async def _summary(summary: str, llm_client, llm_cache: dict) -> str  
Асинхронно генерирует краткое описание файла с использованием LLM  
Аргументы  
summary — исходный текст описания  
llm_client — клиент для взаимодействия с языковой моделью  
llm_cache — кэш для хранения и повторного использования ответов LLM  
Возвращает  
Нормализованный текст описания в требуемом формате  
Исключения  
Может выбрасывать исключения, связанные с выполнением асинхронного вызова LLM

---
async def _normalize_module_summary(summary: str, llm_client, llm_cache: dict) -> str  
Асинхронно нормализует текст описания модуля к строгому Doxygen-формату  
Аргументы  
summary — исходный текст описания модуля  
llm_client — клиент для взаимодействия с языковой моделью  
llm_cache — кэш для хранения и повторного использования ответов LLM  
Возвращает  
Текст, отформатированный в соответствии с Doxygen-стилем  
Исключения  
Может выбрасывать исключения, связанные с выполнением асинхронного вызова LLM

---
async def _normalize_config_summary(summary: str, llm_client, llm_cache: dict) -> str  
Асинхронно нормализует текст описания конфигурационного файла к универсальному формату  
Аргументы  
summary — исходный текст описания конфигурации  
llm_client — клиент для взаимодействия с языковой моделью  
llm_cache — кэш для хранения и повторного использования ответов LLM  
Возвращает  
Текст, отформатированный в соответствии с универсальным конфиг-стилем  
Исключения  
Может выбрасывать исключения, связанные с выполнением асинхронного вызова LLM

---
def _format_config_blocks(text: str) -> str  
Форматирует текст конфигурационного описания, объединяя элементы в секции через `<br>`  
Аргументы  
text — входной текст с описанием конфигурации  
Возвращает  
Отформатированный текст с корректными разрывами секций

---
def _strip_fenced_markdown(text: str) -> str  
Удаляет ограничивающие блоки Markdown-кода из текста  
Аргументы  
text — текст, возможно содержащий обрамление ```markdown или ```  
Возвращает  
Текст без блоков кода, очищенный от обрамления

---
async def summarize_file(content: str, file_type: str, domains: List[str], llm_client, llm_cache: Dict[str, str], model: str, detailed: bool = False) -> str  
Генерирует краткое или детализированное резюме содержимого файла с использованием LLM  
Аргументы  
content — исходное содержимое файла для анализа  
file_type — тип файла (например, "config", "infra", "module"), влияет на выбор промпта  
domains — список доменов, к которым относится файл; используется при генерации промптов  
llm_client — клиент для взаимодействия с языковой моделью  
llm_cache — кэш для хранения ранее полученных ответов от LLM  
model — имя модели, используемой для определения максимального размера чанков  
detailed — флаг, указывающий, требуется ли детализированное резюме  
Возвращает  
Строка с итоговым резюме в формате Markdown  
Исключения  
Может выбрасывать исключения, связанные с сетевым взаимодействием через llm_client

---
def write_summary(summary_dir: Path, rel_path: str, summary: str) -> Path  
Сохраняет сгенерированное резюме в файл Markdown в указанной директории  
Аргументы  
summary_dir — путь к директории, куда сохраняются резюме  
rel_path — относительный путь к исходному файлу, используется для формирования имени выходного файла  
summary — текст резюме, который необходимо сохранить  
Возвращает  
Путь к созданному файлу с резюме
