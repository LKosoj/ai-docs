# Соглашения

При работе с `ai_docs` соблюдайте следующие соглашения для обеспечения согласованности, предсказуемости и эффективности генерации документации.

## Именование и структура файлов

- Все сгенерированные файлы используют **нижний регистр** и **kebab-case** в названиях:  
  `architecture.md`, `deployment-guide.md`, `ci-cd-pipeline.md`.
- Структура выходной директории:
  ```
  .ai-docs/
  ├── modules/          # Документация по модулям
  ├── configs/          # Описание конфигурационных файлов
  ├── index.md          # Главная страница документации
  ├── architecture.md
  ├── testing.md
  └── changes.md        # Отчёт об изменениях
  ```
- Служебные директории:
  - `.ai_docs_cache/` — кэш LLM и метаданных (не коммитится).
  - `ai_docs_site/` — собранный MkDocs-сайт (может коммититься при необходимости).

## Форматирование Markdown

- Используется **CommonMark** с поддержкой GitHub Flavored Markdown (GFM).
- Заголовки: один пробел после `#`, например: `## Архитектура`.
- Кодовые блоки всегда с указанием языка:
  ```yaml
  image: nginx:1.21
  ports:
    - "80:80"
  ```
- Диаграммы Mermaid вставляются через:
  ````markdown
  ```mermaid
  graph TD
    A[Start] --> B[Process]
  ```
  ````
- Списки: один пробел после `-` или `*`, вложенные списки — отступ 2 пробела.

## Классификация файлов

Тип файла определяется автоматически по:
- Расширению (из `CODE_EXTENSIONS`, `CONFIG_EXTENSIONS` и др.).
- Имени (`Dockerfile`, `Makefile`, `.github/workflows/*.yml`).
- Расположению (`terraform/`, `k8s/`, `docs/`).

Примеры:
- `.py`, `.js`, `.go` → `code`
- `.yaml`, `.tf`, `.json` → `config`
- `README.md`, `docs/*.md` → `doc`

## Обработка изменений

- При запуске `ai_docs` сравнивает хэши файлов с предыдущим состоянием (через `CacheManager`).
- Изменения фиксируются в `changes.md`:
  - Добавленные, изменённые, удалённые файлы.
  - Перегенерированные разделы (если указан `--regen`).
- Ручная правка сгенерированных файлов **не рекомендуется**. Вместо этого:
  - Обновите исходный код или конфигурацию.
  - Перезапустите `ai_docs` с нужными флагами.

## Работа с кэшем

- Кэш LLM-ответов хранится в `.ai_docs_cache/llm_cache.json`.
- Для принудительного обновления:
  - `--no-cache` — отключает кэш LLM.
  - `--regen configs` — перегенерирует только конфигурации.
  - `--force` — перезаписывает `README.md`.
- При CI/CD используйте кэширование директории `.ai_docs_cache` для ускорения сборки.

## Язык и локализация

- Язык документации задаётся через `--language ru|en`.
- Все сгенерированные заголовки и описания соответствуют выбранному языку.
- Ключевые термины (например, `Kubernetes`, `Terraform`) не переводятся.

## Интеграция в CI/CD

Пример для GitHub Actions:
```yaml
- name: Generate Docs
  run: |
    ai-docs --source . --readme --mkdocs --language ru
  env:
    OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
    AI_DOCS_THREADS: 4
```

- Убедитесь, что `OPENAI_API_KEY` задан.
- Рекомендуется кэшировать `.ai_docs_cache` между запусками.

## Пользовательские настройки

Конфигурация через `.ai-docs.yaml`:
```yaml
code_extensions:
  .py: Python
  .sh: Bash

exclude:
  - temp/*
  - *.log

config_extensions:
  .yaml: YAML
  .tf: Terraform
```

- Файл `.ai-docs.yaml` коммитится в репозиторий.
- Пользовательские исключения дополняют стандартные (`.git`, `node_modules`, `.venv` и др.).

Соблюдение этих соглашений гарантирует стабильную и предсказуемую работу `ai_docs` в любых проектах.
