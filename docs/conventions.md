# Соглашения

```markdown
# Соглашения

## Файловая структура
После запуска `ai_docs` в корне проекта или в указанной директории вывода создаются:
- `README.md` — краткое описание проекта.
- `docs/` — полная документация в формате Markdown.
- `mkdocs.yml` — конфигурация для сборки сайта.
- `ai_docs_site/` — статический сайт (результат `mkdocs build`).
- `.ai_docs_cache/` — кэш метаданных и LLM-ответов (не удалять для инкрементальной генерации).

## Именование и пути
- Все пути внутри документации используют формат POSIX (`/` как разделитель).
- Имена файлов в `docs/` нормализуются: кириллица и спецсимволы заменяются на `_`, строка приводится к нижнему регистру.
- Секции документации сохраняются как `docs/<slug>.md`, где `slug` — безопасный идентификатор.

## Кэширование
- Кэширование включено по умолчанию, отключается флагом `--no-cache`.
- Используется два файла в `.ai_docs_cache/`:
  - `index.json` — хранит хэши файлов и структуру проекта.
  - `llm_cache.json` — хранит ответы LLM по хешу запроса.
- При повторном запуске обрабатываются только изменённые или новые файлы.
- Кэш LLM потокобезопасен, поддерживает параллельную обработку.

## Фильтрация файлов
- Автоматически исключаются:
  - `.venv`, `venv`, `node_modules`, `dist`, `build`, `__pycache__`.
  - Директории и файлы, указанные в `.gitignore`.
  - Символические ссылки.
- Фильтры можно переопределить через:
  - `--include` — glob-паттерны для включения.
  - `--exclude` — glob-паттерны для исключения.
  - `--max-size` — максимальный размер файла (по умолчанию 200 КБ).

## Типы файлов и домены
Классификация выполняется по расширению, имени и содержимому:
- **Типы**: `code`, `docs`, `config`, `data`, `infra`, `ci`, `other`.
- **Домены**: `kubernetes`, `helm`, `terraform`, `ansible`, `docker`, `ci`.
- Файл помечается как `infra`, если содержит хотя бы один инфраструктурный домен.

## Генерация документации
- Поддерживаемые языки: `ru` (по умолчанию), `en` (через `--language`).
- Разделы в `mkdocs.yml` формируются динамически:
  - Всегда включаются: "Главная", "Архитектура", "Запуск", "Зависимости", "Изменения".
  - Дополнительно — "Конфиги" (если обнаружены соответствующие файлы).
- При `--local-site` в `mkdocs.yml` устанавливаются:
  ```yaml
  use_directory_urls: false
  site_url: /
  ```

## Отчёт об изменениях
Файл `docs/changes.md` генерируется автоматически и содержит:
- Добавленные, изменённые, удалённые файлы.
- Перегенерированные разделы.
- Краткое резюме изменений.
- Элементы сортируются по алфавиту.

## Переменные окружения
| Переменная               | Назначение                                  | По умолчанию         |
|--------------------------|---------------------------------------------|----------------------|
| `OPENAI_API_KEY`         | Ключ доступа к LLM                          | Обязательна          |
| `OPENAI_BASE_URL`        | Базовый URL API                             | `https://api.openai.com/v1` |
| `OPENAI_MODEL`           | Модель LLM                                  | `gpt-4o-mini`        |
| `OPENAI_TEMPERATURE`     | Температура генерации                       | `0.2`                |
| `OPENAI_MAX_TOKENS`      | Макс. токенов в ответе                      | `1200`               |
| `OPENAI_CONTEXT_TOKENS`  | Лимит контекста                             | `8192`               |
| `AI_DOCS_THREADS`        | Количество потоков                          | `4`                  |
| `AI_DOCS_LOCAL_SITE`     | Режим локального сайта (bool)               | `false`              |
```
