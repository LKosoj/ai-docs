<!DOCTYPE html>

<html data-bs-theme="light" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="img/favicon.ico" rel="shortcut icon"/>
<title>Обзор проекта - ai-docs</title>
<link href="css/bootstrap.min.css" rel="stylesheet"/>
<link href="css/fontawesome.min.css" rel="stylesheet"/>
<link href="css/brands.min.css" rel="stylesheet"/>
<link href="css/solid.min.css" rel="stylesheet"/>
<link href="css/v4-font-face.min.css" rel="stylesheet"/>
<link href="css/base.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" id="hljs-light" rel="stylesheet"/>
<link disabled="" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" id="hljs-dark" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
</head>
<body>
<div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
<div class="container">
<a class="navbar-brand" href="index.html">ai-docs</a>
<!-- Expander button -->
<button aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-bs-target="#navbar-collapse" data-bs-toggle="collapse" type="button">
<span class="navbar-toggler-icon"></span>
</button>
<!-- Expanded navigation -->
<div class="navbar-collapse collapse" id="navbar-collapse">
<!-- Main navigation -->
<ul class="nav navbar-nav">
<li class="nav-item">
<a class="nav-link" href="index.html">Главная</a>
</li>
<li class="nav-item dropdown">
<a aria-current="page" aria-expanded="false" class="nav-link dropdown-toggle active" data-bs-toggle="dropdown" href="#" role="button">Обзор</a>
<ul class="dropdown-menu">
<li>
<a aria-current="page" class="dropdown-item active" href="overview.html">Обзор проекта</a>
</li>
</ul>
</li>
<li class="nav-item">
<a class="nav-link" href="architecture.html">Архитектура</a>
</li>
<li class="nav-item">
<a class="nav-link" href="runtime.html">Запуск</a>
</li>
<li class="nav-item">
<a class="nav-link" href="dependencies.html">Зависимости</a>
</li>
<li class="nav-item">
<a class="nav-link" href="testing.html">Тестирование</a>
</li>
<li class="nav-item">
<a class="nav-link" href="conventions.html">Соглашения</a>
</li>
<li class="nav-item">
<a class="nav-link" href="glossary.html">Глоссарий</a>
</li>
<li class="nav-item dropdown">
<a aria-expanded="false" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button">Конфигурация проекта</a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="configs/index.html">Обзор</a>
</li>
<li>
<a class="dropdown-item" href="configs/files/pyproject__toml.html">pyproject.toml</a>
</li>
</ul>
</li>
<li class="nav-item dropdown">
<a aria-expanded="false" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button">Модули</a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="modules/index.html">Обзор</a>
</li>
<li class="dropdown-submenu">
<a class="dropdown-item" href="#">/ai_docs</a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="modules/ai_docs/__init____py.html">__init__.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/__main____py.html">__main__.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/cache__py.html">cache.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/changes__py.html">changes.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/cli__py.html">cli.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/domain__py.html">domain.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/generator__py.html">generator.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/generator_cache__py.html">generator_cache.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/generator_output__py.html">generator_output.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/generator_sections__py.html">generator_sections.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/generator_shared__py.html">generator_shared.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/generator_summarize__py.html">generator_summarize.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/llm__py.html">llm.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/mkdocs__py.html">mkdocs.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/scanner__py.html">scanner.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/summary__py.html">summary.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/tokenizer__py.html">tokenizer.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/utils__py.html">utils.py</a>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-item">
<a class="nav-link" href="changes.html">Изменения</a>
</li>
</ul>
<ul class="nav navbar-nav ms-md-auto">
<li class="nav-item">
<a class="nav-link" data-bs-target="#mkdocs_search_modal" data-bs-toggle="modal" href="#">
<i class="fa fa-search"></i> Search
                            </a>
</li>
<li class="nav-item">
<a class="nav-link" href="index.html" rel="prev">
<i class="fa fa-arrow-left"></i> Previous
                                </a>
</li>
<li class="nav-item">
<a class="nav-link" href="architecture.html" rel="next">
                                    Next <i class="fa fa-arrow-right"></i>
</a>
</li>
</ul>
</div>
</div>
</div>
<div class="container">
<div class="row">
<div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
<div class="navbar-header">
<button class="navbar-toggler collapsed" data-bs-target="#toc-collapse" data-bs-toggle="collapse" title="Table of Contents" type="button">
<span class="fa fa-angle-down"></span>
</button>
</div>
<div class="navbar-collapse collapse card bg-body-tertiary" id="toc-collapse">
<ul class="nav flex-column">
<li class="nav-item" data-bs-level="1"><a class="nav-link" href="#_1">Обзор проекта</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="1"><a class="nav-link" href="#ai_docs-cli-">ai_docs — CLI-инструмент генерации технической документации</a>
<ul class="nav flex-column">
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_2">Основные возможности</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_3">Структура проекта</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_4">Конфигурация</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_5">Переменные окружения</a>
<ul class="nav flex-column">
</ul>
</li>
</ul>
</li>
<li class="nav-item" data-bs-level="1"><a class="nav-link" href="#ai_docs">ai_docs — Генерация технической документации из кода</a>
<ul class="nav flex-column">
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_6">Особенности</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_7">Выходные артефакты</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_8">Переменные окружения</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#cli-">CLI-опции</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_9">Интеграция</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_10">Дополнительно</a>
<ul class="nav flex-column">
</ul>
</li>
</ul>
</li>
<li class="nav-item" data-bs-level="1"><a class="nav-link" href="#llm">Резюме: Асинхронная генерация аннотаций с использованием LLM</a>
<ul class="nav flex-column">
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_11">Ключевые функции</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_12">Настройки и параметры</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_13">Пути сохранения</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_14">Особенности реализации</a>
<ul class="nav flex-column">
</ul>
</li>
</ul>
</li>
<li class="nav-item" data-bs-level="1"><a class="nav-link" href="#_15">Обзор модуля сканирования репозиториев</a>
<ul class="nav flex-column">
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_16">Основные компоненты</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_17">Конфигурация и фильтрация</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_18">Функции</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_19">Результат</a>
<ul class="nav flex-column">
</ul>
</li>
</ul>
</li>
<li class="nav-item" data-bs-level="1"><a class="nav-link" href="#_20">Резюме: Генерация технической документации</a>
<ul class="nav flex-column">
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_21">Ключевые возможности</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_22">Ключевые сущности</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_23">Важные настройки</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_24">Особенности</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_25">Результат</a>
<ul class="nav flex-column">
</ul>
</li>
</ul>
</li>
<li class="nav-item" data-bs-level="1"><a class="nav-link" href="#_26">Резюме модуля обработки технической документации</a>
<ul class="nav flex-column">
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_27">Назначение</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_28">Основные функции</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_29">Ключевые структуры</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_30">Вспомогательные функции</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_31">Использование</a>
<ul class="nav flex-column">
</ul>
</li>
</ul>
</li>
<li class="nav-item" data-bs-level="1"><a class="nav-link" href="#_32">Резюме документации</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="1"><a class="nav-link" href="#_33">Резюме документации</a>
<ul class="nav flex-column">
</ul>
</li>
</ul>
</div>
</div></div>
<div class="col-md-9" role="main">
<h1 id="_1">Обзор проекта</h1>
<h1 id="ai_docs-cli-"><code>ai_docs</code> — CLI-инструмент генерации технической документации</h1>
<p><code>ai_docs</code> — инструмент командной строки для автоматической генерации технической документации по исходному коду и конфигурационным файлам. Поддерживает анализ локальных директорий, локальных и удалённых Git-репозиториев.</p>
<h2 id="_2">Основные возможности</h2>
<ul>
<li>Автоматическое определение доменов: Kubernetes, Helm, Terraform, Ansible, Docker, CI/CD, Observability, Service Mesh / Ingress, Data / Storage.</li>
<li>Генерация <code>README.md</code> и полноценного MkDocs-сайта.</li>
<li>Инкрементальная обработка с кэшированием в <code>.ai_docs_cache/</code> и логом изменений в <code>docs/changes.md</code>.</li>
<li>Учёт <code>.gitignore</code>, <code>.build_ignore</code> и встроенных исключений (<code>.venv</code>, <code>node_modules</code>, <code>.ai-docs</code>, <code>dist</code> и др.).</li>
<li>Параллельная обработка файлов (настраивается через <code>AI_DOCS_THREADS</code>).</li>
</ul>
<h2 id="_3">Структура проекта</h2>
<ul>
<li><code>.ai-docs/</code> — сгенерированная документация (<code>overview.md</code>, <code>changes.md</code>, модули, конфиги, <code>_index.json</code>).</li>
<li><code>mkdocs.yml</code>, <code>ai_docs_site/</code> — конфигурация и собранный сайт документации.</li>
<li><code>.ai-docs/_index.json</code> — навигационный индекс с маршрутами и приоритетами.</li>
</ul>
<h2 id="_4">Конфигурация</h2>
<ul>
<li><code>.ai-docs.yaml</code> — опциональный файл для настройки расширений:</li>
<li><code>code_extensions</code>: сопоставление расширений с языками (напр., <code>.py</code> → <code>Python</code>).</li>
<li><code>doc_extensions</code>: расширения документации (<code>.md</code>, <code>.rst</code>).</li>
<li><code>config_extensions</code>: конфиги (<code>.yml</code>, <code>.json</code>).</li>
<li><code>exclude</code>: шаблоны исключений (напр., <code>temp/*</code>, <code>*.log</code>).</li>
<li>При отсутствии — создаётся автоматически.</li>
</ul>
<h2 id="_5">Переменные окружения</h2>
<table>
<thead>
<tr>
<th>Переменная</th>
<th>Назначение</th>
<th>По умолчанию</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>OPENAI_API_KEY</code></td>
<td>Ключ доступа к LLM</td>
<td>—</td>
</tr>
<tr>
<td><code>OPENAI_MODEL</code></td>
<td>Модель для суммаризации</td>
<td><code>gpt-4o-mini</code></td>
</tr>
<tr>
<td><code>OPENAI_MAX_TOKENS</code></td>
<td>Макс. токенов в ответе</td>
<td>—</td>
</tr>
<tr>
<td><code>OPENAI_CONTEXT_TOKENS</code></td>
<td>Макс. длина контекста</td>
<td>—</td>
</tr>
<tr>
<td><code>OPENAI_TEMPERATURE</code></td>
<td>Температура генерации</td>
<td>—</td>
</tr>
<tr>
<td><code>AI_DOCS_THREADS</code></td>
<td>Число потоков обработки</td>
<td>—</td>
</tr>
<tr>
<td><code>AI_DOCS_LOCAL_SITE</code></td>
<td>Локальный запуск MkDocs</td>
<td><code>false</code></td>
</tr>
</tbody>
</table>
<p>Инструмент интегрируется в CI/CD и поддерживает повторяемую, актуальную документацию на основе кода.</p>
<h1 id="ai_docs"><code>ai_docs</code> — Генерация технической документации из кода</h1>
<p>CLI-инструмент <code>ai_docs</code> автоматически создаёт техническую документацию из исходного кода и конфигурационных файлов. Поддерживает локальные директории, локальные и удалённые Git-репозитории. Основные выходные артефакты — <code>README.md</code> и полноценный сайт документации на основе MkDocs.</p>
<h2 id="_6">Особенности</h2>
<ul>
<li>Автоматическое определение доменов: Kubernetes, Helm, Terraform, Ansible, Docker, CI/CD, Observability, Service Mesh, Data/Storage.</li>
<li>Поддержка множества языков (Python, JS/TS, Go, Java, C++, Rust и др.) по расширениям файлов.</li>
<li>Учёт <code>.gitignore</code>, <code>.build_ignore</code> и стандартных исключений (<code>.venv</code>, <code>node_modules</code>, <code>dist</code>, <code>build</code>, <code>.ai-docs</code>, <code>.ai_docs_cache</code>, <code>ai_docs_site</code> и др.).</li>
<li>Параллельная обработка с настраиваемым числом потоков (<code>--threads</code> / <code>AI_DOCS_THREADS</code>).</li>
<li>Инкрементальная генерация с кэшированием; отчёт об изменениях — <code>docs/changes.md</code>.</li>
<li>Поддержка <code>.ai-docs.yaml</code> для кастомизации сканирования (расширения, приоритеты, исключения).</li>
</ul>
<h2 id="_7">Выходные артефакты</h2>
<ul>
<li><code>README.md</code> — краткое описание проекта.</li>
<li><code>.ai-docs/</code> — структурированные страницы документации.</li>
<li><code>.ai-docs/_index.json</code> — навигационный индекс.</li>
<li><code>mkdocs.yml</code> — конфигурация MkDocs.</li>
<li><code>ai_docs_site/</code> — собранная документация.</li>
<li><code>.ai_docs_cache/</code> — кэш LLM-запросов.</li>
</ul>
<h2 id="_8">Переменные окружения</h2>
<div class="highlight"><pre><span></span><code><span class="nv">OPENAI_API_KEY</span><span class="o">=</span>...<span class="w">                </span><span class="c1"># обязательный ключ API</span>
<span class="nv">OPENAI_BASE_URL</span><span class="o">=</span>...<span class="w">               </span><span class="c1"># опциональный URL (по умолчанию OpenAI)</span>
<span class="nv">OPENAI_MODEL</span><span class="o">=</span>gpt-4o-mini<span class="w">          </span><span class="c1"># модель LLM</span>
<span class="nv">OPENAI_MAX_TOKENS</span><span class="o">=</span><span class="m">4096</span><span class="w">            </span><span class="c1"># лимит токенов</span>
<span class="nv">OPENAI_CONTEXT_TOKENS</span><span class="o">=</span><span class="m">32768</span><span class="w">       </span><span class="c1"># контекстные токены</span>
<span class="nv">OPENAI_TEMPERATURE</span><span class="o">=</span><span class="m">0</span>.3<span class="w">            </span><span class="c1"># креативность</span>
<span class="nv">AI_DOCS_THREADS</span><span class="o">=</span><span class="m">4</span><span class="w">                 </span><span class="c1"># число потоков</span>
<span class="nv">AI_DOCS_LOCAL_SITE</span><span class="o">=</span><span class="nb">true</span><span class="w">           </span><span class="c1"># локальный режим MkDocs (без публикации)</span>
</code></pre></div>
<h2 id="cli-">CLI-опции</h2>
<ul>
<li><code>--source</code> — путь или URL к проекту.</li>
<li><code>--readme</code> / <code>--mkdocs</code> — тип генерации.</li>
<li><code>--language ru/en</code> — язык документации.</li>
<li><code>--force</code> — перезапись файлов.</li>
<li><code>--regen</code> — перегенерация указанных разделов.</li>
<li><code>--local-site</code> — настройка MkDocs для локального хостинга.</li>
<li><code>--no-cache</code> — отключение кэширования.</li>
</ul>
<h2 id="_9">Интеграция</h2>
<p>Поддерживается в CI/CD (например, GitHub Actions) через установку <code>ai-docs-gen</code> и передачу переменных окружения. Сборка сайта: <code>mkdocs build -f mkdocs.yml</code>.</p>
<h2 id="_10">Дополнительно</h2>
<ul>
<li><code>/index.md</code> разбивается на страницы по 100 элементов с навигацией ←/→.</li>
<li>Для разработки: <code>python -m ai_docs ...</code>, зависимости — см. «Quick start».</li>
<li>Лицензия: MIT.</li>
<li>Приветствуются pull request'ы и предложения.</li>
</ul>
<p>Файл <code>pyproject.toml</code> определяет метаданные и конфигурацию сборки Python-пакета <code>ai-docs-gen</code> — CLI-инструмента для автоматической генерации технической документации по исходному коду и конфигурационным файлам.  </p>
<p>В секции <code>build-system</code> указаны зависимости для сборки: <code>setuptools&gt;=68</code> и <code>wheel</code>, а также бэкенд сборки <code>setuptools.build_meta</code>.  </p>
<p>Основные метаданные проекта находятся в секции <code>project</code>:<br/>
- <strong>name</strong>: <code>ai-docs-gen</code><br/>
- <strong>version</strong>: <code>0.1.9</code><br/>
- <strong>description</strong>: краткое описание назначения пакета<br/>
- <strong>readme</strong>: ссылка на файл <code>README.md</code><br/>
- <strong>requires-python</strong>: минимальная версия Python — 3.8<br/>
- <strong>dependencies</strong>: список зависимостей, включая <code>openai</code>, <code>pyyaml</code>, <code>mkdocs</code> и плагины для расширения функциональности документации (Mermaid, Markdown-расширения)  </p>
<p>Секция <code>project.scripts</code> объявляет консольную команду <code>ai-docs</code>, которая запускает функцию <code>main</code> из модуля <code>ai_docs.cli</code>.  </p>
<p>В <code>tool.setuptools.packages.find</code> указано, что при автоматическом поиске пакетов включается <code>ai_docs</code>, но исключается поддиректория <code>assets</code>.  </p>
<p>В <code>tool.setuptools.package-data</code> определено, что в пакет необходимо включить файл <code>assets/mermaid.min.js</code>, используемый для визуализации диаграмм в документации.</p>
<h1 id="llm">Резюме: Асинхронная генерация аннотаций с использованием LLM</h1>
<p>Файл предназначен для асинхронной обработки и генерации сводок (аннотаций) для различных типов файлов — кода, конфигураций и модулей — с помощью языковых моделей (LLM). Поддерживает параллельную обработку с ограничением числа одновременных задач через <code>asyncio.Semaphore</code>.</p>
<h2 id="_11">Ключевые функции</h2>
<ul>
<li><strong><code>summarize_changed_*</code></strong>: Обработка изменённых файлов (файлы, модули, конфиги).</li>
<li><strong><code>summarize_missing_*</code></strong>: Генерация сводок для файлов без существующих аннотаций.</li>
<li><strong><code>summarize_file</code></strong>: Основная функция генерации аннотации; флаг указывает на тип (модульную или файловую).</li>
<li><strong><code>write_summary</code></strong>: Сохранение результата в файл.</li>
<li><strong><code>is_test_path</code></strong>: Фильтрация тестовых файлов при обработке модулей.</li>
</ul>
<h2 id="_12">Настройки и параметры</h2>
<ul>
<li><strong><code>threads</code></strong>: Максимальное число параллельных задач.</li>
<li><strong><code>llm</code> / <code>llm_cache</code></strong>: Модель для генерации и кэширование результатов.</li>
<li><strong><code>save_cb</code></strong>: Колбэк после успешной обработки файла.</li>
<li><strong><code>errors</code></strong>: Сбор ошибок в процессе выполнения.</li>
<li><strong><code>log_every</code></strong>: Логирование прогресса каждые 5 задач или по завершении.</li>
</ul>
<h2 id="_13">Пути сохранения</h2>
<ul>
<li><code>summaries_dir</code> — общие сводки.</li>
<li><code>module_summaries_dir</code> — сводки по модулям.</li>
<li><code>config_summaries_dir</code> — конфигурационные сводки (записывается в <code>meta["config_summary_path"]</code>).</li>
</ul>
<h2 id="_14">Особенности реализации</h2>
<ul>
<li>Асинхронная обработка через <code>run_one</code>.</li>
<li>Синхронизация доступа к ресурсам через <code>lock</code>.</li>
<li>Поддержка кэширования для оптимизации.</li>
<li>Фильтрация тестовых путей.</li>
<li>Периодический вывод прогресса и накопление ошибок.</li>
</ul>
<h1 id="_15">Обзор модуля сканирования репозиториев</h1>
<p>Модуль предназначен для сканирования и анализа структуры репозиториев с целью извлечения информации, пригодной для генерации документации.</p>
<h2 id="_16">Основные компоненты</h2>
<ul>
<li><strong><code>ScanResult</code></strong> — основной класс, содержащий результаты сканирования: список файлов с метаданными (путь, размер, тип, домены, первые 4000 символов содержимого), корневой путь, исходный URL/путь и имя репозитория.</li>
</ul>
<h2 id="_17">Конфигурация и фильтрация</h2>
<ul>
<li><strong>Шаблоны включения</strong>: <code>FIXED_INCLUDE_PATTERNS</code> — фиксированный набор файлов, всегда включаемых в сканирование (например, <code>Dockerfile</code>, <code>*.tf</code>, <code>package.json</code>).</li>
<li><strong>Шаблоны исключения</strong>: <code>DEFAULT_EXCLUDE_PATTERNS</code> — стандартные пути, исключаемые по умолчанию (<code>.git</code>, <code>node_modules</code>, <code>.venv</code>, <code>__pycache__</code> и др.).</li>
<li>Поддержка пользовательских правил из:</li>
<li><code>.ai-docs.yaml</code> — основной конфигурационный файл (создаётся по умолчанию при отсутствии).</li>
<li><code>.gitignore</code>, <code>.build_ignore</code> — обрабатываются через <code>pathspec</code>.</li>
<li><strong>Расширения файлов</strong>:</li>
<li><code>code_extensions</code>, <code>doc_extensions</code>, <code>config_extensions</code> — пользовательские расширения с описанием типов файлов.</li>
<li><strong><code>exclude</code></strong> — пользовательские шаблоны исключений, дополняющие стандартные.</li>
</ul>
<h2 id="_18">Функции</h2>
<ul>
<li><strong><code>_clone_repo</code></strong> — клонирует удалённый Git-репозиторий во временную директорию для сканирования.</li>
<li><strong><code>scan_source</code></strong> — основная функция для анализа:</li>
<li>Принимает <code>source</code> (локальный путь или URL репозитория).</li>
<li>Автоматически определяет тип источника.</li>
<li>При необходимости клонирует репозиторий.</li>
<li>Загружает конфигурацию через <code>_load_extension_config</code>.</li>
<li>Рекурсивно сканирует файлы с помощью <code>_scan_directory</code>.</li>
<li><strong><code>_scan_directory</code></strong> — обходит файлы, применяя фильтры:</li>
<li>Проверка типа (текстовый/бинарный), размера (ограничение <code>max_size</code>, по умолчанию 200 КБ), симлинков.</li>
<li>Фильтрация по шаблонам включения/исключения.</li>
</ul>
<h2 id="_19">Результат</h2>
<p>Возвращается объект <code>ScanResult</code> с полной информацией о проанализированных файлах, готовой к использованию в генерации документации.</p>
<p>Файл содержит функции для генерации и управления документацией на основе MkDocs. Основное назначение — запись файлов документации, очистка устаревших файлов, постобработка HTML-выхода и создание индекса поиска.  </p>
<p>Ключевые сущности:<br/>
- <code>docs_files</code> — словарь с содержимым файлов документации, где ключ — путь, значение — текст.<br/>
- <code>file_map</code>, <code>module_pages</code>, <code>config_pages</code> — структуры данных с информацией о модулях и конфигурациях.<br/>
- <code>SECTION_TITLES</code>, <code>DOMAIN_TITLES</code> — отображения для заголовков разделов и доменов конфигураций.  </p>
<p>Основные функции:<br/>
- <code>write_docs</code> — записывает файлы документации, добавляет Mermaid.js, очищает неиспользуемые файлы.<br/>
- <code>write_readme</code> — создает или обновляет README.md.<br/>
- <code>build_mkdocs</code> — генерирует <code>mkdocs.yml</code> и запускает сборку сайта документации.<br/>
- <code>_postprocess_mermaid_html</code> — исправляет HTML-символы в диаграммах Mermaid.<br/>
- <code>__serialize_index</code> — формирует JSON-индекс с метаданными, включая время генерации и правила ранжирования.  </p>
<p>Важные настройки:<br/>
- Автоматическая очистка устаревших файлов по списку <code>keep_files</code>.<br/>
- Поддержка локальной среды через <code>.venv/bin/mkdocs</code> или глобальный <code>mkdocs</code>.<br/>
- Интеграция Mermaid.js для визуализации диаграмм.<br/>
- Индексация документации с указанием приоритетов файлов для навигации.</p>
<h1 id="_20">Резюме: Генерация технической документации</h1>
<p>Файл отвечает за автоматическую генерацию и управление структурированной технической документации проекта с использованием LLM. Основные функции включают анализ кода, построение контекста, генерацию Markdown-файлов и поддержку многоязычности, кэширования и параллельной обработки.</p>
<h2 id="_21">Ключевые возможности</h2>
<ul>
<li><strong>Генерация документации</strong>: создание <code>overview.md</code>, <code>index.md</code>, <code>testing.md</code>, <code>changes.md</code>, <code>dependencies.md</code>, <code>glossary.md</code> и секций по доменам.</li>
<li><strong>Модульная и конфигурационная документация</strong>: автоматическое создание страниц в поддиректориях <code>modules/</code> и <code>configs/</code> с пагинацией (по 100 элементов) и навигацией.</li>
<li><strong>Иерархический контекст</strong>: использование <code>build_hierarchical_context</code> для укладки в лимит токенов через иерархическое суммирование.</li>
<li><strong>Поддержка Mermaid</strong>: визуализация архитектуры в виде диаграмм.</li>
<li><strong>Управление изменениями</strong>: отслеживание добавленных, изменённых и удалённых файлов с кратким резюме.</li>
<li><strong>Кэширование и производительность</strong>: <code>llm_cache</code> для повторных запросов, параллельная обработка с <code>asyncio.Semaphore</code>.</li>
</ul>
<h2 id="_22">Ключевые сущности</h2>
<ul>
<li><code>docs_dir</code> — корневая директория вывода документации.</li>
<li><code>file_map</code> — метаданные файлов проекта.</li>
<li><code>all_summaries</code> — агрегированные сводки для контекста.</li>
<li><code>SECTION_TITLES</code>, <code>DOMAIN_TITLES</code> — отображение ключей в читаемые заголовки.</li>
<li><code>llm</code>, <code>llm_cache</code> — модель и кэш для генерации текста.</li>
</ul>
<h2 id="_23">Важные настройки</h2>
<ul>
<li><code>AI_DOCS_REGEN_ALL_THRESHOLD</code>, <code>input_budget</code> — управление перегенерацией и объёмом контекста.</li>
<li><code>language</code> — локализация документации.</li>
<li><code>force_sections</code> — принудительная регенерация секций.</li>
</ul>
<h2 id="_24">Особенности</h2>
<ul>
<li>Условная перегенерация: только при отсутствии файла или флаге <code>force</code>.</li>
<li>Автоматическая очистка устаревших файлов доменов.</li>
<li>Поддержка навигации: «← Предыдущая / Следующая →».</li>
<li>Специальная обработка тестов через <code>render_testing_section</code>.</li>
</ul>
<h2 id="_25">Результат</h2>
<p>Набор актуальных, структурированных Markdown-файлов, готовых к публикации, с полным охватом архитектуры, конфигураций, изменений и глоссария проекта.</p>
<p>Скрипт <code>main.py</code> — точка входа для генерации документации (README и MkDocs) на основе исходных кодов или конфигураций. Поддерживает локальные директории и Git-репозитории по URL.  </p>
<p><strong>Назначение</strong>: автоматическое создание документации с использованием LLM, включая анализ архитектуры, модулей, конфигураций и изменений.  </p>
<p><strong>Ключевые сущности</strong>:<br/>
- <code>scan_source</code> — сканирование файлов с фильтрацией по шаблонам (<code>--include</code>, <code>--exclude</code>) и ограничением размера (<code>--max-size</code>).<br/>
- <code>from_env</code> — инициализация LLM на основе переменных окружения (например, <code>LLM_MODEL</code>, <code>LLM_API_KEY</code>).<br/>
- <code>generate_docs</code> — основная логика генерации, кэширование ответов LLM, параллельная обработка.  </p>
<p><strong>Важные параметры командной строки</strong>:<br/>
- <code>--source</code> — обязательный путь или URL к исходникам.<br/>
- <code>--readme</code>, <code>--mkdocs</code> — выбор типа генерируемой документации.<br/>
- <code>--language</code> — язык документации (<code>ru</code> по умолчанию).<br/>
- <code>--regen</code> — принудительная перегенерация указанных разделов (например, <code>architecture,configs</code>).<br/>
- <code>--force</code> — перезапись существующего <code>README.md</code>.<br/>
- <code>--no-cache</code> — отключение кэширования запросов к LLM.<br/>
- <code>--threads</code> — количество параллельных запросов к модели.<br/>
- <code>--local-site</code> — настройка MkDocs для локального запуска.<br/>
- <code>--cache-dir</code> — директория кэша (по умолчанию <code>.ai_docs_cache</code> внутри <code>output_root</code>).  </p>
<p><strong>Переменные окружения</strong>:<br/>
- <code>AI_DOCS_THREADS</code> — количество потоков по умолчанию.<br/>
- <code>AI_DOCS_LOCAL_SITE</code> — флаг для локальной конфигурации MkDocs.<br/>
- <code>AI_DOCS_REGEN</code> — передаётся в <code>generate_docs</code> при использовании <code>--regen</code>.  </p>
<p>После обработки временные файлы (для URL-репозиториев) удаляются. Вывод размещается в <code>output_root</code>, который определяется автоматически, если не задан явно.</p>
<p>Класс <code>LLMClient</code> предоставляет асинхронный интерфейс для взаимодействия с моделью крупного языка (LLM) через OpenAI-совместимое API с поддержкой кэширования, повторных попыток и динамического таймаута. Основан на <code>AsyncOpenAI</code> и использует <code>httpx</code> для сетевых запросов.</p>
<p><strong>Ключевые сущности:</strong>
- <code>LLMClient</code>: основной класс для отправки запросов к модели.
- <code>from_env</code>: фабричная функция, создающая клиент на основе переменных окружения.</p>
<p><strong>Параметры инициализации:</strong>
- <code>api_key</code>: ключ API для аутентификации.
- <code>base_url</code>: базовый URL провайдера (опционально, для сторонних хостов).
- <code>model</code>: модель для генерации (например, <code>gpt-4o-mini</code>).
- <code>temperature</code>: параметр креативности генерации (по умолчанию 0.2).
- <code>max_tokens</code>: максимальное число токенов в ответе.
- <code>context_limit</code>: лимит контекстных токенов модели.</p>
<p><strong>Особенности:</strong>
- Автоматическая оценка количества входных токенов через <code>count_tokens</code>.
- Динамический таймаут чтения (<code>_compute_read_timeout</code>) в зависимости от объема входных данных.
- Поддержка кэширования ответов по хешу входного <code>payload</code> (через <code>sha256_text</code>).
- Устойчивость к сбоям: повторные попытки при ошибках 408, 429, 5xx и таймаутах с экспоненциальной задержкой.
- Потокобезопасное кэширование с использованием <code>asyncio.Lock</code>.</p>
<p><strong>Переменные окружения (используются в <code>from_env</code>):</strong>
- <code>OPENAI_API_KEY</code> — обязательный ключ API.
- <code>OPENAI_BASE_URL</code> — опциональный URL для переопределения эндпоинта.
- <code>OPENAI_MODEL</code> — модель (по умолчанию <code>gpt-4o-mini</code>).
- <code>OPENAI_TEMPERATURE</code> — температура (по умолчанию 0.2).
- <code>OPENAI_MAX_TOKENS</code> — максимальное число токенов в ответе (по умолчанию 1200).
- <code>OPENAI_CONTEXT_TOKENS</code> — лимит контекста (по умолчанию 8192).</p>
<p>Функция <code>chat</code> отправляет список сообщений и возвращает сгенерированный текст, при необходимости сохраняя результат в кэш.</p>
<h1 id="_26">Резюме модуля обработки технической документации</h1>
<h2 id="_27">Назначение</h2>
<p>Модуль предназначен для автоматизированной обработки, нормализации и генерации текстовых описаний конфигураций и модулей с целью интеграции в техническую документацию. Поддерживает форматирование в стиле Doxygen и конфигурационном стиле с использованием LLM и кэшированием.</p>
<h2 id="_28">Основные функции</h2>
<ul>
<li><strong>Проверка и нормализация формата текста</strong> с учётом структурных требований.</li>
<li><strong>Асинхронная обработка</strong> больших файлов с разбиением на чанки по ограничению токенов.</li>
<li><strong>Генерация резюме</strong> с применением специализированных промптов в зависимости от типа файла (<code>config</code>, <code>infra</code> и др.) и режима (<code>detailed</code>).</li>
<li><strong>Форматирование секций</strong> с параметрами и ключами, включая обработку блоков кода и списков.</li>
<li><strong>Сохранение результатов</strong> в виде Markdown-файлов с безопасным именованием.</li>
</ul>
<h2 id="_29">Ключевые структуры</h2>
<ul>
<li><code>SUMMARY_PROMPT</code> — общий промпт для резюме.</li>
<li><code>MODULE_SUMMARY_PROMPT</code>, <code>MODULE_SUMMARY_REFORMAT_PROMPT</code> — для Doxygen-документации модулей.</li>
<li><code>CONFIG_SUMMARY_PROMPT</code>, <code>CONFIG_SUMMARY_REFORMAT_PROMPT</code> — для конфигурационных файлов.</li>
</ul>
<h2 id="_30">Вспомогательные функции</h2>
<ul>
<li><code>_needs_doxygen_fix</code> — проверка на несоответствие Doxygen-формату.</li>
<li><code>_normalize_module_summary</code> — нормализация описания модуля через LLM.</li>
<li><code>_normalize_config_summary</code> — нормализация конфигурационного описания.</li>
<li><code>_format_config_blocks</code> — форматирование секций с <code>&lt;br&gt;</code>.</li>
<li><code>_strip_fenced_markdown</code> — очистка от Markdown-блоков (```) и лишних пробелов.</li>
<li><code>summarize_file</code> — основная функция генерации резюме с кэшированием.</li>
<li><code>write_summary</code> — сохранение резюме в файл.</li>
</ul>
<h2 id="_31">Использование</h2>
<p>Модуль автоматизирует документирование кодовой базы, обеспечивая единообразие и соответствие стандартам форматирования.</p>
<p>Модуль отвечает за генерацию конфигурационного файла <code>mkdocs.yml</code> и запись документации в файловую систему. Основная функция <code>build_mkdocs_yaml</code> формирует YAML-конфигурацию для MkDocs на основе входных параметров: названия сайта, структуры разделов, конфигурационных файлов и модулей. Динамически строится навигация (<code>nav</code>) с поддержкой вложенных разделов, включая архитектуру, запуск, зависимости, тестирование, соглашения, глоссарий, конфиги, модули и изменения. Поддерживается кастомизация навигации для конфигурации проекта и модулей через <code>_build_tree_nav</code>, которая преобразует список путей в древовидную структуру. В конфигурацию добавляются плагины (<code>search</code>, <code>mermaid2</code>) и расширения Markdown, включая поддержку Mermaid-диаграмм через <code>pymdownx.superfences</code>. Для локальных сайтов настраиваются <code>site_url</code> и <code>use_directory_urls</code>. Функция <code>write_docs_files</code> записывает сгенерированные файлы документации в указанную директорию, отслеживая прогресс. Используется кастомный YAML-дампер <code>_YamlSafeDumper</code> для корректного представления Python-объектов (например, <code>mermaid2.fence_mermaid</code>).</p>
<p>Основной модуль генерации документации с использованием LLM. Оркестрирует процесс анализа исходных файлов, кэширования, создания и обновления документации на основе изменений. Поддерживает асинхронную обработку, многопоточность и инкрементальное обновление.</p>
<p>Ключевые сущности:<br/>
- <code>generate_docs</code> — синхронная точка входа, запускает асинхронный процесс через <code>asyncio</code>.<br/>
- <code>_generate_docs_async</code> — основная логика: вычисление diff'а, суммаризация изменённых и отсутствующих файлов, построение структуры документации, запись результатов.<br/>
- Интеграция с кэшем (<code>init_cache</code>, <code>save_cache_snapshot</code>) для оптимизации перегенерации.<br/>
- Поддержка разных типов документации: модули, конфигурации, общие файлы.  </p>
<p>Важные настройки:<br/>
- <code>use_cache</code> — включение/отключение кэширования.<br/>
- <code>threads</code> — количество потоков для параллельной обработки.<br/>
- <code>force</code> — принудительная перезапись README.<br/>
- <code>write_readme_flag</code> — флаг генерации README.<br/>
- <code>write_mkdocs</code> — флаг генерации конфигурации MkDocs.<br/>
- <code>local_site</code> — режим локального сайта (влияет на структуру навигации).<br/>
- <code>AI_DOCS_REGEN</code> — переменная окружения для указания секций, которые нужно перегенерировать принудительно.  </p>
<p>Результат:<br/>
- Генерация документации в <code>output_root/.ai-docs</code>.<br/>
- Создание <code>README.md</code> и <code>mkdocs.yml</code> (опционально).<br/>
- Вывод отчётов об ошибках, если таковые возникли.</p>
<p>Модуль отвечает за управление кэшированием, сравнение файлов и сопровождение промежуточных результатов (например, аннотаций и сводок) в процессе генерации документации. Основные функции включают инициализацию кэша, построение карты файлов с метаданными, выявление изменений, сохранение снимков состояния, а также очистку устаревших или неиспользуемых файлов сводок.</p>
<p>Ключевые сущности:<br/>
- <code>CacheManager</code> — управляет хранением и загрузкой кэша (LLM-ответов и индекса файлов).<br/>
- <code>file_map</code> — словарь с хешами, размерами, типами и содержимым файлов, построенный на основе входных данных.<br/>
- Промежуточные директории: <code>files</code>, <code>modules</code>, <code>configs</code> — хранят сгенерированные сводки по категориям.</p>
<p>Важные функции:<br/>
- <code>init_cache</code> — инициализирует кэш и загружает предыдущее состояние, если кэширование включено.<br/>
- <code>build_file_map</code> — создаёт карту файлов с хешами содержимого (через <code>sha256_text</code>) для отслеживания изменений.<br/>
- <code>diff_files</code> — определяет, какие файлы изменились, добавлены или удалены, на основе сравнения хешей.<br/>
- <code>save_cache_snapshot</code> — сохраняет обновлённый индекс файлов и кэш LLM, исключая содержимое файлов из индекса.<br/>
- <code>carry_unchanged_summaries</code> — переносит пути к существующим сводкам для неизменённых файлов, чтобы избежать повторной обработки.<br/>
- <code>cleanup_orphan_summaries</code> и <code>cleanup_deleted_summaries</code> — удаляют сводки, которые больше не связаны с актуальными файлами, с пошаговым логированием процесса.</p>
<p>Параметры:<br/>
- <code>cache_dir</code> — корневая директория для кэша.<br/>
- <code>use_cache</code> — флаг, включающий использование кэша LLM и индексации.<br/>
- <code>is_test_path</code> — утилита для фильтрации тестовых файлов (не требуют модульных сводок).  </p>
<p>Модуль обеспечивает эффективную инкрементальную обработку, минимизируя избыточные вычисления и поддерживая чистоту промежуточных данных.</p>
<h1 id="_32">Резюме документации</h1>
<p>Данный документ представляет собой обобщённое описание системы, её компонентов, функциональных возможностей и принципов работы. Система предназначена для эффективного управления данными и обеспечения взаимодействия между различными модулями через чётко определённые интерфейсы. Включает в себя описание архитектуры, основных процессов, требований к окружению и инструкции по развертыванию. Документация ориентирована на разработчиков, администраторов и технических специалистов, обеспечивая полное понимание системы и поддержку её эксплуатации.</p>
<p>Модуль предоставляет инструменты для подсчёта токенов и разбиения текста на части с учётом ограничений по токенам, в зависимости от модели. Использует <code>tiktoken</code> для корректного токенизации моделей OpenAI, а при отсутствии поддержки — резервное побайтовое кодирование. Основные функции: <code>get_encoding</code> возвращает токенизатор для указанной модели, <code>count_tokens</code> подсчитывает количество токенов в тексте, <code>chunk_text</code> разделяет текст на фрагменты заданного максимального размера в токенах. Ключевая настройка — параметр <code>max_tokens</code> в <code>chunk_text</code>, определяющий длину каждого фрагмента. В случае недоступности <code>tiktoken</code> используется внутренний класс <code>_ByteEncoding</code>, кодирующий текст как UTF-8 байты.</p>
<p>Функция формирует Markdown-отчёт об изменениях, внесённых в проект после генерации файлов. Отчёт включает списки добавленных, изменённых и удалённых файлов, перечень перегенерированных разделов и краткое резюме. Основные параметры: <code>added</code>, <code>modified</code>, <code>deleted</code> — словари с путями файлов; <code>regenerated_sections</code> — список названий разделов, подвергшихся перегенерации; <code>summary</code> — текст итогового описания изменений. Результат возвращается в виде строки в формате Markdown.</p>
<p>Файл содержит вспомогательные функции для анализа структуры проекта и генерации документации. Основное назначение — сбор информации о тестах, зависимостях, конфигурационных файлах и навигации по документации.  </p>
<p>Ключевые сущности:<br/>
- <code>SECTION_TITLES</code>, <code>DOMAIN_TITLES</code> — отображение внутренних ключей в читаемые заголовки разделов и доменов.<br/>
- <code>is_test_path</code> — определяет, является ли путь тестовым по имени или расположению.<br/>
- <code>collect_dependencies</code> — извлекает зависимости из <code>pyproject.toml</code>, <code>requirements.txt</code>, <code>package.json</code>.<br/>
- <code>collect_test_info</code> — находит тестовые файлы и команды для запуска тестов (например, <code>pytest</code>, <code>npm test</code>).<br/>
- <code>render_testing_section</code> — формирует Markdown-описание тестов и способов их запуска.<br/>
- <code>render_project_configs_index</code> — генерирует оглавление для конфигурационных файлов.<br/>
- <code>strip_duplicate_heading</code>, <code>first_paragraph</code> — утилиты для обработки текста документации.<br/>
- <code>build_docs_index</code> — строит иерархию разделов, модулей и конфигураций для навигации в документации.  </p>
<p>Важные настройки и поведение:<br/>
- Поддержка нескольких форматов конфигураций: TOML, JSON, текстовые файлы.<br/>
- Автоматическое определение тестовых файлов по имени и пути.<br/>
- Формирование структуры документации на основе наличия файлов в <code>docs/</code> и метаданных из <code>file_map</code>.<br/>
- Генерация кратких описаний модулей и конфигураций на основе первого абзаца из соответствующих <code>.md</code>-файлов.</p>
<p>Вспомогательные утилиты для работы с файлами, хеширования и путей. Основные функции: вычисление SHA-256 хеша от байтов и строк, безопасное чтение текстовых файлов с кодировкой UTF-8, проверка, является ли файл бинарным (по наличию нулевых байтов), определение URL по префиксу, нормализация путей в POSIX-формат и создание slug-идентификаторов из строк. Также включает функцию <code>ensure_dir</code> для создания директорий с проверкой существования. Используется для подготовки и валидации файловой структуры, безопасной обработки путей и определения типов источников (локальные файлы или URL).</p>
<p>Словари с описаниями расширений файлов и наборы ключевых имён/путей для классификации файлов в проекте. Определяет тип файла (код, конфигурация, документация и др.) и домены инфраструктуры (Kubernetes, Terraform, Docker и др.) на основе расширения, имени и пути. Используется для анализа структуры проекта. Основные сущности: <code>CODE_EXTENSIONS</code>, <code>CONFIG_EXTENSIONS</code>, <code>CI_FILENAMES</code>, <code>DOCKER_FILENAMES</code>, <code>TERRAFORM_EXTENSIONS</code>, <code>classify_type</code>, <code>detect_domains</code>. Ключевые параметры — расширения файлов и пути, ассоциированные с инфраструктурными технологиями.</p>
<p>Модуль обеспечивает запуск основного CLI-интерфейса приложения <code>ai_docs</code>. Реализует гибкую загрузку функции <code>main</code> из модуля <code>cli</code>, поддерживая как импорт в рамках пакета, так и запуск скрипта напрямую. В случае, если импорт через относительный путь не удается, автоматически добавляет родительский каталог в <code>sys.path</code> для корректного импорта. Основная логика запускается при выполнении файла как скрипта через <code>if __name__ == "__main__"</code>, что делает возможным использование команды <code>python ai_docs/cli.py</code> из терминала. Ключевая сущность — функция <code>main</code>, отвечающая за обработку аргументов командной строки и выполнение действий.</p>
<p>Класс <code>CacheManager</code> предназначен для управления кэшем в файловой системе, включая хранение индекса файлов и кэша ответов LLM. Работает с двумя основными файлами: <code>index.json</code> — для отслеживания состояния файлов (хэши, метаданные), и <code>llm_cache.json</code> — для хранения закэшированных текстовых ответов по ключам. При инициализации создает директорию кэша, если её нет. Метод <code>load_index</code> возвращает индекс файлов, инициализируя пустую структуру при отсутствии файла. Метод <code>save_index</code> записывает индекс с форматированием. Метод <code>load_llm_cache</code> безопасно загружает кэш LLM, обрабатывает пустые и битые JSON-файлы, сохраняя повреждённые данные в резервный файл с суффиксом <code>.bad</code>. Метод <code>save_llm_cache</code> сохраняет кэш, делая снимок данных. Метод <code>diff_files</code> сравнивает текущие метаданные файлов с сохранёнными и возвращает четыре словаря: добавленные, изменённые, удалённые и неизменные файлы — на основе сравнения хэшей. Используется для оптимизации обработки документов при повторных запусках.</p>
<p>Тестовый модуль для проверки функциональности сканера исходного кода из пакета <code>ai_docs.scanner</code>. Основное назначение — верификация корректной обработки файлов в директории, включая учёт правил игнорирования. Ключевая функция — <code>scan_source</code>, которая анализирует указанную директорию и возвращает список файлов, исключая игнорируемые (например, по правилам <code>.gitignore</code> и стандартным шаблонам вроде виртуальных окружений). В тесте <code>test_scan_local_dir</code> создаётся временная структура файлов, включая <code>app.py</code>, <code>Dockerfile</code>, <code>.gitignore</code> и файл в виртуальном окружении. Проверяется, что сканируются только ожидаемые файлы, а игнорируемые (например, <code>ignored.txt</code> и файлы из <code>.venv</code>) исключаются из результата.</p>
<h1 id="_33">Резюме документации</h1>
<p>Данный документ представляет собой обобщённое описание системы, её компонентов, функциональных возможностей и принципов работы. Система предназначена для эффективного управления данными и обеспечения взаимодействия между различными модулями через чётко определённые интерфейсы. Включает в себя описание архитектуры, основных процессов, требований к окружению и инструкции по развертыванию. Документация ориентирована на разработчиков, администраторов и технических специалистов, обеспечивая полное понимание системы и поддержку её эксплуатации.</p>
<p>Назначение файла — тестирование функциональности класса <code>CacheManager</code>, отвечающего за управление кэшем файлов, включая отслеживание изменений, добавление, удаление и определение неизменённых файлов. Основная сущность — класс <code>CacheManager</code>, работающий с индексом кэша, хранящим хэши файлов. Тесты проверяют метод <code>diff_files</code>, который сравнивает переданный список файлов с сохранённым состоянием и возвращает четыре категории: добавленные, изменённые, удалённые и неизменённые файлы. Важные аспекты: временная директория для изоляции тестов, последовательное обновление индекса через <code>save_index</code> и проверка корректности определения статусов файлов при изменении состояния. Тесты охватывают сценарии первого запуска, изменения хэшей, добавления и удаления файлов.</p>
<p>Файл содержит модульные тесты для функции <code>format_changes_md</code>, формирующей Markdown-представление изменений в документации. Основное назначение — проверка корректности генерации разделов по добавленным, изменённым, удалённым файлам и перегенерированным разделам. В тесте участвуют словари <code>added</code>, <code>modified</code>, <code>deleted</code> и список <code>regenerated</code>, а также параметр <code>summary</code>. Проверяется наличие ключевых заголовков и упоминание имён файлов и разделов в выходной Markdown-строке. Тест убеждается, что все компоненты правильно отображаются в итоговом тексте.</p>
<p>Помогает в разработке и рефакторинге кода, используя предварительно сгенерированную документацию в каталоге <code>.ai-docs</code>. Назначение — быстрая ориентация в структуре проекта, модулях, архитектуре и соглашениях без прямого анализа исходного кода на первом этапе.</p>
<p>Ключевые сущности:<br/>
- Каталог <code>.ai-docs</code> — основной источник информации.<br/>
- Файл <code>_index.json</code> — навигационный индекс для определения приоритетных модулей.<br/>
- Основные документы: <code>index.md</code>, <code>architecture.md</code>, <code>conventions.md</code>, <code>dependencies.md</code>, модульные описания в <code>modules/</code>.  </p>
<p>Важные настройки и правила:<br/>
- При отсутствии <code>.ai-docs</code> — возвращать сообщение о необходимости предварительной генерации документации.<br/>
- Классифицировать запросы (обзор, рефакторинг, уточнение) и выбирать соответствующие разделы.<br/>
- Использовать приоритеты и ранжирование из <code>_index.json</code> для фильтрации релевантных модулей.<br/>
- Опор на <code>.md</code>-файлы для формирования контекста; переход к исходному коду — только после локализации нужного компонента через документацию.<br/>
- Ответ формируется на языке запроса пользователя.<br/>
- Не предлагать обновление или перегенерацию документации.  </p>
<p>Результат включает краткий вывод, ссылки на задействованные файлы <code>.ai-docs</code> и, при необходимости, план действий с привязкой к разделам документации.</p></div>
</div>
</div>
<footer class="col-md-12">
<hr/>
<p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
</footer>
<script src="js/bootstrap.bundle.min.js"></script>
<script>
            var base_url = ".",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
<script src="js/base.js"></script>
<script src="search/main.js"></script>
<div aria-hidden="true" aria-labelledby="searchModalLabel" class="modal" id="mkdocs_search_modal" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg">
<div class="modal-content">
<div class="modal-header">
<h4 class="modal-title" id="searchModalLabel">Search</h4>
<button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
</div>
<div class="modal-body">
<p>From here you can search these documents. Enter your search terms below.</p>
<form>
<div class="form-group">
<input class="form-control" id="mkdocs-search-query" placeholder="Search..." title="Type search term here" type="search"/>
</div>
</form>
<div data-no-results-text="No results found" id="mkdocs-search-results"></div>
</div>
<div class="modal-footer">
</div>
</div>
</div>
</div><div aria-hidden="true" aria-labelledby="keyboardModalLabel" class="modal" id="mkdocs_keyboard_modal" role="dialog" tabindex="-1">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
<button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
</div>
<div class="modal-body">
<table class="table">
<thead>
<tr>
<th style="width: 20%;">Keys</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="help shortcut"><kbd>?</kbd></td>
<td>Open this help</td>
</tr>
<tr>
<td class="next shortcut"><kbd>n</kbd></td>
<td>Next page</td>
</tr>
<tr>
<td class="prev shortcut"><kbd>p</kbd></td>
<td>Previous page</td>
</tr>
<tr>
<td class="search shortcut"><kbd>s</kbd></td>
<td>Search</td>
</tr>
</tbody>
</table>
</div>
<div class="modal-footer">
</div>
</div>
</div>
</div>
</body>
</html>
