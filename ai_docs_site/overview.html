<!DOCTYPE html>

<html data-bs-theme="light" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="img/favicon.ico" rel="shortcut icon"/>
<title>Обзор проекта - ai-docs</title>
<link href="css/bootstrap.min.css" rel="stylesheet"/>
<link href="css/fontawesome.min.css" rel="stylesheet"/>
<link href="css/brands.min.css" rel="stylesheet"/>
<link href="css/solid.min.css" rel="stylesheet"/>
<link href="css/v4-font-face.min.css" rel="stylesheet"/>
<link href="css/base.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" id="hljs-light" rel="stylesheet"/>
<link disabled="" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" id="hljs-dark" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
</head>
<body>
<div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
<div class="container">
<a class="navbar-brand" href="index.html">ai-docs</a>
<!-- Expander button -->
<button aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-bs-target="#navbar-collapse" data-bs-toggle="collapse" type="button">
<span class="navbar-toggler-icon"></span>
</button>
<!-- Expanded navigation -->
<div class="navbar-collapse collapse" id="navbar-collapse">
<!-- Main navigation -->
<ul class="nav navbar-nav">
<li class="nav-item">
<a class="nav-link" href="index.html">Главная</a>
</li>
<li class="nav-item dropdown">
<a aria-current="page" aria-expanded="false" class="nav-link dropdown-toggle active" data-bs-toggle="dropdown" href="#" role="button">Обзор</a>
<ul class="dropdown-menu">
<li>
<a aria-current="page" class="dropdown-item active" href="overview.html">Обзор проекта</a>
</li>
</ul>
</li>
<li class="nav-item">
<a class="nav-link" href="architecture.html">Архитектура</a>
</li>
<li class="nav-item">
<a class="nav-link" href="runtime.html">Запуск</a>
</li>
<li class="nav-item">
<a class="nav-link" href="dependencies.html">Зависимости</a>
</li>
<li class="nav-item">
<a class="nav-link" href="testing.html">Тестирование</a>
</li>
<li class="nav-item">
<a class="nav-link" href="conventions.html">Соглашения</a>
</li>
<li class="nav-item">
<a class="nav-link" href="glossary.html">Глоссарий</a>
</li>
<li class="nav-item dropdown">
<a aria-expanded="false" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button">Конфигурация проекта</a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="configs/index.html">Обзор</a>
</li>
<li>
<a class="dropdown-item" href="configs/files/pyproject__toml.html">pyproject.toml</a>
</li>
</ul>
</li>
<li class="nav-item dropdown">
<a aria-expanded="false" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button">Модули</a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="modules/index.html">Обзор</a>
</li>
<li class="dropdown-submenu">
<a class="dropdown-item" href="#">/ai_docs</a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="modules/ai_docs/__init____py.html">__init__.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/__main____py.html">__main__.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/cache__py.html">cache.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/changes__py.html">changes.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/cli__py.html">cli.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/domain__py.html">domain.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/generator__py.html">generator.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/generator_cache__py.html">generator_cache.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/generator_output__py.html">generator_output.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/generator_sections__py.html">generator_sections.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/generator_shared__py.html">generator_shared.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/generator_summarize__py.html">generator_summarize.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/llm__py.html">llm.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/mkdocs__py.html">mkdocs.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/scanner__py.html">scanner.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/summary__py.html">summary.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/tokenizer__py.html">tokenizer.py</a>
</li>
<li>
<a class="dropdown-item" href="modules/ai_docs/utils__py.html">utils.py</a>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-item">
<a class="nav-link" href="changes.html">Изменения</a>
</li>
</ul>
<ul class="nav navbar-nav ms-md-auto">
<li class="nav-item">
<a class="nav-link" data-bs-target="#mkdocs_search_modal" data-bs-toggle="modal" href="#">
<i class="fa fa-search"></i> Search
                            </a>
</li>
<li class="nav-item">
<a class="nav-link" href="index.html" rel="prev">
<i class="fa fa-arrow-left"></i> Previous
                                </a>
</li>
<li class="nav-item">
<a class="nav-link" href="architecture.html" rel="next">
                                    Next <i class="fa fa-arrow-right"></i>
</a>
</li>
</ul>
</div>
</div>
</div>
<div class="container">
<div class="row">
<div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
<div class="navbar-header">
<button class="navbar-toggler collapsed" data-bs-target="#toc-collapse" data-bs-toggle="collapse" title="Table of Contents" type="button">
<span class="fa fa-angle-down"></span>
</button>
</div>
<div class="navbar-collapse collapse card bg-body-tertiary" id="toc-collapse">
<ul class="nav flex-column">
<li class="nav-item" data-bs-level="1"><a class="nav-link" href="#_1">Обзор проекта</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="1"><a class="nav-link" href="#ai_docs">ai_docs — Генерация технической документации</a>
<ul class="nav flex-column">
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_2">Основные возможности</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_3">Конфигурация</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_4">Поддерживаемые форматы</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#cli-">CLI-параметры</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_5">Тестирование и сборка</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_6">Лицензия</a>
<ul class="nav flex-column">
</ul>
</li>
</ul>
</li>
<li class="nav-item" data-bs-level="1"><a class="nav-link" href="#ai_docs_1">ai_docs — Генерация технической документации из кода</a>
<ul class="nav flex-column">
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_7">Возможности</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_8">Выходные артефакты</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_9">Конфигурация</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#cli-_1">Основные CLI-параметры</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_11">Поведение по умолчанию</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_12">Разработка</a>
<ul class="nav flex-column">
</ul>
</li>
</ul>
</li>
<li class="nav-item" data-bs-level="1"><a class="nav-link" href="#_13">Обзор модуля сканирования репозиториев</a>
<ul class="nav flex-column">
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_14">Основные компоненты</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_15">Конфигурация и фильтрация</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_16">Функции</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_17">Результат</a>
<ul class="nav flex-column">
</ul>
</li>
</ul>
</li>
<li class="nav-item" data-bs-level="1"><a class="nav-link" href="#_18">Резюме: Генерация технической документации</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="1"><a class="nav-link" href="#_19">Резюме модуля обработки технической документации</a>
<ul class="nav flex-column">
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_20">Назначение</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_21">Основные функции</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_22">Ключевые структуры</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_23">Вспомогательные функции</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#_24">Использование</a>
<ul class="nav flex-column">
</ul>
</li>
</ul>
</li>
<li class="nav-item" data-bs-level="1"><a class="nav-link" href="#_25">Резюме документации</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="1"><a class="nav-link" href="#_26">Резюме документации</a>
<ul class="nav flex-column">
</ul>
</li>
</ul>
</div>
</div></div>
<div class="col-md-9" role="main">
<h1 id="_1">Обзор проекта</h1>
<h1 id="ai_docs"><code>ai_docs</code> — Генерация технической документации</h1>
<p>CLI-инструмент <code>ai_docs</code> автоматически создаёт техническую документацию по исходному коду и конфигурационным файлам. Поддерживает анализ локальных директорий, локальных и удалённых git-репозиториев.</p>
<h2 id="_2">Основные возможности</h2>
<ul>
<li>Генерация <code>README.md</code> и полноценного MkDocs-сайта (включая <code>mkdocs.yml</code> и сборку в <code>ai_docs_site/</code>)</li>
<li>Автоматическое определение ключевых инфраструктурных доменов: Kubernetes, Helm, Terraform, Ansible, Docker, CI/CD, мониторинг, Service Mesh / Ingress, хранилища данных</li>
<li>Детальная документация по модулям (<code>.ai-docs/modules/</code>) и конфигурациям (<code>.ai-docs/configs/</code>)</li>
<li>Инкрементальная генерация с кэшированием в <code>.ai_docs_cache/</code></li>
<li>Фильтрация файлов по <code>.gitignore</code>, <code>.build_ignore</code> и стандартным исключениям</li>
<li>Параллельная обработка (настраивается через <code>--threads</code> или <code>AI_DOCS_THREADS</code>)</li>
<li>Ведение отчёта об изменениях в <code>docs/changes.md</code></li>
<li>Автоматическая пагинация при превышении 100 модулей/конфигов</li>
<li>Поддержка мультиязычности и интеграции в CI/CD (например, GitHub Actions)</li>
</ul>
<h2 id="_3">Конфигурация</h2>
<ul>
<li><strong>API и LLM</strong>: <code>OPENAI_API_KEY</code>, <code>OPENAI_BASE_URL</code>, <code>OPENAI_MODEL</code>, <code>OPENAI_MAX_TOKENS</code>, <code>OPENAI_CONTEXT_TOKENS</code>, <code>OPENAI_TEMPERATURE</code></li>
<li><strong>Потоки</strong>: <code>AI_DOCS_THREADS</code></li>
<li><strong>Режим MkDocs</strong>: <code>AI_DOCS_LOCAL_SITE</code></li>
<li><strong>Кастомизация</strong>: <code>.ai-docs.yaml</code> — настройка расширений файлов (например, <code>code_extensions: {.py: Python}</code>), путей и фильтров</li>
</ul>
<h2 id="_4">Поддерживаемые форматы</h2>
<ul>
<li>Исходный код: Python, JavaScript, Go, Java, C++, TypeScript и др.</li>
<li>Документация: Markdown, reStructuredText</li>
<li>Конфигурации: YAML, JSON</li>
</ul>
<h2 id="cli-">CLI-параметры</h2>
<p>Поддерживаются опции для указания:
- Источника (путь/URL)
- Выходной директории
- Языка
- Фильтрации
- Управления кэшированием
- Принудительной перегенерации разделов</p>
<h2 id="_5">Тестирование и сборка</h2>
<ul>
<li>Тесты: <code>pytest</code> в директории <code>tests/</code></li>
<li>Сборка сайта: <code>mkdocs build</code></li>
</ul>
<h2 id="_6">Лицензия</h2>
<p>Проект распространяется под лицензией MIT и открыт для вклада.</p>
<h1 id="ai_docs_1"><code>ai_docs</code> — Генерация технической документации из кода</h1>
<p>CLI-инструмент <code>ai_docs</code> автоматически создаёт техническую документацию из исходного кода и конфигурационных файлов. Поддерживает локальные директории, локальные и удалённые Git-репозитории. Основные выходные артефакты — <code>README.md</code> и полноценный сайт документации на основе MkDocs.</p>
<h2 id="_7">Возможности</h2>
<ul>
<li>Автоматическое определение доменов: Kubernetes, Helm, Terraform, Ansible, Docker, CI/CD, Observability, Service Mesh / Ingress, Data / Storage.</li>
<li>Генерация с использованием LLM (например, GPT-4o-mini) с поддержкой:</li>
<li>Параллельной обработки (<code>--threads</code>).</li>
<li>Кэширования и инкрементального обновления.</li>
<li>Учёта <code>.gitignore</code>, <code>.build_ignore</code> и встроенных исключений (<code>.venv</code>, <code>node_modules</code>, <code>dist</code>, и др.).</li>
<li>Поддержка фильтрации файлов по расширениям и путям.</li>
</ul>
<h2 id="_8">Выходные артефакты</h2>
<ul>
<li><code>README.md</code> — краткое описание проекта.</li>
<li><code>.ai-docs/</code> — детализированная документация:</li>
<li><code>modules/</code>, <code>configs/</code> — документация по модулям и конфигурациям.</li>
<li><code>changes.md</code> — отчёт об изменениях.</li>
<li><code>_index.json</code> — навигационный индекс.</li>
<li><code>mkdocs.yml</code> — конфигурация MkDocs.</li>
<li><code>ai_docs_site/</code> — собранный сайт документации.</li>
<li><code>.ai_docs_cache/</code> — кэш промежуточных результатов.</li>
</ul>
<h2 id="_9">Конфигурация</h2>
<h3 id="_10">Через переменные окружения:</h3>
<ul>
<li><code>OPENAI_API_KEY</code>, <code>OPENAI_BASE_URL</code>, <code>OPENAI_MODEL</code>, <code>OPENAI_MAX_TOKENS</code>, <code>OPENAI_CONTEXT_TOKENS</code>, <code>OPENAI_TEMPERATURE</code> — настройки LLM.</li>
<li><code>AI_DOCS_THREADS</code> — количество потоков.</li>
<li><code>AI_DOCS_LOCAL_SITE</code> — режим локального сайта.</li>
</ul>
<h3 id="ai-docsyaml">Через <code>.ai-docs.yaml</code>:</h3>
<ul>
<li><code>code_extensions</code>, <code>doc_extensions</code>, <code>config_extensions</code> — расширения файлов.</li>
<li><code>exclude</code> — пользовательские исключения (например, <code>temp/*</code>, <code>*.log</code>).</li>
</ul>
<h2 id="cli-_1">Основные CLI-параметры</h2>
<ul>
<li><code>--source</code> — путь или URL к проекту.</li>
<li><code>--readme</code>, <code>--mkdocs</code> — выбор типа генерации.</li>
<li><code>--language</code> — язык (ru/en).</li>
<li><code>--include</code>/<code>--exclude</code> — фильтрация файлов.</li>
<li><code>--max-size</code> — лимит размера файлов.</li>
<li><code>--threads</code> — количество параллельных запросов.</li>
<li><code>--cache-dir</code>, <code>--no-cache</code> — управление кэшем.</li>
<li><code>--local-site</code> — настройка MkDocs для локального размещения.</li>
<li><code>--force</code> — перезапись <code>README.md</code>.</li>
<li><code>--regen</code> — перегенерация разделов (<code>configs</code>, <code>modules</code>, <code>all</code>).</li>
</ul>
<h2 id="_11">Поведение по умолчанию</h2>
<ul>
<li>Генерируются <code>README.md</code> и MkDocs-сайт.</li>
<li>Существующие файлы в <code>.ai-docs/</code> не перезаписываются (если не указан <code>--regen</code>).</li>
<li>При &lt;50 модулях — полная перегенерация.</li>
<li>Пагинация при &gt;100 элементов в списках.</li>
<li>Автоматический запуск <code>mkdocs build</code> после генерации.</li>
</ul>
<h2 id="_12">Разработка</h2>
<ul>
<li>Зависимости устанавливаются вручную (см. Quick start).</li>
<li>Запуск: <code>python -m ai_docs ...</code> (для отладки).</li>
<li>Поддерживаются PR и улучшения.</li>
<li>Лицензия: MIT.</li>
</ul>
<p>Файл <code>pyproject.toml</code> определяет метаданные и конфигурацию сборки Python-пакета <code>ai-docs-gen</code> — CLI-инструмента для автоматической генерации технической документации по исходному коду и конфигурационным файлам.  </p>
<p>В секции <code>build-system</code> указаны зависимости для сборки: <code>setuptools&gt;=68</code> и <code>wheel</code>, а также бэкенд сборки <code>setuptools.build_meta</code>.  </p>
<p>Основные метаданные проекта находятся в секции <code>project</code>:<br/>
- <strong>name</strong>: <code>ai-docs-gen</code><br/>
- <strong>version</strong>: <code>0.1.9</code><br/>
- <strong>description</strong>: краткое описание назначения пакета<br/>
- <strong>readme</strong>: ссылка на файл <code>README.md</code><br/>
- <strong>requires-python</strong>: минимальная версия Python — 3.8<br/>
- <strong>dependencies</strong>: список зависимостей, включая <code>openai</code>, <code>pyyaml</code>, <code>mkdocs</code> и плагины для расширения функциональности документации (Mermaid, Markdown-расширения)  </p>
<p>Секция <code>project.scripts</code> объявляет консольную команду <code>ai-docs</code>, которая запускает функцию <code>main</code> из модуля <code>ai_docs.cli</code>.  </p>
<p>В <code>tool.setuptools.packages.find</code> указано, что при автоматическом поиске пакетов включается <code>ai_docs</code>, но исключается поддиректория <code>assets</code>.  </p>
<p>В <code>tool.setuptools.package-data</code> определено, что в пакет необходимо включить файл <code>assets/mermaid.min.js</code>, используемый для визуализации диаграмм в документации.</p>
<p>Файл реализует асинхронные функции для генерации и обновления аннотаций (сводок) к файлам в проекте с использованием LLM. Основное назначение — параллельная обработка изменённых или отсутствующих сводок для кода, конфигураций и модулей с контролем числа одновременных запросов.</p>
<p>Ключевые сущности:
- <code>summarize_changed_files</code>, <code>summarize_changed_modules</code>, <code>summarize_changed_configs</code> — обрабатывают только изменившиеся файлы, разделяя по типам (код, модули, конфиги).
- <code>summarize_missing_*</code> — аналогичные функции, но для восстановления пропущенных сводок с отображением прогресса.
- Используется семафор (<code>asyncio.Semaphore</code>) для ограничения числа параллельных задач, передаётся через параметр <code>threads</code>.
- Все функции используют <code>summarize_file</code> для генерации текста сводки и <code>write_summary</code> для её сохранения на диск.
- Результаты записываются в метаданные (<code>meta</code>) как <code>summary_path</code>, <code>module_summary_path</code> или <code>config_summary_path</code>.
- Ошибки накапливаются в списке <code>errors</code>, прогресс отслеживается через <code>save_cb</code> и выводится в консоль каждые 5 задач.</p>
<p>Важные настройки:
- <code>llm</code> — модель для генерации, используется <code>llm.model</code> и кэширование через <code>llm_cache</code>.
- <code>summaries_dir</code>, <code>module_summaries_dir</code>, <code>config_summaries_dir</code> — директории для сохранения разных типов сводок.
- <code>is_test_path</code> — фильтрация тестовых файлов при обработке модулей.
- Параметр <code>True/False</code> в вызове <code>summarize_file</code> определяет, генерируется ли сводка как для модуля (с акцентом на интерфейс).</p>
<h1 id="_13">Обзор модуля сканирования репозиториев</h1>
<p>Модуль предназначен для сканирования и анализа структуры репозиториев с целью извлечения информации, пригодной для генерации документации.</p>
<h2 id="_14">Основные компоненты</h2>
<ul>
<li><strong><code>ScanResult</code></strong> — основной класс, содержащий результаты сканирования: список файлов с метаданными (путь, размер, тип, домены, первые 4000 символов содержимого), корневой путь, исходный URL/путь и имя репозитория.</li>
</ul>
<h2 id="_15">Конфигурация и фильтрация</h2>
<ul>
<li><strong>Шаблоны включения</strong>: <code>FIXED_INCLUDE_PATTERNS</code> — фиксированный набор файлов, всегда включаемых в сканирование (например, <code>Dockerfile</code>, <code>*.tf</code>, <code>package.json</code>).</li>
<li><strong>Шаблоны исключения</strong>: <code>DEFAULT_EXCLUDE_PATTERNS</code> — стандартные пути, исключаемые по умолчанию (<code>.git</code>, <code>node_modules</code>, <code>.venv</code>, <code>__pycache__</code> и др.).</li>
<li>Поддержка пользовательских правил из:</li>
<li><code>.ai-docs.yaml</code> — основной конфигурационный файл (создаётся по умолчанию при отсутствии).</li>
<li><code>.gitignore</code>, <code>.build_ignore</code> — обрабатываются через <code>pathspec</code>.</li>
<li><strong>Расширения файлов</strong>:</li>
<li><code>code_extensions</code>, <code>doc_extensions</code>, <code>config_extensions</code> — пользовательские расширения с описанием типов файлов.</li>
<li><strong><code>exclude</code></strong> — пользовательские шаблоны исключений, дополняющие стандартные.</li>
</ul>
<h2 id="_16">Функции</h2>
<ul>
<li><strong><code>_clone_repo</code></strong> — клонирует удалённый Git-репозиторий во временную директорию для сканирования.</li>
<li><strong><code>scan_source</code></strong> — основная функция для анализа:</li>
<li>Принимает <code>source</code> (локальный путь или URL репозитория).</li>
<li>Автоматически определяет тип источника.</li>
<li>При необходимости клонирует репозиторий.</li>
<li>Загружает конфигурацию через <code>_load_extension_config</code>.</li>
<li>Рекурсивно сканирует файлы с помощью <code>_scan_directory</code>.</li>
<li><strong><code>_scan_directory</code></strong> — обходит файлы, применяя фильтры:</li>
<li>Проверка типа (текстовый/бинарный), размера (ограничение <code>max_size</code>, по умолчанию 200 КБ), симлинков.</li>
<li>Фильтрация по шаблонам включения/исключения.</li>
</ul>
<h2 id="_17">Результат</h2>
<p>Возвращается объект <code>ScanResult</code> с полной информацией о проанализированных файлах, готовой к использованию в генерации документации.</p>
<p>Файл содержит функции для генерации и управления документацией проекта. Основное назначение — запись файлов документации, построение индекса, интеграция Mermaid.js для визуализации диаграмм, генерация <code>mkdocs.yml</code> и сборка сайта документации с помощью MkDocs.</p>
<p>Ключевые сущности:
- <code>write_docs</code> — основная функция записи документации, создает индекс, добавляет статические ресурсы (включая Mermaid), сохраняет файлы и очищает устаревшие.
- <code>build_docs_index</code> — формирует структурированный индекс документации на основе файлов и разделов.
- <code>add_mermaid_asset</code> — добавляет JavaScript-файл Mermaid для отрисовки диаграмм в документации.
- <code>write_readme</code> — записывает <code>README.md</code> в корень проекта, с опцией принудительной перезаписи.
- <code>build_mkdocs</code> — генерирует конфигурацию <code>mkdocs.yml</code> и запускает сборку сайта документации, поддерживает виртуальное окружение.
- <code>_postprocess_mermaid_html</code> — постобработка HTML-файлов после сборки, замена <code>&amp;gt;</code> на <code>&gt;</code> для корректного отображения Mermaid-диаграмм.
- <code>__serialize_index</code> — сериализует индекс документации в JSON с меткой времени и правилами ранжирования.</p>
<p>Важные настройки и параметры:
- <code>SECTION_TITLES</code>, <code>DOMAIN_TITLES</code> — определяют структуру и заголовки разделов документации.
- <code>has_changes</code> — триггер очистки устаревших файлов.
- <code>local_site</code> — режим локальной сборки сайта (влияет на настройки MkDocs).
- <code>write_mkdocs</code> — флаг, управляющий генерацией <code>mkdocs.yml</code> и сборкой сайта.
- Автоматическое управление зависимостями через <code>.venv</code> или системный <code>mkdocs</code>.</p>
<p>Функционал интегрирован с MkDocs, поддерживает динамическую навигацию, очистку неиспользуемых файлов и постобработку результата для корректной работы Mermaid.</p>
<h1 id="_18">Резюме: Генерация технической документации</h1>
<p>Файл предназначен для автоматической генерации и обновления технической документации проекта на основе анализа исходных файлов, аннотаций и контекста. Основные функции включают:</p>
<ul>
<li><strong>Построение иерархического контекста</strong> из фрагментов кода, описаний, зависимостей и тестов с использованием иерархического суммирования для укладки в лимит токенов (<code>input_budget</code>).</li>
<li><strong>Генерация структурированных разделов документации</strong>, включая:</li>
<li>Обзор проекта</li>
<li>Архитектура (с Mermaid-диаграммами)</li>
<li>Модули и конфигурации (с пагинацией при &gt;100 элементов)</li>
<li>Тестирование</li>
<li>Зависимости</li>
<li>Изменения (<code>changes.md</code>)</li>
<li>Индекс и навигация</li>
<li><strong>Поддержка многоязычности</strong> (<code>language</code>) и <strong>кэширование запросов к LLM</strong> (<code>llm_cache</code>) для повышения эффективности.</li>
<li><strong>Параллельная и асинхронная обработка</strong> с ограничением потоков (<code>threads</code>, семафоры) и принудительным обновлением при необходимости (<code>force_all</code>, <code>is_forced</code>).</li>
<li><strong>Управление файлами документации</strong> через <code>docs_dir</code>: создание, обновление и удаление устаревших файлов (особенно конфигураций по доменам).</li>
<li><strong>Ключевые сущности</strong>:</li>
<li><code>docs_files</code> — содержимое генерируемых файлов</li>
<li><code>section_contexts</code> — кэш контекстов разделов</li>
<li><code>module_pages</code>, <code>config_pages</code> — страницы модулей и конфигов</li>
<li><code>config_nav_paths</code>, <code>module_nav_paths</code> — навигационные пути</li>
<li><code>regenerated_sections</code> — список обновлённых разделов</li>
<li><strong>Настройки</strong>: <code>AI_DOCS_REGEN_ALL_THRESHOLD</code>, <code>force_sections</code>, <code>DOMAIN_TITLES</code>, <code>SECTION_TITLES</code> — управляют логикой генерации и структурой.</li>
<li>При отсутствии глоссария создаётся заглушка; генерируется <code>README</code> и сводка изменений.</li>
</ul>
<p><strong>Результат</strong>: комплексная, актуальная документация в формате Markdown, адаптированная под структуру проекта и настройки пользователя.</p>
<p>Скрипт <code>main.py</code> — точка входа для генерации документации (README и MkDocs) на основе исходных кодов или конфигураций. Поддерживает локальные директории и Git-репозитории по URL.  </p>
<p><strong>Назначение</strong>: автоматическое создание документации с использованием LLM, включая анализ архитектуры, модулей, конфигураций и изменений.  </p>
<p><strong>Ключевые сущности</strong>:<br/>
- <code>scan_source</code> — сканирование файлов с фильтрацией по шаблонам (<code>--include</code>, <code>--exclude</code>) и ограничением размера (<code>--max-size</code>).<br/>
- <code>from_env</code> — инициализация LLM на основе переменных окружения (например, <code>LLM_MODEL</code>, <code>LLM_API_KEY</code>).<br/>
- <code>generate_docs</code> — основная логика генерации, кэширование ответов LLM, параллельная обработка.  </p>
<p><strong>Важные параметры командной строки</strong>:<br/>
- <code>--source</code> — обязательный путь или URL к исходникам.<br/>
- <code>--readme</code>, <code>--mkdocs</code> — выбор типа генерируемой документации.<br/>
- <code>--language</code> — язык документации (<code>ru</code> по умолчанию).<br/>
- <code>--regen</code> — принудительная перегенерация указанных разделов (например, <code>architecture,configs</code>).<br/>
- <code>--force</code> — перезапись существующего <code>README.md</code>.<br/>
- <code>--no-cache</code> — отключение кэширования запросов к LLM.<br/>
- <code>--threads</code> — количество параллельных запросов к модели.<br/>
- <code>--local-site</code> — настройка MkDocs для локального запуска.<br/>
- <code>--cache-dir</code> — директория кэша (по умолчанию <code>.ai_docs_cache</code> внутри <code>output_root</code>).  </p>
<p><strong>Переменные окружения</strong>:<br/>
- <code>AI_DOCS_THREADS</code> — количество потоков по умолчанию.<br/>
- <code>AI_DOCS_LOCAL_SITE</code> — флаг для локальной конфигурации MkDocs.<br/>
- <code>AI_DOCS_REGEN</code> — передаётся в <code>generate_docs</code> при использовании <code>--regen</code>.  </p>
<p>После обработки временные файлы (для URL-репозиториев) удаляются. Вывод размещается в <code>output_root</code>, который определяется автоматически, если не задан явно.</p>
<p>Класс <code>LLMClient</code> предоставляет асинхронный интерфейс для взаимодействия с моделью крупного языка (LLM) через OpenAI-совместимое API с поддержкой кэширования, повторных попыток и динамического таймаута. Основан на <code>AsyncOpenAI</code> и использует <code>httpx</code> для сетевых запросов.</p>
<p><strong>Ключевые сущности:</strong>
- <code>LLMClient</code>: основной класс для отправки запросов к модели.
- <code>from_env</code>: фабричная функция, создающая клиент на основе переменных окружения.</p>
<p><strong>Параметры инициализации:</strong>
- <code>api_key</code>: ключ API для аутентификации.
- <code>base_url</code>: базовый URL провайдера (опционально, для сторонних хостов).
- <code>model</code>: модель для генерации (например, <code>gpt-4o-mini</code>).
- <code>temperature</code>: параметр креативности генерации (по умолчанию 0.2).
- <code>max_tokens</code>: максимальное число токенов в ответе.
- <code>context_limit</code>: лимит контекстных токенов модели.</p>
<p><strong>Особенности:</strong>
- Автоматическая оценка количества входных токенов через <code>count_tokens</code>.
- Динамический таймаут чтения (<code>_compute_read_timeout</code>) в зависимости от объема входных данных.
- Поддержка кэширования ответов по хешу входного <code>payload</code> (через <code>sha256_text</code>).
- Устойчивость к сбоям: повторные попытки при ошибках 408, 429, 5xx и таймаутах с экспоненциальной задержкой.
- Потокобезопасное кэширование с использованием <code>asyncio.Lock</code>.</p>
<p><strong>Переменные окружения (используются в <code>from_env</code>):</strong>
- <code>OPENAI_API_KEY</code> — обязательный ключ API.
- <code>OPENAI_BASE_URL</code> — опциональный URL для переопределения эндпоинта.
- <code>OPENAI_MODEL</code> — модель (по умолчанию <code>gpt-4o-mini</code>).
- <code>OPENAI_TEMPERATURE</code> — температура (по умолчанию 0.2).
- <code>OPENAI_MAX_TOKENS</code> — максимальное число токенов в ответе (по умолчанию 1200).
- <code>OPENAI_CONTEXT_TOKENS</code> — лимит контекста (по умолчанию 8192).</p>
<p>Функция <code>chat</code> отправляет список сообщений и возвращает сгенерированный текст, при необходимости сохраняя результат в кэш.</p>
<h1 id="_19">Резюме модуля обработки технической документации</h1>
<h2 id="_20">Назначение</h2>
<p>Модуль предназначен для автоматизированной обработки, нормализации и генерации текстовых описаний конфигураций и модулей с целью интеграции в техническую документацию. Поддерживает форматирование в стиле Doxygen и конфигурационном стиле с использованием LLM и кэшированием.</p>
<h2 id="_21">Основные функции</h2>
<ul>
<li><strong>Проверка и нормализация формата текста</strong> с учётом структурных требований.</li>
<li><strong>Асинхронная обработка</strong> больших файлов с разбиением на чанки по ограничению токенов.</li>
<li><strong>Генерация резюме</strong> с применением специализированных промптов в зависимости от типа файла (<code>config</code>, <code>infra</code> и др.) и режима (<code>detailed</code>).</li>
<li><strong>Форматирование секций</strong> с параметрами и ключами, включая обработку блоков кода и списков.</li>
<li><strong>Сохранение результатов</strong> в виде Markdown-файлов с безопасным именованием.</li>
</ul>
<h2 id="_22">Ключевые структуры</h2>
<ul>
<li><code>SUMMARY_PROMPT</code> — общий промпт для резюме.</li>
<li><code>MODULE_SUMMARY_PROMPT</code>, <code>MODULE_SUMMARY_REFORMAT_PROMPT</code> — для Doxygen-документации модулей.</li>
<li><code>CONFIG_SUMMARY_PROMPT</code>, <code>CONFIG_SUMMARY_REFORMAT_PROMPT</code> — для конфигурационных файлов.</li>
</ul>
<h2 id="_23">Вспомогательные функции</h2>
<ul>
<li><code>_needs_doxygen_fix</code> — проверка на несоответствие Doxygen-формату.</li>
<li><code>_normalize_module_summary</code> — нормализация описания модуля через LLM.</li>
<li><code>_normalize_config_summary</code> — нормализация конфигурационного описания.</li>
<li><code>_format_config_blocks</code> — форматирование секций с <code>&lt;br&gt;</code>.</li>
<li><code>_strip_fenced_markdown</code> — очистка от Markdown-блоков (```) и лишних пробелов.</li>
<li><code>summarize_file</code> — основная функция генерации резюме с кэшированием.</li>
<li><code>write_summary</code> — сохранение резюме в файл.</li>
</ul>
<h2 id="_24">Использование</h2>
<p>Модуль автоматизирует документирование кодовой базы, обеспечивая единообразие и соответствие стандартам форматирования.</p>
<p>Модуль отвечает за генерацию конфигурационного файла <code>mkdocs.yml</code> и запись Markdown-документации в файловую систему. Основная функция <code>build_mkdocs_yaml</code> формирует YAML-конфигурацию сайта документации с поддержкой структурированной навигации, включая разделы по архитектуре, запуску, тестированию, конфигурации и модулям. Поддерживается кастомизация навигации через параметры <code>sections</code>, <code>configs</code>, <code>module_nav_paths</code> и <code>project_config_nav_paths</code>. Для корректного отображения Mermaid-диаграмм в MkDocs используется плагин <code>mermaid2</code>, который регистрируется в <code>markdown_extensions</code> с кастомным репрезентером через <code>pyyaml</code>. Функция <code>_build_tree_nav</code> строит древовидную структуру навигации на основе путей файлов, преобразуя иерархию директорий в вложенную структуру <code>nav</code>. Функция <code>write_docs_files</code> записывает переданные файлы в указанную директорию, создавая необходимые поддиректории. Конфигурация адаптируется под локальный запуск при установке флага <code>local_site</code>.</p>
<p>Основной модуль генерации документации с использованием LLM. Оркестрирует процесс анализа исходных файлов, кэширования, создания и обновления документации на основе изменений. Поддерживает асинхронную обработку, многопоточность и инкрементальное обновление.</p>
<p>Ключевые сущности:<br/>
- <code>generate_docs</code> — синхронная точка входа, запускает асинхронный процесс через <code>asyncio</code>.<br/>
- <code>_generate_docs_async</code> — основная логика: вычисление diff'а, суммаризация изменённых и отсутствующих файлов, построение структуры документации, запись результатов.<br/>
- Интеграция с кэшем (<code>init_cache</code>, <code>save_cache_snapshot</code>) для оптимизации перегенерации.<br/>
- Поддержка разных типов документации: модули, конфигурации, общие файлы.  </p>
<p>Важные настройки:<br/>
- <code>use_cache</code> — включение/отключение кэширования.<br/>
- <code>threads</code> — количество потоков для параллельной обработки.<br/>
- <code>force</code> — принудительная перезапись README.<br/>
- <code>write_readme_flag</code> — флаг генерации README.<br/>
- <code>write_mkdocs</code> — флаг генерации конфигурации MkDocs.<br/>
- <code>local_site</code> — режим локального сайта (влияет на структуру навигации).<br/>
- <code>AI_DOCS_REGEN</code> — переменная окружения для указания секций, которые нужно перегенерировать принудительно.  </p>
<p>Результат:<br/>
- Генерация документации в <code>output_root/.ai-docs</code>.<br/>
- Создание <code>README.md</code> и <code>mkdocs.yml</code> (опционально).<br/>
- Вывод отчётов об ошибках, если таковые возникли.</p>
<p>Модуль предоставляет функции для управления кэшированием, сравнения файлов, обновления и очистки промежуточных данных (включая резюме файлов) в рамках анализа кодовой базы. Основное назначение — оптимизация процесса обработки файлов за счёт повторного использования ранее вычисленных результатов и поддержания согласованности кэша.</p>
<p>Ключевые сущности:<br/>
- <code>CacheManager</code> — управляет хранением и загрузкой кэша (LLM-ответов, индекса файлов).<br/>
- <code>file_map</code> — словарь с метаданными файлов (хэш, размер, тип, домены, содержимое), построенный по списку файлов.<br/>
- Промежуточные директории: <code>intermediate/files</code>, <code>intermediate/modules</code>, <code>intermediate/configs</code> — хранят резюме файлов, модулей и конфигураций соответственно.</p>
<p>Основные функции:<br/>
- <code>init_cache</code> — инициализирует менеджер кэша, загружает данные индекса и LLM-кэш (если включён).<br/>
- <code>build_file_map</code> — создаёт карту файлов с их хэшами и метаданными.<br/>
- <code>diff_files</code> — определяет, какие файлы изменились, добавились или были удалены.<br/>
- <code>ensure_summary_dirs</code> — гарантирует существование директорий для промежуточных резюме.<br/>
- <code>save_cache_snapshot</code> — сохраняет обновлённый индекс файлов и LLM-кэш.<br/>
- <code>carry_unchanged_summaries</code> — переносит пути к существующим резюме для неизменившихся файлов, выявляет отсутствующие.<br/>
- <code>cleanup_orphan_summaries</code> — удаляет резюме, на которые нет ссылок в текущем file_map.<br/>
- <code>cleanup_deleted_summaries</code> — удаляет резюме для удалённых файлов.</p>
<p>Важные настройки:<br/>
- <code>use_cache</code> — флаг, определяющий, используется ли кэширование LLM-ответов.<br/>
- <code>cache_dir</code> — директория хранения кэша, включая промежуточные файлы.<br/>
- Проверка типа файла (<code>code</code>, <code>config</code>) и пути (через <code>is_test_path</code>) влияет на генерацию и сохранение резюме.</p>
<h1 id="_25">Резюме документации</h1>
<p>Данный документ представляет собой обобщённое описание системы, её компонентов, функциональных возможностей и принципов работы. Система предназначена для эффективного управления данными и обеспечения взаимодействия между различными модулями через чётко определённые интерфейсы. Включает в себя описание архитектуры, основных процессов, требований к окружению и инструкции по развертыванию. Документация ориентирована на разработчиков, администраторов и технических специалистов, обеспечивая полное понимание системы и поддержку её эксплуатации.</p>
<p>Модуль предоставляет инструменты для подсчёта токенов и разбиения текста на части с учётом ограничений по токенам, в зависимости от модели. Использует <code>tiktoken</code> для корректного токенизации моделей OpenAI, а при отсутствии поддержки — резервное побайтовое кодирование. Основные функции: <code>get_encoding</code> возвращает токенизатор для указанной модели, <code>count_tokens</code> подсчитывает количество токенов в тексте, <code>chunk_text</code> разделяет текст на фрагменты заданного максимального размера в токенах. Ключевая настройка — параметр <code>max_tokens</code> в <code>chunk_text</code>, определяющий длину каждого фрагмента. В случае недоступности <code>tiktoken</code> используется внутренний класс <code>_ByteEncoding</code>, кодирующий текст как UTF-8 байты.</p>
<p>Функция формирует Markdown-отчёт об изменениях, внесённых в проект после генерации файлов. Отчёт включает списки добавленных, изменённых и удалённых файлов, перечень перегенерированных разделов и краткое резюме. Основные параметры: <code>added</code>, <code>modified</code>, <code>deleted</code> — словари с путями файлов; <code>regenerated_sections</code> — список названий разделов, подвергшихся перегенерации; <code>summary</code> — текст итогового описания изменений. Результат возвращается в виде строки в формате Markdown.</p>
<p>Файл содержит вспомогательные функции для анализа структуры проекта и генерации документации. Основное назначение — сбор информации о тестах, зависимостях, конфигурационных файлах и навигации по документации.  </p>
<p>Ключевые сущности:<br/>
- <code>SECTION_TITLES</code>, <code>DOMAIN_TITLES</code> — отображение внутренних ключей в читаемые заголовки разделов и доменов.<br/>
- <code>is_test_path</code> — определяет, является ли путь тестовым по имени или расположению.<br/>
- <code>collect_dependencies</code> — извлекает зависимости из <code>pyproject.toml</code>, <code>requirements.txt</code>, <code>package.json</code>.<br/>
- <code>collect_test_info</code> — находит тестовые файлы и команды для запуска тестов (например, <code>pytest</code>, <code>npm test</code>).<br/>
- <code>render_testing_section</code> — формирует Markdown-описание тестов и способов их запуска.<br/>
- <code>render_project_configs_index</code> — генерирует оглавление для конфигурационных файлов.<br/>
- <code>strip_duplicate_heading</code>, <code>first_paragraph</code> — утилиты для обработки текста документации.<br/>
- <code>build_docs_index</code> — строит иерархию разделов, модулей и конфигураций для навигации в документации.  </p>
<p>Важные настройки и поведение:<br/>
- Поддержка нескольких форматов конфигураций: TOML, JSON, текстовые файлы.<br/>
- Автоматическое определение тестовых файлов по имени и пути.<br/>
- Формирование структуры документации на основе наличия файлов в <code>docs/</code> и метаданных из <code>file_map</code>.<br/>
- Генерация кратких описаний модулей и конфигураций на основе первого абзаца из соответствующих <code>.md</code>-файлов.</p>
<p>Вспомогательные утилиты для работы с файлами, хеширования и путей. Основные функции: вычисление SHA-256 хеша от байтов и строк, безопасное чтение текстовых файлов с кодировкой UTF-8, проверка, является ли файл бинарным (по наличию нулевых байтов), определение URL по префиксу, нормализация путей в POSIX-формат и создание slug-идентификаторов из строк. Также включает функцию <code>ensure_dir</code> для создания директорий с проверкой существования. Используется для подготовки и валидации файловой структуры, безопасной обработки путей и определения типов источников (локальные файлы или URL).</p>
<p>Словари с описаниями расширений файлов и наборы ключевых имён/путей для классификации файлов в проекте. Определяет тип файла (код, конфигурация, документация и др.) и домены инфраструктуры (Kubernetes, Terraform, Docker и др.) на основе расширения, имени и пути. Используется для анализа структуры проекта. Основные сущности: <code>CODE_EXTENSIONS</code>, <code>CONFIG_EXTENSIONS</code>, <code>CI_FILENAMES</code>, <code>DOCKER_FILENAMES</code>, <code>TERRAFORM_EXTENSIONS</code>, <code>classify_type</code>, <code>detect_domains</code>. Ключевые параметры — расширения файлов и пути, ассоциированные с инфраструктурными технологиями.</p>
<p>Модуль обеспечивает запуск основного CLI-интерфейса приложения <code>ai_docs</code>. Реализует гибкую загрузку функции <code>main</code> из модуля <code>cli</code>, поддерживая как импорт в рамках пакета, так и запуск скрипта напрямую. В случае, если импорт через относительный путь не удается, автоматически добавляет родительский каталог в <code>sys.path</code> для корректного импорта. Основная логика запускается при выполнении файла как скрипта через <code>if __name__ == "__main__"</code>, что делает возможным использование команды <code>python ai_docs/cli.py</code> из терминала. Ключевая сущность — функция <code>main</code>, отвечающая за обработку аргументов командной строки и выполнение действий.</p>
<p>Класс <code>CacheManager</code> предназначен для управления кэшем в файловой системе, включая хранение индекса файлов и кэша ответов LLM. Работает с двумя основными файлами: <code>index.json</code> — для отслеживания состояния файлов (хэши, метаданные), и <code>llm_cache.json</code> — для хранения закэшированных текстовых ответов по ключам. При инициализации создает директорию кэша, если её нет. Метод <code>load_index</code> возвращает индекс файлов, инициализируя пустую структуру при отсутствии файла. Метод <code>save_index</code> записывает индекс с форматированием. Метод <code>load_llm_cache</code> безопасно загружает кэш LLM, обрабатывает пустые и битые JSON-файлы, сохраняя повреждённые данные в резервный файл с суффиксом <code>.bad</code>. Метод <code>save_llm_cache</code> сохраняет кэш, делая снимок данных. Метод <code>diff_files</code> сравнивает текущие метаданные файлов с сохранёнными и возвращает четыре словаря: добавленные, изменённые, удалённые и неизменные файлы — на основе сравнения хэшей. Используется для оптимизации обработки документов при повторных запусках.</p>
<p>Тестовый модуль для проверки функциональности сканера исходного кода из пакета <code>ai_docs.scanner</code>. Основное назначение — верификация корректной обработки файлов в директории, включая учёт правил игнорирования. Ключевая функция — <code>scan_source</code>, которая анализирует указанную директорию и возвращает список файлов, исключая игнорируемые (например, по правилам <code>.gitignore</code> и стандартным шаблонам вроде виртуальных окружений). В тесте <code>test_scan_local_dir</code> создаётся временная структура файлов, включая <code>app.py</code>, <code>Dockerfile</code>, <code>.gitignore</code> и файл в виртуальном окружении. Проверяется, что сканируются только ожидаемые файлы, а игнорируемые (например, <code>ignored.txt</code> и файлы из <code>.venv</code>) исключаются из результата.</p>
<h1 id="_26">Резюме документации</h1>
<p>Данный документ представляет собой обобщённое описание системы, её компонентов, функциональных возможностей и принципов работы. Система предназначена для эффективного управления данными и обеспечения взаимодействия между различными модулями через чётко определённые интерфейсы. Включает в себя описание архитектуры, основных процессов, требований к окружению и инструкции по развертыванию. Документация ориентирована на разработчиков, администраторов и технических специалистов, обеспечивая полное понимание системы и поддержку её эксплуатации.</p>
<p>Назначение файла — тестирование функциональности класса <code>CacheManager</code>, отвечающего за управление кэшем файлов, включая отслеживание изменений, добавление, удаление и определение неизменённых файлов. Основная сущность — класс <code>CacheManager</code>, работающий с индексом кэша, хранящим хэши файлов. Тесты проверяют метод <code>diff_files</code>, который сравнивает переданный список файлов с сохранённым состоянием и возвращает четыре категории: добавленные, изменённые, удалённые и неизменённые файлы. Важные аспекты: временная директория для изоляции тестов, последовательное обновление индекса через <code>save_index</code> и проверка корректности определения статусов файлов при изменении состояния. Тесты охватывают сценарии первого запуска, изменения хэшей, добавления и удаления файлов.</p>
<p>Файл содержит модульные тесты для функции <code>format_changes_md</code>, формирующей Markdown-представление изменений в документации. Основное назначение — проверка корректности генерации разделов по добавленным, изменённым, удалённым файлам и перегенерированным разделам. В тесте участвуют словари <code>added</code>, <code>modified</code>, <code>deleted</code> и список <code>regenerated</code>, а также параметр <code>summary</code>. Проверяется наличие ключевых заголовков и упоминание имён файлов и разделов в выходной Markdown-строке. Тест убеждается, что все компоненты правильно отображаются в итоговом тексте.</p>
<p>Помогает в разработке и рефакторинге кода, используя предварительно сгенерированную документацию в каталоге <code>.ai-docs</code>. Назначение — быстрая ориентация в структуре проекта, модулях, архитектуре и соглашениях без прямого анализа исходного кода на первом этапе.</p>
<p>Ключевые сущности:<br/>
- Каталог <code>.ai-docs</code> — основной источник информации.<br/>
- Файл <code>_index.json</code> — навигационный индекс для определения приоритетных модулей.<br/>
- Основные документы: <code>index.md</code>, <code>architecture.md</code>, <code>conventions.md</code>, <code>dependencies.md</code>, модульные описания в <code>modules/</code>.  </p>
<p>Важные настройки и правила:<br/>
- При отсутствии <code>.ai-docs</code> — возвращать сообщение о необходимости предварительной генерации документации.<br/>
- Классифицировать запросы (обзор, рефакторинг, уточнение) и выбирать соответствующие разделы.<br/>
- Использовать приоритеты и ранжирование из <code>_index.json</code> для фильтрации релевантных модулей.<br/>
- Опор на <code>.md</code>-файлы для формирования контекста; переход к исходному коду — только после локализации нужного компонента через документацию.<br/>
- Ответ формируется на языке запроса пользователя.<br/>
- Не предлагать обновление или перегенерацию документации.  </p>
<p>Результат включает краткий вывод, ссылки на задействованные файлы <code>.ai-docs</code> и, при необходимости, план действий с привязкой к разделам документации.</p></div>
</div>
</div>
<footer class="col-md-12">
<hr/>
<p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
</footer>
<script src="js/bootstrap.bundle.min.js"></script>
<script>
            var base_url = ".",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
<script src="js/base.js"></script>
<script src="search/main.js"></script>
<div aria-hidden="true" aria-labelledby="searchModalLabel" class="modal" id="mkdocs_search_modal" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg">
<div class="modal-content">
<div class="modal-header">
<h4 class="modal-title" id="searchModalLabel">Search</h4>
<button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
</div>
<div class="modal-body">
<p>From here you can search these documents. Enter your search terms below.</p>
<form>
<div class="form-group">
<input class="form-control" id="mkdocs-search-query" placeholder="Search..." title="Type search term here" type="search"/>
</div>
</form>
<div data-no-results-text="No results found" id="mkdocs-search-results"></div>
</div>
<div class="modal-footer">
</div>
</div>
</div>
</div><div aria-hidden="true" aria-labelledby="keyboardModalLabel" class="modal" id="mkdocs_keyboard_modal" role="dialog" tabindex="-1">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
<button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
</div>
<div class="modal-body">
<table class="table">
<thead>
<tr>
<th style="width: 20%;">Keys</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="help shortcut"><kbd>?</kbd></td>
<td>Open this help</td>
</tr>
<tr>
<td class="next shortcut"><kbd>n</kbd></td>
<td>Next page</td>
</tr>
<tr>
<td class="prev shortcut"><kbd>p</kbd></td>
<td>Previous page</td>
</tr>
<tr>
<td class="search shortcut"><kbd>s</kbd></td>
<td>Search</td>
</tr>
</tbody>
</table>
</div>
<div class="modal-footer">
</div>
</div>
</div>
</div>
</body>
</html>
